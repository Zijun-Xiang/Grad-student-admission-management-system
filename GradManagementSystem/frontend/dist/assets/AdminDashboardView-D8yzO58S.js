import{_ as Y,r as y,w as O,l as z,h as Q,c as r,a as e,d as g,t as v,F as V,f as S,e as _,v as W,g as p,i as f,o as i}from"./index-DT2F-dT6.js";const X={class:"dashboard-layout"},Z={class:"navbar admin-nav"},ee={class:"user-info"},te={key:0},se={class:"main-container"},ae={class:"content"},le={key:0,class:"card mb-30 error-card"},oe={class:"card mb-30"},ne={key:0,class:"loading-text"},de={key:1,class:"empty-state"},re={key:2,class:"table"},ie={class:"actions"},ue=["onClick"],ce={class:"card"},ve={key:0,class:"loading-text"},me={key:1,class:"empty-state"},_e={key:2,class:"review-list"},pe={class:"info"},ye={class:"student-name"},fe={class:"file-link"},be={class:"actions"},ge=["onClick"],we=["onClick"],he=["onClick"],ke={class:"card mt-30"},Ue={class:"user-form"},$e={class:"form-row"},Ce={class:"form-group"},De={class:"form-group"},Ve={class:"form-group"},Ee={class:"form-row"},Re={class:"form-group"},xe={class:"form-group"},Fe={key:0,class:"form-group"},Le={key:1,class:"form-group"},Se={key:2,class:"form-group"},Ne={class:"form-actions"},Ae=["disabled"],Te=["disabled"],je={key:0,class:"loading-text"},Oe={key:1,class:"empty-state"},Ie={key:2,class:"table mt-20"},Me={class:"actions"},Pe=["onClick","disabled"],Be=["onClick","disabled"],He={key:0,class:"modal-overlay"},qe={class:"modal-box wide-modal"},Ge={key:0,class:"edit-grid"},Je={class:"form-group"},Ke=["value"],Ye={class:"form-group"},ze=["value"],Qe={class:"form-group"},We={class:"form-group"},Xe={class:"form-group"},Ze={class:"form-group"},et={class:"modal-actions"},tt=["disabled"],st={__name:"AdminDashboardView",setup(at){const E=Q(),h=y({}),C=y(!0),R=y([]),x=y([]),k=y(""),m=y(!1),F=y([]),o=y({role:"student",entry_date:"",username:"",password:"",email:"",first_name:"",last_name:"",term_code:""}),L=y(!1),u=y(null),I=a=>`${a.student_id}-${a.hold_type}-${a.term_code||""}`,M=async a=>{var t,s;try{const l=(await f.get(`download_document.php?doc_id=${a.doc_id}`,{responseType:"blob"})).data,d=URL.createObjectURL(l);window.open(d,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(d),6e4)}catch(n){const l=(t=n==null?void 0:n.response)==null?void 0:t.status,d=(s=n==null?void 0:n.response)==null?void 0:s.data;try{if(d instanceof Blob){const c=await d.text();alert(`Failed to open document (${l||"network"}): ${c||"Forbidden/Not logged in"}`);return}}catch{}alert(`Failed to open document (${l||"network"}).`)}},w=async()=>{var a,t,s,n;C.value=!0,k.value="";try{const l=await f.get("admin_get_dashboard.php");((a=l.data)==null?void 0:a.status)==="success"?(R.value=l.data.holds||[],x.value=l.data.pending_documents||[]):k.value=((t=l.data)==null?void 0:t.message)||"Failed to load admin dashboard."}catch(l){k.value=((n=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:n.message)||(l==null?void 0:l.message)||"Failed to load admin dashboard."}finally{C.value=!1}},U=a=>{const t=new Date(a+"T00:00:00");if(isNaN(t.getTime()))return"";const s=t.getFullYear(),n=t.getMonth()+1;return n<=4?`${s}SP`:n<=8?`${s}SU`:`${s}FA`},N=()=>new Date().toISOString().slice(0,10);o.value.entry_date=N(),o.value.term_code=U(o.value.entry_date),O(()=>o.value.entry_date,a=>{o.value.term_code=U(a||"")});const $=async()=>{var a,t,s,n;m.value=!0;try{const l=await f.get("admin_users_list.php");((a=l.data)==null?void 0:a.status)==="success"?F.value=l.data.data||[]:alert(((t=l.data)==null?void 0:t.message)||"Failed to load users")}catch(l){alert(((n=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to load users")}finally{m.value=!1}},P=async()=>{var t,s,n,l;if(!o.value.username||!o.value.password)return alert("Username and password are required.");if(o.value.password.length<6)return alert("Password must be at least 6 characters.");if(confirm(`Create ${o.value.role} user "${o.value.username}"?`)){m.value=!0;try{const d=await f.post("admin_users_create.php",o.value);((t=d.data)==null?void 0:t.status)==="success"?(o.value.entry_date=N(),o.value.username="",o.value.password="",o.value.email="",o.value.first_name="",o.value.last_name="",o.value.term_code=U(o.value.entry_date),await $(),await w()):alert(((s=d.data)==null?void 0:s.message)||"Create failed")}catch(d){alert(((l=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:l.message)||"Create failed")}finally{m.value=!1}}},B=async a=>{var s,n,l,d;if(a.role==="admin")return alert("Deleting admin is disabled.");if(confirm(`Delete user "${a.username}" (#${a.user_id})? This will also delete related records.`)){m.value=!0;try{const c=await f.post("admin_users_delete.php",{user_id:a.user_id});((s=c.data)==null?void 0:s.status)==="success"?(await $(),await w()):alert(((n=c.data)==null?void 0:n.message)||"Delete failed")}catch(c){alert(((d=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:d.message)||"Delete failed")}finally{m.value=!1}}},H=a=>{u.value={user_id:a.user_id,role:a.role,username:a.username,email:a.email||"",entry_date:a.entry_date||"",entry_term_code:a.entry_term_code||(a.entry_date?U(a.entry_date):"")},L.value=!0};O(()=>{var a;return(a=u.value)==null?void 0:a.entry_date},a=>{u.value&&(u.value.entry_term_code=U(a||""))});const A=()=>{L.value=!1,u.value=null},q=async()=>{var a,t,s,n;if(u.value){m.value=!0;try{const l={user_id:u.value.user_id,username:u.value.username,email:u.value.email,entry_date:u.value.entry_date,entry_term_code:u.value.entry_term_code},d=await f.post("admin_users_update.php",l);((a=d.data)==null?void 0:a.status)==="success"?(A(),await $(),await w()):alert(((t=d.data)==null?void 0:t.message)||"Update failed")}catch(l){alert(((n=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:n.message)||"Update failed")}finally{m.value=!1}}},T=async(a,t)=>{var l,d,c,D;if(!confirm(`${t.toUpperCase()} this document? (${a.doc_type} · student ${a.student_id})`))return;const n=t==="reject"?prompt("Reason (optional):"):"Approved";try{const b=await f.post("admin_review_document.php",{doc_id:a.doc_id,action:t,comment:n});((l=b.data)==null?void 0:l.status)==="success"?(b.data.registrar_code&&alert(`Registrar code generated:
${b.data.registrar_code}`),await w()):alert(((d=b.data)==null?void 0:d.message)||"Action failed")}catch(b){const K=((D=(c=b==null?void 0:b.response)==null?void 0:c.data)==null?void 0:D.message)||"Network error";alert(K)}},G=async a=>{var s,n,l,d;if(confirm(`Lift hold "${a.hold_type}" for student ${a.student_id}?`))try{const c=await f.post("admin_lift_hold.php",{student_id:a.student_id,hold_type:a.hold_type,term_code:a.term_code||null});((s=c.data)==null?void 0:s.status)==="success"?(c.data.registrar_code&&alert(`Registrar code generated:
${c.data.registrar_code}`),await w()):alert(((n=c.data)==null?void 0:n.message)||"Lift failed")}catch(c){const D=((d=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:d.message)||"Network error";alert(D)}},J=async()=>{try{await f.post("logout.php")}catch{}localStorage.removeItem("user"),E.push("/")},j=async()=>{await Promise.all([w(),$()])};return z(()=>{const a=localStorage.getItem("user");if(!a)return E.push("/");if(h.value=JSON.parse(a),h.value.role!=="admin")return E.push(h.value.role==="faculty"?"/faculty":"/dashboard");j()}),(a,t)=>(i(),r(V,null,[e("div",X,[e("header",Z,[t[12]||(t[12]=e("div",{class:"brand"},"Grad System (Admin Portal)",-1)),e("div",ee,[h.value.username?(i(),r("span",te,"Admin: "+v(h.value.username),1)):g("",!0),e("button",{onClick:j,class:"btn-refresh"},"Refresh"),e("button",{onClick:J,class:"btn-logout"},"Logout")])]),e("div",se,[e("main",ae,[k.value?(i(),r("div",le,v(k.value),1)):g("",!0),e("div",oe,[t[14]||(t[14]=e("h2",null,"Active Holds",-1)),C.value?(i(),r("div",ne,"Loading...")):R.value.length===0?(i(),r("div",de,"No active holds.")):(i(),r("div",re,[t[13]||(t[13]=e("div",{class:"row header"},[e("div",null,"Student"),e("div",null,"Hold Type"),e("div",null,"Term"),e("div")],-1)),(i(!0),r(V,null,S(R.value,s=>(i(),r("div",{key:s.hold_id||I(s),class:"row"},[e("div",null,v(s.student_username||`#${s.student_id}`)+" (#"+v(s.student_id)+")",1),e("div",null,v(s.hold_type),1),e("div",null,v(s.term_code||"-"),1),e("div",ie,[e("button",{class:"btn-approve",onClick:n=>G(s)},"Lift Hold",8,ue)])]))),128))]))]),e("div",ce,[t[15]||(t[15]=e("h2",null,"Pending Documents",-1)),C.value?(i(),r("div",ve,"Loading...")):x.value.length===0?(i(),r("div",me,"No pending documents.")):(i(),r("div",_e,[(i(!0),r(V,null,S(x.value,s=>(i(),r("div",{key:s.doc_id,class:"review-item"},[e("div",pe,[e("span",ye,v(s.student_username||`#${s.student_id}`)+" (#"+v(s.student_id)+")",1),e("span",fe,v(s.doc_type)+" · "+v(s.file_path),1)]),e("div",be,[e("button",{class:"btn-view",onClick:n=>M(s)},"View",8,ge),e("button",{onClick:n=>T(s,"reject"),class:"btn-reject"},"Reject",8,we),e("button",{onClick:n=>T(s,"approve"),class:"btn-approve"},"Approve",8,he)])]))),128))]))]),e("div",ke,[t[26]||(t[26]=e("h2",null,"User Management",-1)),e("div",Ue,[e("div",$e,[e("div",Ce,[t[17]||(t[17]=e("label",null,"Role",-1)),_(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.role=s)},[...t[16]||(t[16]=[e("option",{value:"student"},"Student",-1),e("option",{value:"faculty"},"Faculty",-1)])],512),[[W,o.value.role]])]),e("div",De,[t[18]||(t[18]=e("label",null,"Entry Date",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.entry_date=s),type:"date"},null,512),[[p,o.value.entry_date]])]),e("div",Ve,[t[19]||(t[19]=e("label",null,"Username",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.username=s),type:"text",placeholder:"e.g. student2 / prof_jamil"},null,512),[[p,o.value.username]])])]),e("div",Ee,[e("div",Re,[t[20]||(t[20]=e("label",null,"Password",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.password=s),type:"password",placeholder:"At least 6 characters"},null,512),[[p,o.value.password]])]),e("div",xe,[t[21]||(t[21]=e("label",null,"Email (optional)",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.email=s),type:"email",placeholder:"Optional"},null,512),[[p,o.value.email]])]),o.value.role==="student"?(i(),r("div",Fe,[t[22]||(t[22]=e("label",null,"First Name (optional)",-1)),_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.first_name=s),type:"text",placeholder:"Optional"},null,512),[[p,o.value.first_name]])])):g("",!0),o.value.role==="student"?(i(),r("div",Le,[t[23]||(t[23]=e("label",null,"Last Name (optional)",-1)),_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.last_name=s),type:"text",placeholder:"Optional"},null,512),[[p,o.value.last_name]])])):g("",!0),o.value.role==="student"?(i(),r("div",Se,[t[24]||(t[24]=e("label",null,"Entry Term Code (auto)",-1)),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.term_code=s),type:"text",disabled:""},null,512),[[p,o.value.term_code]])])):g("",!0)]),e("div",Ne,[e("button",{class:"btn-view",onClick:$,disabled:m.value},"Refresh",8,Ae),e("button",{class:"btn-approve",onClick:P,disabled:m.value},"Create User",8,Te)])]),m.value?(i(),r("div",je,"Loading users...")):F.value.length===0?(i(),r("div",Oe,"No users.")):(i(),r("div",Ie,[t[25]||(t[25]=e("div",{class:"row header users-header"},[e("div",null,"Username"),e("div",null,"Role"),e("div",null,"Email"),e("div",null,"Entry Date"),e("div",null,"Entry Term"),e("div")],-1)),(i(!0),r(V,null,S(F.value,s=>(i(),r("div",{key:s.user_id,class:"row users-row"},[e("div",null,v(s.username)+" (#"+v(s.user_id)+")",1),e("div",null,v(s.role),1),e("div",null,v(s.email||"-"),1),e("div",null,v(s.entry_date||"-"),1),e("div",null,v(s.entry_term_code||"-"),1),e("div",Me,[e("button",{class:"btn-view",onClick:n=>H(s),disabled:s.role==="admin"},"Edit",8,Pe),e("button",{class:"btn-reject",onClick:n=>B(s),disabled:s.role==="admin"},"Delete",8,Be)])]))),128))]))])])])]),L.value?(i(),r("div",He,[e("div",qe,[t[33]||(t[33]=e("h3",null,"Edit Registration Info",-1)),u.value?(i(),r("div",Ge,[e("div",Je,[t[27]||(t[27]=e("label",null,"User ID",-1)),e("input",{value:u.value.user_id,disabled:""},null,8,Ke)]),e("div",Ye,[t[28]||(t[28]=e("label",null,"Role",-1)),e("input",{value:u.value.role,disabled:""},null,8,ze)]),e("div",Qe,[t[29]||(t[29]=e("label",null,"Username",-1)),_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>u.value.username=s)},null,512),[[p,u.value.username]])]),e("div",We,[t[30]||(t[30]=e("label",null,"Email",-1)),_(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>u.value.email=s),type:"email"},null,512),[[p,u.value.email]])]),e("div",Xe,[t[31]||(t[31]=e("label",null,"Entry Date",-1)),_(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>u.value.entry_date=s),type:"date"},null,512),[[p,u.value.entry_date]])]),e("div",Ze,[t[32]||(t[32]=e("label",null,"Entry Term Code (auto)",-1)),_(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>u.value.entry_term_code=s),disabled:""},null,512),[[p,u.value.entry_term_code]])])])):g("",!0),e("div",et,[e("button",{class:"btn-cancel",onClick:A},"Cancel"),e("button",{class:"btn-confirm-approve",onClick:q,disabled:m.value},"Save",8,tt)])])])):g("",!0)],64))}},ot=Y(st,[["__scopeId","data-v-efa87541"]]);export{ot as default};
