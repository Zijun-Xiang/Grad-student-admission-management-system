import{_ as Vt,r as d,o as Dt,i as jt,j as p,l as G,c as l,a as t,d as m,t as u,n as $,m as L,F as b,f as h,e as f,h as w,v as U,g as Pt,k as o,q as Nt,u as ce}from"./index-CqwOMfHx.js";import{d as Ot,f as qt,s as Gs,a as Ys}from"./docDisplay-CK9INdz_.js";import{F as Et}from"./FilePicker-DKtqNUbc.js";const Bt={class:"dashboard-layout"},It={class:"navbar"},Ht={class:"user-info"},Wt={key:0},Gt={class:"main-container"},Yt={class:"sidebar"},zt={class:"content"},Jt={key:1,class:"stack"},Qt={class:"card mb-30"},Zt={key:1,class:"loading-text"},Kt={key:2,class:"empty-state"},Xt={key:3,class:"review-list"},ea={class:"info"},sa={class:"student-name"},ta={class:"file-link"},aa={key:0,class:"file-link"},la={key:0,class:"muted"},oa={key:1,class:"file-link"},na={class:"muted"},ia={key:2,class:"form-row",style:{"margin-top":"10px"}},ua=["onUpdate:modelValue"],da={class:"actions"},ra=["href"],ca=["onClick","disabled"],va=["onClick","disabled"],ma=["onClick","disabled"],_a=["onClick","disabled","title"],pa={class:"card"},fa={key:0,class:"empty-state"},ga={key:1,class:"review-list"},ya={class:"info"},ba={class:"student-name"},ha={class:"email-text"},ka={class:"actions"},wa=["onClick"],Ca=["onClick"],Sa={key:2,class:"stack"},Aa={class:"card mb-30"},$a={key:0,class:"msg bad"},xa={class:"form-row"},La=["value"],Ua=["disabled"],Ta={key:2,class:"empty-state"},Ra={key:3,class:"table mt-20"},Fa={class:"actions"},Ma=["onClick","disabled"],Va=["onClick","disabled"],Da={class:"card"},ja={class:"form-row",style:{margin:"10px 0 6px"}},Pa=["disabled"],Na={key:0,class:"empty-state"},Oa={key:1,class:"table mt-20"},qa={class:"actions"},Ea=["onClick","disabled"],Ba={key:3,class:"stack"},Ia={class:"card mb-30"},Ha={class:"form-grid"},Wa={class:"form-group"},Ga={class:"form-group"},Ya={class:"form-group full"},za={class:"form-group"},Ja=["disabled"],Qa={key:0,class:"form-group"},Za={key:0,class:"msg bad",style:{margin:"0 0 10px"}},Ka=["disabled"],Xa=["value"],el={key:1,class:"form-group full"},sl=["value"],tl={class:"form-group full"},al={class:"form-actions"},ll=["disabled"],ol={class:"card mb-30"},nl={class:"form-row",style:{margin:"10px 0 6px"}},il=["value"],ul=["value"],dl=["disabled"],rl=["disabled"],cl={key:0,class:"loading-text"},vl={key:1,class:"empty-state"},ml={key:2,class:"review-list"},_l={key:0,class:"empty-state"},pl={class:"info"},fl={class:"student-name"},gl={class:"file-link"},yl={key:0},bl={class:"file-link"},hl={class:"actions"},kl=["onClick"],wl=["onClick"],Cl=["onClick"],Sl=["onClick"],Al={key:0,class:"card"},$l={key:0,class:"msg bad"},xl={key:1,class:"loading-text"},Ll={key:2,class:"review-list"},Ul={class:"info"},Tl={class:"student-name"},Rl={class:"file-link"},Fl={key:0},Ml={key:0,class:"file-link"},Vl={key:0},Dl={key:1,class:"muted"},jl={key:2,class:"muted"},Pl={class:"actions"},Nl=["onClick"],Ol=["onClick"],ql={key:2,class:"grade-box"},El=["value","onInput","disabled"],Bl=["onClick","disabled"],Il=["onClick","disabled"],Hl={key:4,class:"card mb-30"},Wl={class:"form-row",style:{margin:"10px 0 6px"}},Gl=["value"],Yl=["disabled"],zl={key:0,class:"empty-state"},Jl={key:1,class:"review-list"},Ql={class:"info"},Zl={class:"student-name"},Kl={key:0,class:"muted"},Xl={class:"doc-meta-row"},eo={class:"doc-source-pill"},so={class:"doc-format-pill"},to={key:0,class:"muted"},ao={class:"actions"},lo=["href"],oo=["onClick"],no={key:5,class:"card mb-30"},io={key:0,class:"loading-text"},uo={key:1,class:"form-grid"},ro={class:"form-group"},co=["value"],vo={class:"form-group"},mo=["value"],_o={class:"form-group"},po={class:"form-group"},fo=["value"],go={class:"form-group"},yo={class:"form-group"},bo={class:"form-actions"},ho=["disabled"],ko={key:6,class:"stack"},wo={class:"card mb-30"},Co={key:0,class:"loading-text"},So={key:1,class:"empty-state"},Ao={key:2,class:"table"},$o={class:"card"},xo={class:"form-row",style:{margin:"10px 0 6px"}},Lo=["disabled"],Uo={key:0,class:"loading-text"},To={key:1,class:"empty-state"},Ro={key:2,class:"table mt-20"},Fo={key:0,class:"muted"},Mo={key:1,class:"muted"},Vo={key:0,class:"actions"},Do=["href"],jo=["onClick"],Po={key:1,class:"muted"},No={key:7,class:"card"},Oo={key:0,class:"modal-overlay"},qo={class:"modal-box wide-modal"},Eo={key:0,class:"comment-meta"},Bo={class:"form-row",style:{margin:"6px 0 0"}},Io=["disabled"],Ho={key:2,class:"loading-text"},Wo={key:3,class:"empty-state"},Go={key:4,class:"table mt-20"},Yo={key:0,class:"muted"},zo={key:1,class:"muted"},Jo={key:1,class:"modal-overlay"},Qo={class:"modal-box wide-modal"},Zo={key:0,class:"comment-meta"},Ko={key:0,class:"muted"},Xo={class:"form-row",style:{margin:"6px 0 0"}},en=["disabled"],sn={key:2,class:"loading-text"},tn={key:3,class:"empty-state"},an={key:4,class:"table mt-20 table-scroll"},ln={key:0,class:"muted"},on={key:1,class:"muted"},nn={class:"muted"},un={class:"card",style:{"margin-top":"16px",padding:"16px"}},dn={class:"form-row"},rn=["value"],cn=["disabled"],vn=["value"],mn={class:"form-row"},_n=["disabled"],pn={key:1,class:"loading-text"},fn={key:2,class:"empty-state"},gn={key:3,class:"review-list",style:{"margin-top":"10px"}},yn={class:"info"},bn={class:"student-name"},hn={class:"doc-meta-row"},kn={class:"muted"},wn={key:0,class:"muted",style:{"margin-top":"6px"}},Cn={class:"actions"},Sn=["onClick","disabled"],An={class:"modal-actions"},$n={class:"muted",style:{"margin-right":"auto"}},xn={key:2,class:"modal-overlay"},Ln={class:"modal-box wide-modal"},Un={key:0,class:"comment-meta"},Tn={class:"comment-list"},Rn={key:0,class:"loading-text"},Fn={key:1,class:"empty-state"},Mn={key:2},Vn={class:"comment-head"},Dn={class:"comment-author"},jn={class:"comment-time"},Pn={class:"comment-body"},Nn={class:"modal-actions"},On=["disabled"],qn={key:3,class:"modal-overlay"},En={class:"modal-box wide-modal"},Bn={key:0,class:"comment-meta"},In={class:"comment-list"},Hn={key:0,class:"loading-text"},Wn={key:1,class:"empty-state"},Gn={key:2},Yn={class:"comment-head"},zn={class:"comment-author"},Jn={class:"comment-time"},Qn={class:"comment-body"},Zn={class:"modal-actions"},Kn=["disabled"],Xn={key:4,class:"modal-overlay"},ei={class:"modal-box wide-modal"},si={key:1,class:"form-grid"},ti={class:"form-group full"},ai={class:"form-group full"},li={class:"form-group"},oi={class:"form-group"},ni=["disabled"],ii={key:0,class:"form-group"},ui=["value"],di={key:1,class:"form-group"},ri=["disabled"],ci=["value"],vi={key:2,class:"form-group full"},mi=["value"],_i={class:"modal-actions"},pi=["disabled"],fi=["disabled"],gi={__name:"FacultyDashboardView",setup(yi){const Ge=jt(),$e=d({}),C=d("research"),Ye=d([]),ze=d([]),Je=d(""),Qe=d(!0),k=(a,e)=>{Qe.value=!!a,Je.value=String(e||"")},Ze=d(!1),xe=d(!1),q=d(""),E=d(!0),Ke=d(!1),Cs=d([{major_code:"CS",major_name:"Computer Science"}]),Xe=d({username:"",role:"faculty",email:"",major_code:"CS",major_name:"Computer Science"}),S=d({email:"",major_code:"CS",password:"",confirm:""}),es=d(!0),ss=d([]),M=d(""),ve=d({}),X=d(""),ee=d(!0),Le=d([]),se=d(!0),B=d([]),y=d({title:"",description:"",due_at:"",target_mode:"all",course_code:""}),me=d([]),Ue=d(null),Te=d(!1),I=d(""),H=d(!0),Re=d(!1),Fe=d([]),P=d(null),ts=d(!1),_e=d([]),te=d({}),ae=d(""),J=d(""),le=d(!0),pe=d(""),as=d(!1),_=d(null),fe=d(!1),T=d(""),R=d(!0),ls=d(!1),N=d(null),ge=d([]),os=d(!1),Q=d(""),Me=d(!1),ns=d(!0),Ve=d([]),is=d([]),us=d(""),De=d([]),oe=d(""),je=d(""),V=d(!1),ye=d(""),be=d(!0),ds=d(!1),ne=d(""),Pe=d([]),Ne=d(!1),ie=d(""),ue=d(!0),he=d(""),rs=d(!1),F=d(null),Oe=d(!1),Y=d([]),qe=d(0),ke=d(""),de=d(""),re=d(!0),cs=d([]),Ee=d([]),Be=d(!1),A=d({action_type:"add",course_code:"",comment:""}),z=d(!1),D=d(""),j=d(!0),vs=d(!1),ms=d([]),Ie=d(!1),Ss=d([]),_s=d(""),ps=d(""),fs=d(""),gs=d(!1),O=d(null),we=d([]),ys=d(!1),Z=d(""),He=d(!1);Dt(()=>{const a=localStorage.getItem("user");if(a){if($e.value=JSON.parse(a),$e.value.role!=="faculty")return Ge.push("/dashboard");xs(),Ls(),hs(),tt(),Ae(),Ce(),ot(),Ts()}else Ge.push("/")});const bs=a=>`${Nt}/download_document.php?doc_id=${a.doc_id}`,zs=async()=>{var a;try{const e=await p.get("majors_list.php");((a=e.data)==null?void 0:a.status)==="success"&&Array.isArray(e.data.data)&&e.data.data.length>0&&(Cs.value=e.data.data)}catch{}},As=async()=>{var i,s;const a=await p.get("profile_get.php");if(((i=a.data)==null?void 0:i.status)!=="success")throw new Error(((s=a.data)==null?void 0:s.message)||"Failed");const e=a.data.data||{};Xe.value=e,S.value.email=e.email||"",S.value.major_code=e.major_code||"CS"},Js=async()=>{var a,e;if(C.value="profile",q.value="",E.value=!0,!Ke.value){Ze.value=!0;try{await Promise.all([zs(),As()]),Ke.value=!0}catch(i){E.value=!1,q.value=((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.message)||(i==null?void 0:i.message)||"Failed to load profile."}finally{Ze.value=!1}}},Qs=async()=>{var a,e,i,s,n;if(q.value="",E.value=!0,S.value.password&&S.value.password!==S.value.confirm){E.value=!1,q.value="Passwords do not match.";return}xe.value=!0;try{const r=await p.post("profile_update.php",{email:S.value.email,major_code:S.value.major_code,password:S.value.password||""});((a=r.data)==null?void 0:a.status)==="success"?(E.value=!0,q.value=((e=r.data)==null?void 0:e.message)||"Saved.",S.value.password="",S.value.confirm="",await As(),Ke.value=!0):(E.value=!1,q.value=((i=r.data)==null?void 0:i.message)||"Save failed.")}catch(r){E.value=!1,q.value=((n=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:n.message)||"Save failed."}finally{xe.value=!1}},$s=a=>{const e=URL.createObjectURL(a);window.open(e,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(e),6e4)},xs=async()=>{try{const a=await p.get("faculty_get_mp_requests.php");a.data.status==="success"&&(Ye.value=a.data.data)}catch(a){console.error(a)}},Ls=async()=>{try{const a=await p.get("faculty_get_advisee_documents.php");a.data.status==="success"&&(ze.value=a.data.data||[])}catch(a){console.error(a)}},hs=async()=>{var a;es.value=!0;try{const e=await p.get("faculty_get_research_method_holds.php");((a=e.data)==null?void 0:a.status)==="success"&&(ss.value=e.data.data||[])}catch(e){console.error(e)}finally{es.value=!1}},Zs=a=>{a!=null&&a.proof_doc_id&&We({doc_id:a.proof_doc_id,student_id:a.student_id,student_username:a.student_username,doc_type:"research_method_proof"})},Us=async(a,e)=>{var i,s,n,r,v,c;if(X.value="",ee.value=!0,!(!(a!=null&&a.student_id)||!(a!=null&&a.proof_doc_id))){M.value=String(a.student_id);try{const g={student_id:a.student_id,doc_id:a.proof_doc_id,action:e,comment:String(((i=ve.value)==null?void 0:i[a.student_id])||"")},x=await p.post("faculty_review_research_method_proof.php",g);((s=x.data)==null?void 0:s.status)==="success"?(ee.value=!0,X.value=((n=x.data)==null?void 0:n.message)||"Saved.",ve.value={...ve.value,[a.student_id]:""},await hs()):(ee.value=!1,X.value=((r=x.data)==null?void 0:r.message)||"Action failed.")}catch(g){ee.value=!1,X.value=((c=(v=g==null?void 0:g.response)==null?void 0:v.data)==null?void 0:c.message)||"Action failed."}finally{M.value=""}}},Ks=async()=>{var a;vs.value=!0;try{const e=await p.get("defense_windows_list.php");((a=e.data)==null?void 0:a.status)==="success"&&(ms.value=e.data.data||[])}catch(e){console.error(e)}finally{vs.value=!1}},Ts=async()=>{var a;Ie.value=!0;try{await Ks();const e=await p.get("faculty_get_thesis_projects.php");((a=e.data)==null?void 0:a.status)==="success"&&(Ss.value=e.data.data||[])}catch(e){console.error(e)}finally{Ie.value=!1}},Rs=G(()=>{const a=(_s.value||"").trim().toLowerCase(),e=Ss.value||[];return a?e.filter(i=>[i.student_id,i.student_username,i.student_email,i.first_name,i.last_name,i.title,i.type,i.submission_date,i.defense_date].map(n=>String(n||"").toLowerCase()).join(" ").includes(a)):e}),Xs=G(()=>{const a=(ze.value||[]).map(e=>String(e.entry_term_code||"").trim()).filter(e=>e!=="");return Array.from(new Set(a)).sort((e,i)=>i.localeCompare(e))}),Fs=G(()=>{const a=(ps.value||"").trim().toLowerCase(),e=(fs.value||"").trim().toUpperCase();return(ze.value||[]).filter(s=>e&&String(s.entry_term_code||"").toUpperCase()!==e?!1:a?[s.student_id,s.student_username,s.student_email,s.first_name,s.last_name,s.entry_term_code,s.doc_type,s.status,s.file_path].map(r=>String(r||"").toLowerCase()).join(" ").includes(a):!0)}),et=async a=>{a!=null&&a.thesis_doc_id&&await We({doc_id:a.thesis_doc_id,student_id:a.student_id,student_username:a.student_username,doc_type:"thesis_project",file_path:a.thesis_file_path,status:a.thesis_doc_status})},st=async a=>{var e,i,s,n,r,v;M.value=String(a.student_id);try{const c=await p.post("faculty_lift_research_method_hold.php",{student_id:a.student_id});if(((e=c.data)==null?void 0:e.status)==="success"){const g=(i=c.data)!=null&&i.registrar_code?` Registrar code: ${c.data.registrar_code}`:"";k(!0,`${((s=c.data)==null?void 0:s.message)||"Hold lifted."}${g}`),await hs()}else k(!1,((n=c.data)==null?void 0:n.message)||"Lift failed")}catch(c){k(!1,((v=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:v.message)||"Network Error")}finally{M.value=""}},tt=async()=>{var a;try{const e=await p.get("faculty_assignment_options.php");((a=e.data)==null?void 0:a.status)==="success"&&(se.value=!!e.data.courses_enabled,B.value=e.data.courses||[],Le.value=e.data.students||[])}catch(e){console.error(e)}},at=a=>{const e=String((a==null?void 0:a.first_name)||"").trim(),i=String((a==null?void 0:a.last_name)||"").trim(),s=`${e} ${i}`.trim(),n=String((a==null?void 0:a.username)||(a==null?void 0:a.student_username)||"").trim(),r=String((a==null?void 0:a.entry_term_code)||"").trim(),v=s||n||`#${(a==null?void 0:a.student_id)??""}`;return r?`${v} · ${r}`:v},W=d({course_code:"",student_id:""}),lt=()=>{W.value={course_code:"",student_id:""}},ot=async()=>{var a;try{const e=await p.get("get_courses.php");((a=e.data)==null?void 0:a.status)==="success"&&(De.value=e.data.data||[])}catch{}},Ce=async()=>{var a,e,i,s;ye.value="",be.value=!0;try{const n=await p.get("faculty_get_overview.php");((a=n.data)==null?void 0:a.status)==="success"?(ns.value=!!n.data.faculty_courses_enabled,Ve.value=n.data.taught_courses||[],is.value=n.data.advisees||[]):(be.value=!1,ye.value=((e=n.data)==null?void 0:e.message)||"Failed to load overview.")}catch(n){be.value=!1,ye.value=((s=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to load overview."}},Se=a=>{const e=String((a==null?void 0:a.first_name)||"").trim(),i=String((a==null?void 0:a.last_name)||"").trim();return`${e} ${i}`.trim()||(a==null?void 0:a.student_username)||"Student"},Ms=G(()=>{const a=us.value.trim().toLowerCase(),e=Array.isArray(is.value)?[...is.value]:[],i=n=>a?[Se(n),n==null?void 0:n.student_username,n==null?void 0:n.student_email,String((n==null?void 0:n.student_id)??""),n==null?void 0:n.entry_term_code,n==null?void 0:n.mp_status].filter(Boolean).join(" ").toLowerCase().includes(a):!0,s=n=>{const r=String((n==null?void 0:n.first_name)||"").trim(),v=String((n==null?void 0:n.student_username)||"").trim();return(r||v).charAt(0).toUpperCase()||"Z"};return e.filter(i).sort((n,r)=>{const v=s(n),c=s(r);return v!==c?v.localeCompare(c):Se(n).localeCompare(Se(r))})}),nt=G(()=>{const a=String(je.value||"").trim().toLowerCase(),e=Array.isArray(De.value)?De.value:[];return a?e.filter(i=>{const s=String((i==null?void 0:i.course_code)||"").toLowerCase(),n=String((i==null?void 0:i.course_name)||"").toLowerCase();return s.includes(a)||n.includes(a)}):e}),Vs=G(()=>{const a=ke.value.trim().toLowerCase(),e=Array.isArray(Y.value)?Y.value:[];return a?e.filter(i=>{const s=String((i==null?void 0:i.course_code)||"").toLowerCase(),n=String((i==null?void 0:i.course_name)||"").toLowerCase();return s.includes(a)||n.includes(a)}):e}),it=G(()=>{const a=new Set((Y.value||[]).map(e=>String((e==null?void 0:e.course_code)||"").toUpperCase()));return(cs.value||[]).filter(e=>!a.has(String((e==null?void 0:e.course_code)||"").toUpperCase()))}),ut=async()=>{var a,e,i,s,n;if(oe.value){V.value=!0;try{const r=await p.post("faculty_add_teaching_course.php",{course_code:oe.value});((a=r.data)==null?void 0:a.status)==="success"?(k(!0,((e=r.data)==null?void 0:e.message)||"Course added."),oe.value="",je.value="",await Ce()):k(!1,((i=r.data)==null?void 0:i.message)||"Failed"),await Ce()}catch(r){k(!1,((n=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed")}finally{V.value=!1}}},dt=async a=>{var e,i,s,n,r;V.value=!0;try{const v=await p.post("faculty_remove_teaching_course.php",{course_code:a});((e=v.data)==null?void 0:e.status)==="success"?(k(!0,((i=v.data)==null?void 0:i.message)||"Course removed."),await Ce()):k(!1,((s=v.data)==null?void 0:s.message)||"Failed")}catch(v){k(!1,((r=(n=v==null?void 0:v.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed")}finally{V.value=!1}},rt=a=>{const e=String((a==null?void 0:a.first_name)||"").trim(),i=String((a==null?void 0:a.last_name)||"").trim();return`${e} ${i}`.trim()||(a==null?void 0:a.username)||"Student"},Ds=G(()=>{const a=(he.value||"").trim().toLowerCase(),e=Pe.value||[];return a?e.filter(i=>[i.username,i.email,i.first_name,i.last_name,i.entry_term_code,String(i.term_number??"")].map(n=>String(n||"").toLowerCase()).join(" ").includes(a)):e}),js=async()=>{var a,e,i,s;if(ne.value){Ne.value=!0,ie.value="",ue.value=!0;try{const n=await p.get(`faculty_get_course_students.php?course_code=${encodeURIComponent(ne.value)}`);((a=n.data)==null?void 0:a.status)==="success"?Pe.value=n.data.data||[]:(ue.value=!1,ie.value=((e=n.data)==null?void 0:e.message)||"Failed to load students.")}catch(n){ue.value=!1,ie.value=((s=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to load students."}finally{Ne.value=!1}}},ct=async a=>{ne.value=String((a==null?void 0:a.course_code)||""),Pe.value=[],he.value="",ds.value=!0,await js()},vt=()=>{ds.value=!1,ne.value="",Pe.value=[],he.value="",ie.value="",ue.value=!0},mt=()=>{rs.value=!1,F.value=null,Y.value=[],qe.value=0,ke.value="",de.value="",re.value=!0,cs.value=[],Ee.value=[],Be.value=!1,A.value={action_type:"add",course_code:"",comment:""},z.value=!1,D.value="",j.value=!0},_t=async()=>{var e,i;const a=(e=F.value)==null?void 0:e.student_id;if(a)try{const s=await p.get(`faculty_get_advisee_course_options.php?student_id=${encodeURIComponent(String(a))}`);((i=s.data)==null?void 0:i.status)==="success"&&(cs.value=s.data.data||[])}catch{}},ks=async()=>{var e,i;const a=(e=F.value)==null?void 0:e.student_id;if(a){Be.value=!0;try{const s=await p.get(`faculty_list_advisee_course_actions.php?student_id=${encodeURIComponent(String(a))}`);((i=s.data)==null?void 0:i.status)==="success"&&(Ee.value=s.data.data||[])}catch{}finally{Be.value=!1}}},pt=async()=>{var e,i,s,n,r,v;const a=(e=F.value)==null?void 0:e.student_id;if(a&&A.value.course_code){z.value=!0,D.value="",j.value=!0;try{const c=await p.post("faculty_create_advisee_course_action.php",{student_id:a,action_type:A.value.action_type,course_code:A.value.course_code,comment:A.value.comment});((i=c.data)==null?void 0:i.status)==="success"?(j.value=!0,D.value=((s=c.data)==null?void 0:s.message)||"Sent.",A.value.comment="",A.value.course_code="",await ks()):(j.value=!1,D.value=((n=c.data)==null?void 0:n.message)||"Failed.")}catch(c){j.value=!1,D.value=((v=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:v.message)||"Failed."}finally{z.value=!1}}},ft=async a=>{var e,i,s,n,r;if(a!=null&&a.id){z.value=!0,D.value="",j.value=!0;try{const v=await p.post("faculty_cancel_advisee_course_action.php",{action_id:a.id});((e=v.data)==null?void 0:e.status)==="success"?(j.value=!0,D.value=((i=v.data)==null?void 0:i.message)||"Cancelled.",await ks()):(j.value=!1,D.value=((s=v.data)==null?void 0:s.message)||"Failed.")}catch(v){j.value=!1,D.value=((r=(n=v==null?void 0:v.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed."}finally{z.value=!1}}},Ps=async()=>{var e,i,s,n,r,v;const a=(e=F.value)==null?void 0:e.student_id;if(a){Oe.value=!0,de.value="",re.value=!0;try{const c=String(((i=F.value)==null?void 0:i.student_username)||"").trim(),g=c?`&username=${encodeURIComponent(c)}`:"",x=await p.get(`faculty_get_advisee_courses.php?student_id=${encodeURIComponent(String(a))}${g}`);((s=x.data)==null?void 0:s.status)==="success"?(Y.value=x.data.data||[],qe.value=Number(x.data.total_credits||0)):(re.value=!1,de.value=((n=x.data)==null?void 0:n.message)||"Failed to load courses.")}catch(c){re.value=!1,de.value=((v=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:v.message)||"Failed to load courses."}finally{Oe.value=!1}}},gt=async a=>{F.value=a,Y.value=[],qe.value=0,ke.value="",A.value={action_type:"add",course_code:"",comment:""},rs.value=!0,await Promise.all([Ps(),_t(),ks()])},Ae=async()=>{var a;Re.value=!0;try{const e=await p.get("faculty_list_assignments.php");((a=e.data)==null?void 0:a.status)==="success"&&(Fe.value=e.data.data||[])}catch(e){console.error(e)}finally{Re.value=!1}},yt=a=>{var i,s;const e=a&&typeof File<"u"&&a instanceof File?a:((s=(i=a==null?void 0:a.target)==null?void 0:i.files)==null?void 0:s[0])??null;Ue.value=e},bt=async()=>{var a,e,i,s;if(I.value="",H.value=!0,!y.value.title.trim()){H.value=!1,I.value="Title is required.";return}if(y.value.target_mode==="course"&&!y.value.course_code){H.value=!1,I.value="Please select a course.";return}if(y.value.target_mode==="students"&&me.value.length===0){H.value=!1,I.value="Please select at least one student.";return}Te.value=!0;try{const n=new FormData;n.append("title",y.value.title),n.append("description",y.value.description||""),n.append("due_at",y.value.due_at||""),n.append("target_mode",y.value.target_mode),n.append("course_code",y.value.course_code||""),n.append("student_ids",JSON.stringify(me.value)),Ue.value&&n.append("file",Ue.value);const r=await p.post("faculty_create_assignment.php",n);((a=r.data)==null?void 0:a.status)==="success"?(H.value=!0,I.value="Assignment published.",y.value.title="",y.value.description="",y.value.due_at="",y.value.target_mode="all",y.value.course_code="",me.value=[],Ue.value=null,await Ae()):(H.value=!1,I.value=((e=r.data)==null?void 0:e.message)||"Create failed.")}catch(n){H.value=!1,I.value=((s=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:s.message)||"Create failed."}finally{Te.value=!1}},ht=a=>{var r,v;const e=a||[];if(e.some(c=>c.target_type==="all"))return"Target: All advisees";const i=(r=e.find(c=>c.target_type==="course"))==null?void 0:r.target_value;if(i){const c=kt(i);return c?`Target: Course ${c}`:`Target: Course ${i}`}const s=(v=e.find(c=>c.target_type==="cohort"))==null?void 0:v.target_value;return s?`Target: Cohort ${s}`:`Target: ${e.filter(c=>c.target_type==="student").length} student(s)`},kt=a=>{const e=String(a||"").trim();if(!e)return"";const i=[B.value||[],De.value||[],Ve.value||[]];for(const s of i){const n=s.find(r=>String((r==null?void 0:r.course_code)||(r==null?void 0:r.courseCode)||"").trim()===e);if(n){const r=String(n.course_name||n.courseName||"").trim();return r?`${e} · ${r}`:e}}return e},Ns=G(()=>{const a=String(W.value.course_code||"").trim(),e=String(W.value.student_id||"").trim(),i=Fe.value||[];return!a&&!e?i:i.filter(s=>{var Ws;const n=s.targets||[],r=(Ws=n.find(K=>K.target_type==="course"))==null?void 0:Ws.target_value,v=n.filter(K=>K.target_type==="student").map(K=>String(K.target_value||"")).filter(Boolean),c=n.some(K=>K.target_type==="all"),g=!a||String(r||"")===a,x=!e||c||v.includes(e);return g&&x})}),Os=async a=>{var e,i,s;P.value=a,_e.value=[],te.value={},J.value="",pe.value="",ts.value=!0;try{const n=await p.get(`faculty_get_assignment_submissions.php?assignment_id=${a.id}`);if(((e=n.data)==null?void 0:e.status)==="success"){_e.value=n.data.data||[];const r={};for(const v of _e.value)v.submission_id&&(r[v.submission_id]=v.grade??"");te.value=r}}catch(n){pe.value=((s=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to load submissions"}finally{ts.value=!1}},wt=a=>{if(!a)return"";const e=String(a).trim();return e?e.includes("T")?e.slice(0,16):e.includes(" ")?e.replace(" ","T").slice(0,16):e:""},Ct=a=>{var v,c;T.value="",R.value=!0;const e=a.targets||[];let i="all",s="",n="",r=[];e.some(g=>g.target_type==="all")?i="all":e.some(g=>g.target_type==="course")?(i="course",s=((v=e.find(g=>g.target_type==="course"))==null?void 0:v.target_value)||""):e.some(g=>g.target_type==="cohort")?(i="cohort",n=((c=e.find(g=>g.target_type==="cohort"))==null?void 0:c.target_value)||""):(i="students",r=e.filter(g=>g.target_type==="student").map(g=>String(g.target_value||"")).filter(Boolean)),_.value={assignment_id:a.id,title:a.title||"",description:a.description||"",due_at:wt(a.due_at),target_mode:i,course_code:s,cohort_term_code:n,student_ids:r},as.value=!0},qs=()=>{as.value=!1,_.value=null,T.value="",R.value=!0},St=async()=>{var e,i,s,n,r;if(!_.value)return;if(T.value="",R.value=!0,!(_.value.title||"").trim()){R.value=!1,T.value="Title is required.";return}if(_.value.target_mode==="course"&&!_.value.course_code){R.value=!1,T.value="Please select a course.";return}if(_.value.target_mode==="cohort"&&!_.value.cohort_term_code){R.value=!1,T.value="Missing cohort term code (legacy). Please switch target to Course or Students.";return}if(_.value.target_mode==="students"&&(!_.value.student_ids||_.value.student_ids.length===0)){R.value=!1,T.value="Please select at least one student.";return}fe.value=!0;try{const v=await p.post("faculty_update_assignment.php",{assignment_id:_.value.assignment_id,title:_.value.title,description:_.value.description,due_at:_.value.due_at||"",target_mode:_.value.target_mode,course_code:_.value.course_code||"",cohort_term_code:_.value.cohort_term_code||"",student_ids:_.value.student_ids||[]});((e=v.data)==null?void 0:e.status)==="success"?(R.value=!0,T.value=((i=v.data)==null?void 0:i.message)||"Saved.",await Ae(),P.value&&P.value.id===_.value.assignment_id&&(P.value=Fe.value.find(c=>c.id===_.value.assignment_id)||P.value),qs()):(R.value=!1,T.value=((s=v.data)==null?void 0:s.message)||"Save failed.")}catch(v){R.value=!1,T.value=((r=(n=v==null?void 0:v.response)==null?void 0:n.data)==null?void 0:r.message)||"Save failed."}finally{fe.value=!1}},At=async a=>{var e,i,s,n,r,v;try{const c=await p.post("faculty_delete_assignment.php",{assignment_id:a.id});((e=c.data)==null?void 0:e.status)==="success"?(k(!0,((i=c.data)==null?void 0:i.message)||"Deleted."),await Ae(),((s=P.value)==null?void 0:s.id)===a.id&&(P.value=null,_e.value=[],pe.value="")):k(!1,((n=c.data)==null?void 0:n.message)||"Delete failed")}catch(c){k(!1,((v=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:v.message)||"Delete failed")}},Es=(a,e)=>{te.value={...te.value,[a]:e}},Bs=async a=>{var e,i,s,n,r,v;if(a!=null&&a.submission_id){ae.value=String(a.submission_id),J.value="",le.value=!0;try{const c=(e=te.value)==null?void 0:e[a.submission_id],g={submission_id:a.submission_id,grade:c===""?null:c},x=await p.post("faculty_grade_assignment_submission.php",g);((i=x.data)==null?void 0:i.status)==="success"?(J.value=((s=x.data)==null?void 0:s.message)||"Saved.",le.value=!0,a.grade=x.data.grade,a.graded_at=x.data.graded_at??null):(J.value=((n=x.data)==null?void 0:n.message)||"Save failed.",le.value=!1)}catch(c){J.value=((v=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:v.message)||"Save failed.",le.value=!1}finally{ae.value=""}}},$t=async a=>{a!=null&&a.submission_id&&(Es(a.submission_id,""),await Bs(a))},xt=async a=>{try{const e=await p.get(`download_assignment_file.php?assignment_id=${a.id}`,{responseType:"blob"});$s(e.data)}catch{k(!1,"Download failed")}},Lt=async a=>{if(a.submission_id)try{const e=await p.get(`download_assignment_submission.php?submission_id=${a.submission_id}`,{responseType:"blob"});$s(e.data)}catch{k(!1,"Download failed")}},Is=async a=>{var e;N.value=a,ls.value=!0,Q.value="",ge.value=[],os.value=!0;try{const i=await p.get(`assignment_submission_comments_list.php?submission_id=${a.submission_id}`);((e=i.data)==null?void 0:e.status)==="success"&&(ge.value=i.data.data||[])}finally{os.value=!1}},Ut=()=>{ls.value=!1,N.value=null,ge.value=[],Q.value=""},Tt=async()=>{var a,e,i,s,n;if((a=N.value)!=null&&a.submission_id){Me.value=!0;try{const r=await p.post("faculty_add_submission_comment.php",{submission_id:N.value.submission_id,comment:Q.value});((e=r.data)==null?void 0:e.status)==="success"?(Q.value="",await Is(N.value),await Os(P.value)):k(!1,((i=r.data)==null?void 0:i.message)||"Failed to post comment")}catch(r){k(!1,((n=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to post comment")}finally{Me.value=!1}}},ws=a=>`${a.first_name||""} ${a.last_name||""}`.trim()||a.student_username||"Student",Hs=async(a,e)=>{var i,s;try{const n=await p.post("faculty_respond_mp.php",{student_id:a.student_id,action:e});n.data.status==="success"?(k(!0,((i=n.data)==null?void 0:i.message)||"Saved."),xs()):k(!1,((s=n.data)==null?void 0:s.message)||"Failed")}catch{k(!1,"Network Error")}},We=async a=>{var e,i;O.value=a,gs.value=!0,Z.value="",we.value=[],ys.value=!0;try{const s=await p.get(`document_comments_list.php?doc_id=${a.doc_id}`);s.data.status==="success"?we.value=s.data.data||[]:k(!1,s.data.message||"Failed to load comments")}catch(s){k(!1,((i=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to load comments")}finally{ys.value=!1}},Rt=()=>{gs.value=!1,O.value=null,we.value=[],Z.value=""},Ft=async()=>{var a,e;if(O.value){He.value=!0;try{const i=await p.post("document_comments_add.php",{doc_id:O.value.doc_id,comment:Z.value});i.data.status==="success"?(Z.value="",await We(O.value)):k(!1,i.data.message||"Failed to post comment")}catch(i){k(!1,((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to post comment")}finally{He.value=!1}}},Mt=async()=>{try{await p.post("logout.php")}catch{}localStorage.removeItem("user"),Ge.push("/")};return(a,e)=>{var i;return o(),l("div",Bt,[t("header",It,[e[37]||(e[37]=t("div",{class:"brand"},"Grad System (Faculty Portal)",-1)),t("div",Ht,[$e.value.username?(o(),l("span",Wt,"Prof. "+u($e.value.username),1)):m("",!0),t("button",{onClick:Mt,class:"btn-logout"},"Logout")])]),t("div",Gt,[t("aside",Yt,[t("nav",null,[t("ul",null,[t("li",{class:$({active:C.value==="research"}),onClick:e[0]||(e[0]=s=>C.value="research")},"Research Hold & MP Requests",2),t("li",{class:$({active:C.value==="overview"}),onClick:e[1]||(e[1]=s=>C.value="overview")},"My Teaching",2),t("li",{class:$({active:C.value==="assignments"}),onClick:e[2]||(e[2]=s=>C.value="assignments")},"Assignments",2),t("li",{class:$({active:C.value==="docs"}),onClick:e[3]||(e[3]=s=>C.value="docs")},"Advisee Docs",2),t("li",{class:$({active:C.value==="thesis"}),onClick:e[4]||(e[4]=s=>C.value="thesis")},"Thesis / Project",2),t("li",{class:$({active:C.value==="profile"}),onClick:Js},"Profile",2)])])]),t("main",zt,[Je.value?(o(),l("div",{key:0,class:$(["msg",{ok:Qe.value,bad:!Qe.value}])},u(Je.value),3)):m("",!0),C.value==="research"?(o(),l("div",Jt,[t("div",Qt,[e[40]||(e[40]=t("h2",null,"Research Method Hold Check (Term 3)",-1)),e[41]||(e[41]=t("p",{class:"subtitle"},[L(" You can lift the "),t("strong",null,"research_method"),L(" hold only after the student has registered/taken the Research Method course. ")],-1)),X.value?(o(),l("div",{key:0,class:$(["msg",{ok:ee.value,bad:!ee.value}])},u(X.value),3)):m("",!0),es.value?(o(),l("div",Zt,"Loading...")):ss.value.length===0?(o(),l("div",Kt,"No active research_method holds for your advisees.")):(o(),l("div",Xt,[(o(!0),l(b,null,h(ss.value,s=>(o(),l("div",{key:`${s.student_id}-${s.term_code||""}`,class:"review-item"},[t("div",ea,[t("span",sa,u(s.student_username||`#${s.student_id}`),1),t("span",ta,[L(" Hold: research_method · Term: "+u(s.term_code||"-")+" · Research Method: ",1),t("strong",null,u(Number(s.has_research_method)?"YES":"NO"),1)]),s.proof_doc_id?(o(),l("span",aa,[e[38]||(e[38]=L(" Proof uploaded: ",-1)),t("strong",null,u(String(s.proof_status||"pending")),1),s.proof_upload_date?(o(),l("span",la," · "+u(s.proof_upload_date),1)):m("",!0)])):m("",!0),s.proof_comment?(o(),l("span",oa,[e[39]||(e[39]=L(" Reviewer comment: ",-1)),t("span",na,u(s.proof_comment),1)])):m("",!0),s.proof_doc_id?(o(),l("div",ia,[f(t("input",{"onUpdate:modelValue":n=>ve.value[s.student_id]=n,class:"select",type:"text",placeholder:"Optional comment (visible to student)..."},null,8,ua),[[w,ve.value[s.student_id]]])])):m("",!0)]),t("div",da,[s.proof_doc_id?(o(),l("a",{key:0,href:bs({doc_id:s.proof_doc_id}),target:"_blank",class:"btn-view"},"View Proof",8,ra)):m("",!0),s.proof_doc_id?(o(),l("button",{key:1,class:"btn-view",onClick:n=>Zs(s),disabled:M.value===String(s.student_id)}," Comments ",8,ca)):m("",!0),s.proof_doc_id?(o(),l("button",{key:2,class:"btn-approve",onClick:n=>Us(s,"approve"),disabled:M.value===String(s.student_id)},u(M.value===String(s.student_id)?"Working...":"Approve"),9,va)):m("",!0),s.proof_doc_id?(o(),l("button",{key:3,class:"btn-reject",onClick:n=>Us(s,"reject"),disabled:M.value===String(s.student_id)},u(M.value===String(s.student_id)?"Working...":"Reject"),9,ma)):(o(),l("button",{key:4,class:"btn-approve",onClick:n=>st(s),disabled:!Number(s.has_research_method)||M.value===String(s.student_id),title:Number(s.has_research_method)?"":"Student must register Research Method first."},u(M.value===String(s.student_id)?"Working...":"Lift Hold"),9,_a))])]))),128))]))]),t("div",pa,[e[42]||(e[42]=t("h2",null,"Major Professor Requests",-1)),e[43]||(e[43]=t("p",{class:"subtitle"},"Students requesting you as their advisor.",-1)),Ye.value.length===0?(o(),l("div",fa,"No new advising requests.")):(o(),l("div",ga,[(o(!0),l(b,null,h(Ye.value,s=>(o(),l("div",{key:s.student_id,class:"review-item highlight-item"},[t("div",ya,[t("span",ba,u(ws(s)),1),t("span",ha,u(s.email),1)]),t("div",ka,[t("button",{onClick:n=>Hs(s,"reject"),class:"btn-reject"},"Decline",8,wa),t("button",{onClick:n=>Hs(s,"accept"),class:"btn-approve"},"Accept Student",8,Ca)])]))),128))]))])])):C.value==="overview"?(o(),l("div",Sa,[t("div",Aa,[e[47]||(e[47]=t("h2",null,"My Teaching Courses",-1)),ns.value?ye.value?(o(),l("div",{key:1,class:$(["msg",{ok:be.value,bad:!be.value}])},u(ye.value),3)):m("",!0):(o(),l("div",$a,[...e[44]||(e[44]=[L(" Teaching courses table not found. Run ",-1),t("code",null,"backend/sql/10_faculty_courses.sql",-1),L(" in MySQL. ",-1)])])),t("div",xa,[f(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>je.value=s),class:"select",type:"text",placeholder:"Search courses..."},null,512),[[w,je.value]]),f(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>oe.value=s),class:"select"},[e[45]||(e[45]=t("option",{disabled:"",value:""},"-- Select a course to add --",-1)),(o(!0),l(b,null,h(nt.value,s=>(o(),l("option",{key:s.course_code,value:s.course_code},u(s.course_code)+" · "+u(s.course_name)+" ("+u(s.credits)+") ",9,La))),128))],512),[[U,oe.value]]),t("button",{class:"btn-approve",onClick:ut,disabled:!oe.value||!ns.value||V.value},u(V.value?"Working...":"Add"),9,Ua)]),Ve.value.length===0?(o(),l("div",Ta,"No courses added.")):(o(),l("div",Ra,[e[46]||(e[46]=t("div",{class:"row header"},[t("div",null,"Course"),t("div",null,"Name"),t("div",null,"Credits"),t("div")],-1)),(o(!0),l(b,null,h(Ve.value,s=>(o(),l("div",{key:s.course_code,class:"row"},[t("div",null,[t("strong",null,u(s.course_code),1)]),t("div",null,u(s.course_name||"-"),1),t("div",null,u(s.credits||"-"),1),t("div",Fa,[t("button",{class:"btn-view",onClick:n=>ct(s),disabled:V.value},"Students",8,Ma),t("button",{class:"btn-reject",onClick:n=>dt(s.course_code),disabled:V.value},"Remove",8,Va)])]))),128))]))]),t("div",Da,[e[49]||(e[49]=t("h2",null,"My Advisees",-1)),t("div",ja,[f(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>us.value=s),class:"select",type:"text",placeholder:"Search by name / username / email / id..."},null,512),[[w,us.value]]),t("button",{class:"btn-view",onClick:Ce,disabled:V.value},"Refresh",8,Pa)]),Ms.value.length===0?(o(),l("div",Na,"No advisees found.")):(o(),l("div",Oa,[e[48]||(e[48]=t("div",{class:"row header"},[t("div",null,"Student"),t("div",null,"Email"),t("div",null,"Cohort"),t("div",null,"Status"),t("div")],-1)),(o(!0),l(b,null,h(Ms.value,s=>(o(),l("div",{key:s.student_id,class:"row"},[t("div",null,[t("strong",null,u(Se(s)),1)]),t("div",null,u(s.student_email||"-"),1),t("div",null,u(s.entry_term_code||"-"),1),t("div",null,u(s.mp_status),1),t("div",qa,[t("button",{class:"btn-view",onClick:n=>gt(s),disabled:V.value},"Courses",8,Ea)])]))),128))]))])])):C.value==="assignments"?(o(),l("div",Ba,[t("div",Ia,[e[62]||(e[62]=t("h2",null,"Create Assignment",-1)),t("div",Ha,[t("div",Wa,[e[50]||(e[50]=t("label",null,"Title",-1)),f(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>y.value.title=s),type:"text",placeholder:"e.g. HW1: Reading Summary"},null,512),[[w,y.value.title]])]),t("div",Ga,[e[51]||(e[51]=t("label",null,"Due (optional)",-1)),f(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>y.value.due_at=s),type:"datetime-local"},null,512),[[w,y.value.due_at]])]),t("div",Ya,[e[52]||(e[52]=t("label",null,"Description (optional)",-1)),f(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>y.value.description=s),rows:"4",placeholder:"Details..."},null,512),[[w,y.value.description]])]),t("div",za,[e[55]||(e[55]=t("label",null,"Target",-1)),f(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>y.value.target_mode=s)},[e[53]||(e[53]=t("option",{value:"all"},"All Advisees",-1)),t("option",{value:"course",disabled:!se.value||B.value.length===0},"Course",8,Ja),e[54]||(e[54]=t("option",{value:"students"},"Selected Students",-1))],512),[[U,y.value.target_mode]])]),y.value.target_mode==="course"?(o(),l("div",Qa,[e[58]||(e[58]=t("label",null,"Course",-1)),se.value?m("",!0):(o(),l("div",Za,[...e[56]||(e[56]=[L(" Teaching courses table not found. Add courses in ",-1),t("strong",null,"My Teaching",-1),L(" first. ",-1)])])),f(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>y.value.course_code=s),disabled:!se.value||B.value.length===0},[e[57]||(e[57]=t("option",{disabled:"",value:""},"-- Select Course --",-1)),(o(!0),l(b,null,h(B.value,s=>(o(),l("option",{key:s.course_code,value:s.course_code},u(s.course_code)+u(s.course_name?` · ${s.course_name}`:""),9,Xa))),128))],8,Ka),[[U,y.value.course_code]])])):m("",!0),y.value.target_mode==="students"?(o(),l("div",el,[e[59]||(e[59]=t("label",null,"Students",-1)),f(t("select",{"onUpdate:modelValue":e[13]||(e[13]=s=>me.value=s),multiple:"",class:"multi"},[(o(!0),l(b,null,h(Le.value,s=>(o(),l("option",{key:s.student_id,value:String(s.student_id)},u(s.username)+" "+u(s.entry_term_code?`· ${s.entry_term_code}`:""),9,sl))),128))],512),[[U,me.value]]),e[60]||(e[60]=t("div",{class:"hint"},"Hold Ctrl/Cmd to select multiple.",-1))])):m("",!0),t("div",tl,[e[61]||(e[61]=t("label",null,"Attachment (optional)",-1)),Pt(Et,{onChange:yt})])]),t("div",al,[t("button",{class:"btn-approve",onClick:bt,disabled:Te.value},u(Te.value?"Creating...":"Publish Assignment"),9,ll)]),I.value?(o(),l("div",{key:0,class:$(["msg",{ok:H.value,bad:!H.value}])},u(I.value),3)):m("",!0)]),t("div",ol,[e[66]||(e[66]=t("h2",null,"My Assignments",-1)),t("div",nl,[f(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>W.value.course_code=s),class:"select",style:{"min-width":"320px"}},[e[63]||(e[63]=t("option",{value:""},"All courses",-1)),(o(!0),l(b,null,h(B.value,s=>(o(),l("option",{key:s.course_code,value:s.course_code},u(s.course_name?`${s.course_name} (${s.course_code})`:s.course_code),9,il))),128))],512),[[U,W.value.course_code]]),f(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>W.value.student_id=s),class:"select",style:{"min-width":"320px"}},[e[64]||(e[64]=t("option",{value:""},"All students",-1)),(o(!0),l(b,null,h(Le.value,s=>(o(),l("option",{key:s.student_id,value:String(s.student_id)},u(at(s)),9,ul))),128))],512),[[U,W.value.student_id]]),t("button",{class:"btn-view",onClick:lt,disabled:!W.value.course_code&&!W.value.student_id}," Clear ",8,dl),t("button",{class:"btn-view",onClick:Ae,disabled:Re.value},"Refresh",8,rl)]),Re.value?(o(),l("div",cl,"Loading...")):Fe.value.length===0?(o(),l("div",vl,"No assignments yet.")):(o(),l("div",ml,[Ns.value.length===0?(o(),l("div",_l,"No assignments match your filters.")):m("",!0),(o(!0),l(b,null,h(Ns.value,s=>(o(),l("div",{key:s.id,class:"review-item"},[t("div",pl,[t("span",fl,u(s.title),1),t("span",gl,[L(" Created: "+u(s.created_at)+" ",1),s.due_at?(o(),l("span",yl,"· Due: "+u(s.due_at),1)):m("",!0),e[65]||(e[65]=L(" · Submissions: ",-1)),t("strong",null,u(s.submissions_count),1)]),t("span",bl,u(ht(s.targets)),1)]),t("div",hl,[t("button",{class:"btn-view",onClick:n=>Os(s)},"View",8,kl),s.attachment_path?(o(),l("button",{key:0,class:"btn-view",onClick:n=>xt(s)},"Attachment",8,wl)):m("",!0),t("button",{class:"btn-view",onClick:n=>Ct(s)},"Edit",8,Cl),t("button",{class:"btn-reject",onClick:n=>At(s)},"Delete",8,Sl)])]))),128))]))]),P.value?(o(),l("div",Al,[t("h2",null,"Submissions · "+u(P.value.title),1),pe.value?(o(),l("div",$l,u(pe.value),1)):m("",!0),ts.value?(o(),l("div",xl,"Loading submissions...")):(o(),l("div",Ll,[(o(!0),l(b,null,h(_e.value,s=>(o(),l("div",{key:s.student_id,class:"review-item"},[t("div",Ul,[t("span",Tl,u(ws(s)),1),t("span",Rl,[L(u(s.submission_id?`Submitted: ${s.submitted_at}`:"Not submitted yet.")+" ",1),s.entry_term_code?(o(),l("span",Fl,"· Cohort: "+u(s.entry_term_code),1)):m("",!0)]),s.submission_id?(o(),l("span",Ml,[e[67]||(e[67]=L(" Grade: ",-1)),s.grade!==null&&s.grade!==void 0?(o(),l("strong",Vl,u(s.grade),1)):(o(),l("span",Dl,"-")),s.graded_at?(o(),l("span",jl," · graded_at: "+u(s.graded_at),1)):m("",!0)])):m("",!0)]),t("div",Pl,[s.submission_id?(o(),l("button",{key:0,class:"btn-view",onClick:n=>Lt(s)},"Download",8,Nl)):m("",!0),s.submission_id?(o(),l("button",{key:1,class:"btn-view",onClick:n=>Is(s)}," Comments ("+u(Number(s.comments_count||0))+") ",9,Ol)):m("",!0),s.submission_id?(o(),l("div",ql,[t("input",{class:"grade-input",type:"number",min:"0",max:"100",step:"0.01",value:te.value[s.submission_id]??"",placeholder:"0-100",onInput:n=>{var r;return Es(s.submission_id,(r=n==null?void 0:n.target)==null?void 0:r.value)},disabled:ae.value===String(s.submission_id)},null,40,El),t("button",{class:"btn-approve",onClick:n=>Bs(s),disabled:ae.value===String(s.submission_id)},u(ae.value===String(s.submission_id)?"Saving...":"Save"),9,Bl),t("button",{class:"btn-reject",onClick:n=>$t(s),disabled:ae.value===String(s.submission_id)}," Clear ",8,Il)])):m("",!0)])]))),128))])),J.value?(o(),l("div",{key:3,class:$(["msg",{ok:le.value,bad:!le.value}])},u(J.value),3)):m("",!0)])):m("",!0)])):C.value==="docs"?(o(),l("div",Hl,[e[69]||(e[69]=t("h2",null,"My Advisee Documents",-1)),e[70]||(e[70]=t("p",{class:"subtitle"},"Documents submitted by students who selected you as their Major Professor.",-1)),t("div",Wl,[f(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>ps.value=s),class:"select",type:"text",placeholder:"Search by name / username / email / id..."},null,512),[[w,ps.value]]),f(t("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>fs.value=s),class:"select",style:{"min-width":"220px"}},[e[68]||(e[68]=t("option",{value:""},"All terms",-1)),(o(!0),l(b,null,h(Xs.value,s=>(o(),l("option",{key:s,value:s},u(s),9,Gl))),128))],512),[[U,fs.value]]),t("button",{class:"btn-view",onClick:Ls,disabled:V.value},"Refresh",8,Yl)]),Fs.value.length===0?(o(),l("div",zl,"No advisee documents.")):(o(),l("div",Jl,[(o(!0),l(b,null,h(Fs.value,s=>(o(),l("div",{key:s.doc_id,class:"review-item"},[t("div",Ql,[t("span",Zl,[L(u(ws(s))+" ",1),s.entry_term_code?(o(),l("span",Kl,"· "+u(s.entry_term_code),1)):m("",!0)]),t("div",Xl,[t("span",eo,u(ce(Ot)(s.doc_type)),1),t("span",so,u(ce(qt)(s.file_path)),1),t("span",{class:$(["doc-status-pill",ce(Gs)(s.status)])},u(ce(Ys)(s.status)),3),s.upload_date?(o(),l("span",to,"· "+u(s.upload_date),1)):m("",!0)])]),t("div",ao,[t("a",{href:bs(s),target:"_blank",class:"btn-view"},"View",8,lo),t("button",{class:"btn-view",onClick:n=>We(s)},"Comments",8,oo)])]))),128))]))])):C.value==="profile"?(o(),l("div",no,[e[77]||(e[77]=t("h2",null,"My Profile",-1)),Ze.value?(o(),l("div",io,"Loading...")):(o(),l("div",uo,[q.value?(o(),l("div",{key:0,class:$(["msg",{ok:E.value,bad:!E.value}])},u(q.value),3)):m("",!0),t("div",ro,[e[71]||(e[71]=t("label",null,"Username",-1)),t("input",{value:Xe.value.username,disabled:""},null,8,co)]),t("div",vo,[e[72]||(e[72]=t("label",null,"Role",-1)),t("input",{value:Xe.value.role,disabled:""},null,8,mo)]),t("div",_o,[e[73]||(e[73]=t("label",null,"Email",-1)),f(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>S.value.email=s),type:"email",placeholder:"Optional"},null,512),[[w,S.value.email]])]),t("div",po,[e[74]||(e[74]=t("label",null,"Major / Program",-1)),f(t("select",{"onUpdate:modelValue":e[19]||(e[19]=s=>S.value.major_code=s)},[(o(!0),l(b,null,h(Cs.value,s=>(o(),l("option",{key:s.major_code,value:s.major_code},u(s.major_name),9,fo))),128))],512),[[U,S.value.major_code]])]),t("div",go,[e[75]||(e[75]=t("label",null,"New Password",-1)),f(t("input",{"onUpdate:modelValue":e[20]||(e[20]=s=>S.value.password=s),type:"password",placeholder:"Leave blank to keep current password"},null,512),[[w,S.value.password]])]),t("div",yo,[e[76]||(e[76]=t("label",null,"Confirm Password",-1)),f(t("input",{"onUpdate:modelValue":e[21]||(e[21]=s=>S.value.confirm=s),type:"password",placeholder:"Re-enter new password"},null,512),[[w,S.value.confirm]])]),t("div",bo,[t("button",{class:"btn-approve",onClick:Qs,disabled:xe.value},u(xe.value?"Saving...":"Save Changes"),9,ho)])]))])):C.value==="thesis"?(o(),l("div",ko,[t("div",wo,[e[79]||(e[79]=t("h2",null,"Defense Window (Admin-published)",-1)),vs.value?(o(),l("div",Co,"Loading...")):ms.value.length===0?(o(),l("div",So,"No defense windows published yet.")):(o(),l("div",Ao,[e[78]||(e[78]=t("div",{class:"row header defense-row"},[t("div",null,"Year"),t("div",null,"Start"),t("div",null,"End")],-1)),(o(!0),l(b,null,h(ms.value,s=>(o(),l("div",{key:s.year,class:"row defense-row"},[t("div",null,[t("strong",null,u(s.year),1)]),t("div",null,u(s.start_date),1),t("div",null,u(s.end_date),1)]))),128))]))]),t("div",$o,[e[81]||(e[81]=t("h2",null,"Advisee Thesis / Project Timeline",-1)),t("div",xo,[f(t("input",{"onUpdate:modelValue":e[22]||(e[22]=s=>_s.value=s),class:"select",type:"text",placeholder:"Search advisees..."},null,512),[[w,_s.value]]),t("button",{class:"btn-view",onClick:Ts,disabled:Ie.value},"Refresh",8,Lo)]),Ie.value?(o(),l("div",Uo,"Loading...")):Rs.value.length===0?(o(),l("div",To,"No data.")):(o(),l("div",Ro,[e[80]||(e[80]=t("div",{class:"row header thesis-row"},[t("div",null,"Student"),t("div",null,"Term"),t("div",null,"Type"),t("div",null,"Submission"),t("div",null,"Defense"),t("div",null,"File"),t("div",null,"Title")],-1)),(o(!0),l(b,null,h(Rs.value,s=>(o(),l("div",{key:s.student_id,class:"row thesis-row"},[t("div",null,[t("strong",null,u(s.student_username||`#${s.student_id}`),1)]),t("div",null,[s.term_number?(o(),l("span",Fo,"Term "+u(s.term_number),1)):(o(),l("span",Mo,"-"))]),t("div",null,u(s.type||"-"),1),t("div",null,u(s.submission_date||"-"),1),t("div",null,u(s.defense_date||"-"),1),t("div",null,[s.thesis_doc_id?(o(),l("div",Vo,[t("a",{href:bs({doc_id:s.thesis_doc_id}),target:"_blank",class:"btn-view"},"View",8,Do),t("button",{class:"btn-view",onClick:n=>et(s)},"Comments",8,jo)])):(o(),l("span",Po,"-"))]),t("div",null,u(s.title||"-"),1)]))),128))]))])])):(o(),l("div",No,[...e[82]||(e[82]=[t("h2",null,"Faculty Portal",-1),t("p",{class:"subtitle"},"Select a section from the sidebar.",-1)])]))])]),ds.value?(o(),l("div",Oo,[t("div",qo,[e[84]||(e[84]=t("h3",null,"Course Students",-1)),ne.value?(o(),l("div",Eo,[t("strong",null,u(ne.value),1)])):m("",!0),t("div",Bo,[f(t("input",{"onUpdate:modelValue":e[23]||(e[23]=s=>he.value=s),class:"select",type:"text",placeholder:"Search students..."},null,512),[[w,he.value]]),t("button",{class:"btn-view",onClick:js,disabled:Ne.value},"Refresh",8,Io)]),ie.value?(o(),l("div",{key:1,class:$(["msg",{ok:ue.value,bad:!ue.value}])},u(ie.value),3)):m("",!0),Ne.value?(o(),l("div",Ho,"Loading...")):Ds.value.length===0?(o(),l("div",Wo,"No students found.")):(o(),l("div",Go,[e[83]||(e[83]=t("div",{class:"row header roster-row"},[t("div",null,"Student"),t("div",null,"Email"),t("div",null,"Cohort"),t("div",null,"Term")],-1)),(o(!0),l(b,null,h(Ds.value,s=>(o(),l("div",{key:s.student_id,class:"row roster-row"},[t("div",null,[t("strong",null,u(rt(s)),1)]),t("div",null,u(s.email||"-"),1),t("div",null,u(s.entry_term_code||"-"),1),t("div",null,[s.term_number?(o(),l("span",Yo,"Term "+u(s.term_number),1)):(o(),l("span",zo,"-"))])]))),128))])),t("div",{class:"modal-actions"},[t("button",{class:"btn-cancel",onClick:vt},"Close")])])])):m("",!0),rs.value?(o(),l("div",Jo,[t("div",Qo,[e[92]||(e[92]=t("h3",null,"Advisee Course Registrations",-1)),F.value?(o(),l("div",Zo,[t("strong",null,u(Se(F.value)),1),(i=F.value)!=null&&i.entry_term_code?(o(),l("span",Ko," · "+u(F.value.entry_term_code),1)):m("",!0)])):m("",!0),t("div",Xo,[f(t("input",{"onUpdate:modelValue":e[24]||(e[24]=s=>ke.value=s),class:"select",type:"text",placeholder:"Search courses..."},null,512),[[w,ke.value]]),t("button",{class:"btn-view",onClick:Ps,disabled:Oe.value},"Refresh",8,en)]),de.value?(o(),l("div",{key:1,class:$(["msg",{ok:re.value,bad:!re.value}])},u(de.value),3)):m("",!0),Oe.value?(o(),l("div",sn,"Loading...")):Vs.value.length===0?(o(),l("div",tn,"No registered courses.")):(o(),l("div",an,[e[85]||(e[85]=t("div",{class:"row header advisee-course-row"},[t("div",null,"Course"),t("div",null,"Name"),t("div",null,"Credits"),t("div",null,"Type"),t("div",null,"Registered")],-1)),(o(!0),l(b,null,h(Vs.value,s=>(o(),l("div",{key:s.course_code,class:"row advisee-course-row"},[t("div",null,[t("strong",null,u(s.course_code),1)]),t("div",null,u(s.course_name||"-"),1),t("div",null,u(s.credits??"-"),1),t("div",null,[Number(s.is_deficiency)?(o(),l("span",ln,"Deficiency")):(o(),l("span",on,"-"))]),t("div",null,[t("span",nn,u(s.registered_at||"-"),1)])]))),128))])),t("div",un,[e[89]||(e[89]=t("h4",{style:{margin:"0 0 10px"}},"Request Course Add/Drop (Student Applies)",-1)),D.value?(o(),l("div",{key:0,class:$(["msg",{ok:j.value,bad:!j.value}])},u(D.value),3)):m("",!0),t("div",dn,[f(t("select",{"onUpdate:modelValue":e[25]||(e[25]=s=>A.value.action_type=s),class:"select",style:{"max-width":"160px"}},[...e[86]||(e[86]=[t("option",{value:"add"},"Add",-1),t("option",{value:"drop"},"Drop",-1)])],512),[[U,A.value.action_type]]),A.value.action_type==="add"?f((o(),l("select",{key:0,"onUpdate:modelValue":e[26]||(e[26]=s=>A.value.course_code=s),class:"select"},[e[87]||(e[87]=t("option",{disabled:"",value:""},"-- Select course --",-1)),(o(!0),l(b,null,h(it.value,s=>(o(),l("option",{key:s.course_code,value:s.course_code},u(s.course_code)+u(s.course_name?` · ${s.course_name}`:""),9,rn))),128))],512)),[[U,A.value.course_code]]):f((o(),l("select",{key:1,"onUpdate:modelValue":e[27]||(e[27]=s=>A.value.course_code=s),class:"select",disabled:Y.value.length===0},[e[88]||(e[88]=t("option",{disabled:"",value:""},"-- Select registered course --",-1)),(o(!0),l(b,null,h(Y.value,s=>(o(),l("option",{key:s.course_code,value:s.course_code},u(s.course_code)+u(s.course_name?` · ${s.course_name}`:""),9,vn))),128))],8,cn)),[[U,A.value.course_code]])]),t("div",mn,[f(t("input",{"onUpdate:modelValue":e[28]||(e[28]=s=>A.value.comment=s),class:"select",type:"text",placeholder:"Optional comment to student..."},null,512),[[w,A.value.comment]]),t("button",{class:"btn-approve",onClick:pt,disabled:z.value||!A.value.course_code||!F.value,style:{"max-width":"160px"}},u(z.value?"Sending...":"Send Request"),9,_n)]),e[90]||(e[90]=t("div",{style:{"margin-top":"10px"}},[t("strong",null,"Recent Requests")],-1)),Be.value?(o(),l("div",pn,"Loading requests...")):Ee.value.length===0?(o(),l("div",fn,"No requests yet.")):(o(),l("div",gn,[(o(!0),l(b,null,h(Ee.value,s=>(o(),l("div",{key:s.id,class:"review-item"},[t("div",yn,[t("span",bn,u(s.action_type==="add"?"ADD":"DROP")+" · "+u(s.course_code)+u(s.course_name?` · ${s.course_name}`:""),1),t("div",hn,[t("span",{class:$(["doc-status-pill",ce(Gs)(s.status)])},u(ce(Ys)(s.status)),3),t("span",kn,"· "+u(s.created_at),1)]),s.comment?(o(),l("div",wn,"Comment: "+u(s.comment),1)):m("",!0)]),t("div",Cn,[s.status==="pending"?(o(),l("button",{key:0,class:"btn-reject",onClick:n=>ft(s),disabled:z.value}," Cancel ",8,Sn)):m("",!0)])]))),128))]))]),t("div",An,[t("div",$n,[e[91]||(e[91]=L(" Total credits: ",-1)),t("strong",null,u(qe.value),1)]),t("button",{class:"btn-cancel",onClick:mt},"Close")])])])):m("",!0),gs.value?(o(),l("div",xn,[t("div",Ln,[e[93]||(e[93]=t("h3",null,"Document Comments",-1)),O.value?(o(),l("div",Un,[t("div",null,[t("strong",null,u(O.value.student_username||`#${O.value.student_id}`),1),t("span",null," · "+u(O.value.doc_type)+" · doc_id="+u(O.value.doc_id),1)])])):m("",!0),t("div",Tn,[ys.value?(o(),l("div",Rn,"Loading comments...")):we.value.length===0?(o(),l("div",Fn,"No comments yet.")):(o(),l("div",Mn,[(o(!0),l(b,null,h(we.value,s=>(o(),l("div",{key:s.id,class:"comment-item"},[t("div",Vn,[t("span",Dn,u(s.author_username||s.author_role),1),t("span",jn,u(s.created_at),1)]),t("div",Pn,u(s.comment),1)]))),128))]))]),f(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=s=>Z.value=s),placeholder:"Write a comment...",rows:"4"},null,512),[[w,Z.value]]),t("div",Nn,[t("button",{onClick:Rt,class:"btn-cancel"},"Close"),t("button",{onClick:Ft,class:"btn-confirm-approve",disabled:He.value||!Z.value.trim()},u(He.value?"Posting...":"Post Comment"),9,On)])])])):m("",!0),ls.value?(o(),l("div",qn,[t("div",En,[e[94]||(e[94]=t("h3",null,"Submission Comments",-1)),N.value?(o(),l("div",Bn,[t("div",null,[t("strong",null,u(N.value.student_username||`#${N.value.student_id}`),1),t("span",null," · submission_id="+u(N.value.submission_id),1)])])):m("",!0),t("div",In,[os.value?(o(),l("div",Hn,"Loading comments...")):ge.value.length===0?(o(),l("div",Wn,"No comments yet.")):(o(),l("div",Gn,[(o(!0),l(b,null,h(ge.value,s=>(o(),l("div",{key:s.id,class:"comment-item"},[t("div",Yn,[t("span",zn,u(s.author_username||s.author_role),1),t("span",Jn,u(s.created_at),1)]),t("div",Qn,u(s.comment),1)]))),128))]))]),f(t("textarea",{"onUpdate:modelValue":e[30]||(e[30]=s=>Q.value=s),placeholder:"Write a comment...",rows:"4"},null,512),[[w,Q.value]]),t("div",Zn,[t("button",{onClick:Ut,class:"btn-cancel"},"Close"),t("button",{onClick:Tt,class:"btn-confirm-approve",disabled:Me.value||!Q.value.trim()||!N.value},u(Me.value?"Posting...":"Post Comment"),9,Kn)])])])):m("",!0),as.value?(o(),l("div",Xn,[t("div",ei,[e[107]||(e[107]=t("h3",null,"Edit Assignment",-1)),T.value?(o(),l("div",{key:0,class:$(["msg",{ok:R.value,bad:!R.value}])},u(T.value),3)):m("",!0),_.value?(o(),l("div",si,[t("div",ti,[e[95]||(e[95]=t("label",null,"Title",-1)),f(t("input",{"onUpdate:modelValue":e[31]||(e[31]=s=>_.value.title=s),type:"text"},null,512),[[w,_.value.title]])]),t("div",ai,[e[96]||(e[96]=t("label",null,"Description",-1)),f(t("textarea",{"onUpdate:modelValue":e[32]||(e[32]=s=>_.value.description=s),rows:"4"},null,512),[[w,_.value.description]])]),t("div",li,[e[97]||(e[97]=t("label",null,"Due At",-1)),f(t("input",{"onUpdate:modelValue":e[33]||(e[33]=s=>_.value.due_at=s),type:"datetime-local"},null,512),[[w,_.value.due_at]])]),t("div",oi,[e[101]||(e[101]=t("label",null,"Target",-1)),f(t("select",{"onUpdate:modelValue":e[34]||(e[34]=s=>_.value.target_mode=s)},[e[98]||(e[98]=t("option",{value:"all"},"All Students",-1)),t("option",{value:"course",disabled:!se.value||B.value.length===0},"Course",8,ni),e[99]||(e[99]=t("option",{value:"cohort",disabled:""},"Cohort (Legacy)",-1)),e[100]||(e[100]=t("option",{value:"students"},"Specific Students",-1))],512),[[U,_.value.target_mode]])]),_.value.target_mode==="cohort"?(o(),l("div",ii,[e[102]||(e[102]=t("label",null,"Cohort Term Code (legacy)",-1)),t("input",{value:_.value.cohort_term_code||"",type:"text",disabled:""},null,8,ui)])):m("",!0),_.value.target_mode==="course"?(o(),l("div",di,[e[104]||(e[104]=t("label",null,"Course",-1)),f(t("select",{"onUpdate:modelValue":e[35]||(e[35]=s=>_.value.course_code=s),class:"select",disabled:!se.value||B.value.length===0},[e[103]||(e[103]=t("option",{disabled:"",value:""},"-- Select course --",-1)),(o(!0),l(b,null,h(B.value,s=>(o(),l("option",{key:s.course_code,value:s.course_code},u(s.course_code)+u(s.course_name?` · ${s.course_name}`:""),9,ci))),128))],8,ri),[[U,_.value.course_code]])])):m("",!0),_.value.target_mode==="students"?(o(),l("div",vi,[e[105]||(e[105]=t("label",null,"Students",-1)),f(t("select",{"onUpdate:modelValue":e[36]||(e[36]=s=>_.value.student_ids=s),multiple:"",class:"multi"},[(o(!0),l(b,null,h(Le.value,s=>(o(),l("option",{key:s.student_id,value:String(s.student_id)},u(s.username)+" "+u(s.entry_term_code?`· ${s.entry_term_code}`:""),9,mi))),128))],512),[[U,_.value.student_ids]]),e[106]||(e[106]=t("div",{class:"hint"},"Hold Ctrl/Cmd to select multiple.",-1))])):m("",!0)])):m("",!0),t("div",_i,[t("button",{class:"btn-cancel",onClick:qs,disabled:fe.value},"Cancel",8,pi),t("button",{class:"btn-confirm-approve",onClick:St,disabled:fe.value||!_.value},u(fe.value?"Saving...":"Save"),9,fi)])])])):m("",!0)])}}},wi=Vt(gi,[["__scopeId","data-v-c9aedc58"]]);export{wi as default};
