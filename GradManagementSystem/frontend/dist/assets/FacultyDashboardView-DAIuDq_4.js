import{_ as as,r as d,o as ls,h as os,i as p,k as te,c as l,a as s,d as c,t as u,n as S,l as $,F as b,f as h,e as f,v as M,g as C,j as o,q as ns,u as Me}from"./index-CHzR5xCe.js";import{d as is,f as us,s as ds,a as rs}from"./docDisplay-CK9INdz_.js";const cs={class:"dashboard-layout"},vs={class:"navbar"},ms={class:"user-info"},_s={key:0},ps={class:"main-container"},fs={class:"sidebar"},gs={class:"content"},ys={key:0,class:"card mb-30"},bs={key:1,class:"loading-text"},hs={key:2,class:"empty-state"},ks={key:3,class:"review-list"},ws={class:"info"},Cs={class:"student-name"},Ss={class:"file-link"},$s={key:0,class:"file-link"},As={key:0,class:"muted"},Ts={key:1,class:"file-link"},Ls={class:"muted"},Us={key:2,class:"form-row",style:{"margin-top":"10px"}},Ms=["onUpdate:modelValue"],js={class:"actions"},xs=["href"],Ds=["onClick","disabled"],Vs=["onClick","disabled"],Ps=["onClick","disabled"],Rs=["onClick","disabled","title"],Fs={key:1,class:"stack"},Ns={class:"card mb-30"},Os={key:0,class:"msg bad"},Es={class:"form-row"},qs=["value"],Bs=["disabled"],Hs={key:2,class:"empty-state"},Ws={key:3,class:"table mt-20"},Is={class:"actions"},Gs=["onClick","disabled"],Ys=["onClick","disabled"],zs={class:"card"},Js={class:"form-row",style:{margin:"10px 0 6px"}},Qs=["disabled"],Zs={key:0,class:"empty-state"},Ks={key:1,class:"table mt-20"},Xs={key:2,class:"stack"},ea={class:"card mb-30"},ta={class:"form-grid"},sa={class:"form-group"},aa={class:"form-group"},la={class:"form-group full"},oa={class:"form-group"},na=["disabled"],ia={key:0,class:"form-group"},ua={key:0,class:"msg bad",style:{margin:"0 0 10px"}},da=["disabled"],ra=["value"],ca={key:1,class:"form-group full"},va=["value"],ma={class:"form-group full"},_a={class:"form-actions"},pa=["disabled"],fa={class:"card mb-30"},ga={class:"form-row",style:{margin:"10px 0 6px"}},ya=["value"],ba=["value"],ha=["disabled"],ka=["disabled"],wa={key:0,class:"loading-text"},Ca={key:1,class:"empty-state"},Sa={key:2,class:"review-list"},$a={key:0,class:"empty-state"},Aa={class:"info"},Ta={class:"student-name"},La={class:"file-link"},Ua={key:0},Ma={class:"file-link"},ja={class:"actions"},xa=["onClick"],Da=["onClick"],Va=["onClick"],Pa=["onClick"],Ra={key:0,class:"card"},Fa={key:0,class:"msg bad"},Na={key:1,class:"loading-text"},Oa={key:2,class:"review-list"},Ea={class:"info"},qa={class:"student-name"},Ba={class:"file-link"},Ha={key:0},Wa={key:0,class:"file-link"},Ia={key:0},Ga={key:1,class:"muted"},Ya={key:2,class:"muted"},za={class:"actions"},Ja=["onClick"],Qa=["onClick"],Za={key:2,class:"grade-box"},Ka=["value","onInput","disabled"],Xa=["onClick","disabled"],el=["onClick","disabled"],tl={key:3,class:"card mb-30"},sl={class:"form-row",style:{margin:"10px 0 6px"}},al=["value"],ll=["disabled"],ol={key:0,class:"empty-state"},nl={key:1,class:"review-list"},il={class:"info"},ul={class:"student-name"},dl={key:0,class:"muted"},rl={class:"doc-meta-row"},cl={class:"doc-source-pill"},vl={class:"doc-format-pill"},ml={key:0,class:"muted"},_l={class:"actions"},pl=["href"],fl=["onClick"],gl={key:4,class:"card mb-30"},yl={key:0,class:"loading-text"},bl={key:1,class:"form-grid"},hl={class:"form-group"},kl=["value"],wl={class:"form-group"},Cl=["value"],Sl={class:"form-group"},$l={class:"form-group"},Al=["value"],Tl={class:"form-group"},Ll={class:"form-group"},Ul={class:"form-actions"},Ml=["disabled"],jl={key:5,class:"stack"},xl={class:"card mb-30"},Dl={key:0,class:"loading-text"},Vl={key:1,class:"empty-state"},Pl={key:2,class:"table"},Rl={class:"card"},Fl={class:"form-row",style:{margin:"10px 0 6px"}},Nl=["disabled"],Ol={key:0,class:"loading-text"},El={key:1,class:"empty-state"},ql={key:2,class:"table mt-20"},Bl={key:0,class:"muted"},Hl={key:1,class:"muted"},Wl={key:0,class:"actions"},Il=["href"],Gl=["onClick"],Yl={key:1,class:"muted"},zl={key:6,class:"card"},Jl={key:0,class:"empty-state"},Ql={key:1,class:"review-list"},Zl={class:"info"},Kl={class:"student-name"},Xl={class:"email-text"},eo={class:"actions"},to=["onClick"],so=["onClick"],ao={key:0,class:"modal-overlay"},lo={class:"modal-box wide-modal"},oo={key:0,class:"comment-meta"},no={class:"form-row",style:{margin:"6px 0 0"}},io=["disabled"],uo={key:2,class:"loading-text"},ro={key:3,class:"empty-state"},co={key:4,class:"table mt-20"},vo={key:0,class:"muted"},mo={key:1,class:"muted"},_o={key:1,class:"modal-overlay"},po={class:"modal-box wide-modal"},fo={key:0,class:"comment-meta"},go={class:"comment-list"},yo={key:0,class:"loading-text"},bo={key:1,class:"empty-state"},ho={key:2},ko={class:"comment-head"},wo={class:"comment-author"},Co={class:"comment-time"},So={class:"comment-body"},$o={class:"modal-actions"},Ao=["disabled"],To={key:2,class:"modal-overlay"},Lo={class:"modal-box wide-modal"},Uo={key:0,class:"comment-meta"},Mo={class:"comment-list"},jo={key:0,class:"loading-text"},xo={key:1,class:"empty-state"},Do={key:2},Vo={class:"comment-head"},Po={class:"comment-author"},Ro={class:"comment-time"},Fo={class:"comment-body"},No={class:"modal-actions"},Oo=["disabled"],Eo={key:3,class:"modal-overlay"},qo={class:"modal-box wide-modal"},Bo={key:1,class:"form-grid"},Ho={class:"form-group full"},Wo={class:"form-group full"},Io={class:"form-group"},Go={class:"form-group"},Yo=["disabled"],zo={key:0,class:"form-group"},Jo=["value"],Qo={key:1,class:"form-group"},Zo=["disabled"],Ko=["value"],Xo={key:2,class:"form-group full"},en=["value"],tn={class:"modal-actions"},sn=["disabled"],an=["disabled"],ln={__name:"FacultyDashboardView",setup(on){const je=os(),me=d({}),k=d("research"),xe=d([]),De=d([]),Ve=d(!1),_e=d(!1),P=d(""),R=d(!0),Pe=d(!1),at=d([{major_code:"CS",major_name:"Computer Science"}]),Re=d({username:"",role:"faculty",email:"",major_code:"CS",major_name:"Computer Science"}),w=d({email:"",major_code:"CS",password:"",confirm:""}),Fe=d(!0),Ne=d([]),L=d(""),se=d({}),I=d(""),G=d(!0),pe=d([]),Y=d(!0),F=d([]),g=d({title:"",description:"",due_at:"",target_mode:"all",course_code:""}),ae=d([]),fe=d(null),ge=d(!1),N=d(""),O=d(!0),ye=d(!1),be=d([]),j=d(null),Oe=d(!1),le=d([]),z=d({}),J=d(""),q=d(""),Q=d(!0),oe=d(""),Ee=d(!1),m=d(null),ne=d(!1),A=d(""),T=d(!0),qe=d(!1),x=d(null),ie=d([]),Be=d(!1),B=d(""),he=d(!1),He=d(!0),ke=d([]),We=d([]),Ie=d(""),Ge=d([]),Z=d(""),D=d(!1),ue=d(""),de=d(!0),Ye=d(!1),K=d(""),we=d([]),Ce=d(!1),X=d(""),ee=d(!0),re=d(""),ze=d(!1),Je=d([]),Se=d(!1),lt=d([]),Qe=d(""),Ze=d(""),Ke=d(""),Xe=d(!1),V=d(null),ce=d([]),et=d(!1),H=d(""),$e=d(!1);ls(()=>{const a=localStorage.getItem("user");if(a){if(me.value=JSON.parse(a),me.value.role!=="faculty")return je.push("/dashboard");it(),ut(),st(),xt(),ve(),Ae(),Pt(),rt()}else je.push("/")});const tt=a=>`${ns}/download_document.php?doc_id=${a.doc_id}`,St=async()=>{var a;try{const t=await p.get("majors_list.php");((a=t.data)==null?void 0:a.status)==="success"&&Array.isArray(t.data.data)&&t.data.data.length>0&&(at.value=t.data.data)}catch{}},ot=async()=>{var e,i;const a=await p.get("profile_get.php");if(((e=a.data)==null?void 0:e.status)!=="success")throw new Error(((i=a.data)==null?void 0:i.message)||"Failed");const t=a.data.data||{};Re.value=t,w.value.email=t.email||"",w.value.major_code=t.major_code||"CS"},$t=async()=>{var a,t;if(k.value="profile",P.value="",R.value=!0,!Pe.value){Ve.value=!0;try{await Promise.all([St(),ot()]),Pe.value=!0}catch(e){R.value=!1,P.value=((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Failed to load profile."}finally{Ve.value=!1}}},At=async()=>{var a,t,e,i,n;if(P.value="",R.value=!0,w.value.password&&w.value.password!==w.value.confirm){R.value=!1,P.value="Passwords do not match.";return}_e.value=!0;try{const r=await p.post("profile_update.php",{email:w.value.email,major_code:w.value.major_code,password:w.value.password||""});((a=r.data)==null?void 0:a.status)==="success"?(R.value=!0,P.value=((t=r.data)==null?void 0:t.message)||"Saved.",w.value.password="",w.value.confirm="",await ot(),Pe.value=!0):(R.value=!1,P.value=((e=r.data)==null?void 0:e.message)||"Save failed.")}catch(r){R.value=!1,P.value=((n=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:n.message)||"Save failed."}finally{_e.value=!1}},nt=a=>{const t=URL.createObjectURL(a);window.open(t,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(t),6e4)},it=async()=>{try{const a=await p.get("faculty_get_mp_requests.php");a.data.status==="success"&&(xe.value=a.data.data)}catch(a){console.error(a)}},ut=async()=>{try{const a=await p.get("faculty_get_advisee_documents.php");a.data.status==="success"&&(De.value=a.data.data||[])}catch(a){console.error(a)}},st=async()=>{var a;Fe.value=!0;try{const t=await p.get("faculty_get_research_method_holds.php");((a=t.data)==null?void 0:a.status)==="success"&&(Ne.value=t.data.data||[])}catch(t){console.error(t)}finally{Fe.value=!1}},Tt=a=>{a!=null&&a.proof_doc_id&&Ue({doc_id:a.proof_doc_id,student_id:a.student_id,student_username:a.student_username,doc_type:"research_method_proof"})},dt=async(a,t)=>{var e,i,n,r,v,_;if(I.value="",G.value=!0,!(!(a!=null&&a.student_id)||!(a!=null&&a.proof_doc_id))){L.value=String(a.student_id);try{const y={student_id:a.student_id,doc_id:a.proof_doc_id,action:t,comment:String(((e=se.value)==null?void 0:e[a.student_id])||"")},U=await p.post("faculty_review_research_method_proof.php",y);((i=U.data)==null?void 0:i.status)==="success"?(G.value=!0,I.value=((n=U.data)==null?void 0:n.message)||"Saved.",se.value={...se.value,[a.student_id]:""},await st()):(G.value=!1,I.value=((r=U.data)==null?void 0:r.message)||"Action failed.")}catch(y){G.value=!1,I.value=((_=(v=y==null?void 0:y.response)==null?void 0:v.data)==null?void 0:_.message)||"Action failed."}finally{L.value=""}}},Lt=async()=>{var a;ze.value=!0;try{const t=await p.get("defense_windows_list.php");((a=t.data)==null?void 0:a.status)==="success"&&(Je.value=t.data.data||[])}catch(t){console.error(t)}finally{ze.value=!1}},rt=async()=>{var a;Se.value=!0;try{await Lt();const t=await p.get("faculty_get_thesis_projects.php");((a=t.data)==null?void 0:a.status)==="success"&&(lt.value=t.data.data||[])}catch(t){console.error(t)}finally{Se.value=!1}},ct=te(()=>{const a=(Qe.value||"").trim().toLowerCase(),t=lt.value||[];return a?t.filter(e=>[e.student_id,e.student_username,e.student_email,e.first_name,e.last_name,e.title,e.type,e.submission_date,e.defense_date].map(n=>String(n||"").toLowerCase()).join(" ").includes(a)):t}),Ut=te(()=>{const a=(De.value||[]).map(t=>String(t.entry_term_code||"").trim()).filter(t=>t!=="");return Array.from(new Set(a)).sort((t,e)=>e.localeCompare(t))}),vt=te(()=>{const a=(Ze.value||"").trim().toLowerCase(),t=(Ke.value||"").trim().toUpperCase();return(De.value||[]).filter(i=>t&&String(i.entry_term_code||"").toUpperCase()!==t?!1:a?[i.student_id,i.student_username,i.student_email,i.first_name,i.last_name,i.entry_term_code,i.doc_type,i.status,i.file_path].map(r=>String(r||"").toLowerCase()).join(" ").includes(a):!0)}),Mt=async a=>{a!=null&&a.thesis_doc_id&&await Ue({doc_id:a.thesis_doc_id,student_id:a.student_id,student_username:a.student_username,doc_type:"thesis_project",file_path:a.thesis_file_path,status:a.thesis_doc_status})},jt=async a=>{var t,e,i,n;L.value=String(a.student_id);try{const r=await p.post("faculty_lift_research_method_hold.php",{student_id:a.student_id});((t=r.data)==null?void 0:t.status)==="success"?(alert(`Hold lifted. Registrar code: ${r.data.registrar_code||"(none)"}`),await st()):alert(((e=r.data)==null?void 0:e.message)||"Lift failed")}catch(r){alert(((n=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:n.message)||"Network Error")}finally{L.value=""}},xt=async()=>{var a;try{const t=await p.get("faculty_assignment_options.php");((a=t.data)==null?void 0:a.status)==="success"&&(Y.value=!!t.data.courses_enabled,F.value=t.data.courses||[],pe.value=t.data.students||[])}catch(t){console.error(t)}},Dt=a=>{const t=String((a==null?void 0:a.first_name)||"").trim(),e=String((a==null?void 0:a.last_name)||"").trim(),i=`${t} ${e}`.trim(),n=String((a==null?void 0:a.username)||(a==null?void 0:a.student_username)||"").trim(),r=String((a==null?void 0:a.entry_term_code)||"").trim(),v=i||n||`#${(a==null?void 0:a.student_id)??""}`;return r?`${v} · ${r}`:v},E=d({course_code:"",student_id:""}),Vt=()=>{E.value={course_code:"",student_id:""}},Pt=async()=>{var a;try{const t=await p.get("get_courses.php");((a=t.data)==null?void 0:a.status)==="success"&&(Ge.value=t.data.data||[])}catch{}},Ae=async()=>{var a,t,e,i;ue.value="",de.value=!0;try{const n=await p.get("faculty_get_overview.php");((a=n.data)==null?void 0:a.status)==="success"?(He.value=!!n.data.faculty_courses_enabled,ke.value=n.data.taught_courses||[],We.value=n.data.advisees||[]):(de.value=!1,ue.value=((t=n.data)==null?void 0:t.message)||"Failed to load overview.")}catch(n){de.value=!1,ue.value=((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to load overview."}},Te=a=>{const t=String((a==null?void 0:a.first_name)||"").trim(),e=String((a==null?void 0:a.last_name)||"").trim();return`${t} ${e}`.trim()||(a==null?void 0:a.student_username)||"Student"},mt=te(()=>{const a=Ie.value.trim().toLowerCase(),t=Array.isArray(We.value)?[...We.value]:[],e=n=>a?[Te(n),n==null?void 0:n.student_username,n==null?void 0:n.student_email,String((n==null?void 0:n.student_id)??""),n==null?void 0:n.entry_term_code,n==null?void 0:n.mp_status].filter(Boolean).join(" ").toLowerCase().includes(a):!0,i=n=>{const r=String((n==null?void 0:n.first_name)||"").trim(),v=String((n==null?void 0:n.student_username)||"").trim();return(r||v).charAt(0).toUpperCase()||"Z"};return t.filter(e).sort((n,r)=>{const v=i(n),_=i(r);return v!==_?v.localeCompare(_):Te(n).localeCompare(Te(r))})}),Rt=async()=>{var a,t,e,i;if(Z.value){D.value=!0;try{const n=await p.post("faculty_add_teaching_course.php",{course_code:Z.value});((a=n.data)==null?void 0:a.status)==="success"?(Z.value="",await Ae()):alert(((t=n.data)==null?void 0:t.message)||"Failed")}catch(n){alert(((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed")}finally{D.value=!1}}},Ft=async a=>{var t,e,i,n;D.value=!0;try{const r=await p.post("faculty_remove_teaching_course.php",{course_code:a});((t=r.data)==null?void 0:t.status)==="success"?await Ae():alert(((e=r.data)==null?void 0:e.message)||"Failed")}catch(r){alert(((n=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed")}finally{D.value=!1}},Nt=a=>{const t=String((a==null?void 0:a.first_name)||"").trim(),e=String((a==null?void 0:a.last_name)||"").trim();return`${t} ${e}`.trim()||(a==null?void 0:a.username)||"Student"},_t=te(()=>{const a=(re.value||"").trim().toLowerCase(),t=we.value||[];return a?t.filter(e=>[e.username,e.email,e.first_name,e.last_name,e.entry_term_code,String(e.term_number??"")].map(n=>String(n||"").toLowerCase()).join(" ").includes(a)):t}),pt=async()=>{var a,t,e,i;if(K.value){Ce.value=!0,X.value="",ee.value=!0;try{const n=await p.get(`faculty_get_course_students.php?course_code=${encodeURIComponent(K.value)}`);((a=n.data)==null?void 0:a.status)==="success"?we.value=n.data.data||[]:(ee.value=!1,X.value=((t=n.data)==null?void 0:t.message)||"Failed to load students.")}catch(n){ee.value=!1,X.value=((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to load students."}finally{Ce.value=!1}}},Ot=async a=>{K.value=String((a==null?void 0:a.course_code)||""),we.value=[],re.value="",Ye.value=!0,await pt()},Et=()=>{Ye.value=!1,K.value="",we.value=[],re.value="",X.value="",ee.value=!0},ve=async()=>{var a;ye.value=!0;try{const t=await p.get("faculty_list_assignments.php");((a=t.data)==null?void 0:a.status)==="success"&&(be.value=t.data.data||[])}catch(t){console.error(t)}finally{ye.value=!1}},qt=a=>{var t,e;fe.value=((e=(t=a==null?void 0:a.target)==null?void 0:t.files)==null?void 0:e[0])??null},Bt=async()=>{var a,t,e,i;if(N.value="",O.value=!0,!g.value.title.trim()){O.value=!1,N.value="Title is required.";return}if(g.value.target_mode==="course"&&!g.value.course_code){O.value=!1,N.value="Please select a course.";return}if(g.value.target_mode==="students"&&ae.value.length===0){O.value=!1,N.value="Please select at least one student.";return}ge.value=!0;try{const n=new FormData;n.append("title",g.value.title),n.append("description",g.value.description||""),n.append("due_at",g.value.due_at||""),n.append("target_mode",g.value.target_mode),n.append("course_code",g.value.course_code||""),n.append("student_ids",JSON.stringify(ae.value)),fe.value&&n.append("file",fe.value);const r=await p.post("faculty_create_assignment.php",n);((a=r.data)==null?void 0:a.status)==="success"?(O.value=!0,N.value="Assignment published.",g.value.title="",g.value.description="",g.value.due_at="",g.value.target_mode="all",g.value.course_code="",ae.value=[],fe.value=null,await ve()):(O.value=!1,N.value=((t=r.data)==null?void 0:t.message)||"Create failed.")}catch(n){O.value=!1,N.value=((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"Create failed."}finally{ge.value=!1}},Ht=a=>{var r,v;const t=a||[];if(t.some(_=>_.target_type==="all"))return"Target: All students";const e=(r=t.find(_=>_.target_type==="course"))==null?void 0:r.target_value;if(e){const _=Wt(e);return _?`Target: Course ${_}`:`Target: Course ${e}`}const i=(v=t.find(_=>_.target_type==="cohort"))==null?void 0:v.target_value;return i?`Target: Cohort ${i}`:`Target: ${t.filter(_=>_.target_type==="student").length} student(s)`},Wt=a=>{const t=String(a||"").trim();if(!t)return"";const e=[F.value||[],Ge.value||[],ke.value||[]];for(const i of e){const n=i.find(r=>String((r==null?void 0:r.course_code)||(r==null?void 0:r.courseCode)||"").trim()===t);if(n){const r=String(n.course_name||n.courseName||"").trim();return r?`${t} · ${r}`:t}}return t},ft=te(()=>{const a=String(E.value.course_code||"").trim(),t=String(E.value.student_id||"").trim(),e=be.value||[];return!a&&!t?e:e.filter(i=>{var Ct;const n=i.targets||[],r=(Ct=n.find(W=>W.target_type==="course"))==null?void 0:Ct.target_value,v=n.filter(W=>W.target_type==="student").map(W=>String(W.target_value||"")).filter(Boolean),_=n.some(W=>W.target_type==="all"),y=!a||String(r||"")===a,U=!t||_||v.includes(t);return y&&U})}),gt=async a=>{var t,e,i;j.value=a,le.value=[],z.value={},q.value="",oe.value="",Oe.value=!0;try{const n=await p.get(`faculty_get_assignment_submissions.php?assignment_id=${a.id}`);if(((t=n.data)==null?void 0:t.status)==="success"){le.value=n.data.data||[];const r={};for(const v of le.value)v.submission_id&&(r[v.submission_id]=v.grade??"");z.value=r}}catch(n){oe.value=((i=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to load submissions"}finally{Oe.value=!1}},It=a=>{if(!a)return"";const t=String(a).trim();return t?t.includes("T")?t.slice(0,16):t.includes(" ")?t.replace(" ","T").slice(0,16):t:""},Gt=a=>{var v,_;A.value="",T.value=!0;const t=a.targets||[];let e="all",i="",n="",r=[];t.some(y=>y.target_type==="all")?e="all":t.some(y=>y.target_type==="course")?(e="course",i=((v=t.find(y=>y.target_type==="course"))==null?void 0:v.target_value)||""):t.some(y=>y.target_type==="cohort")?(e="cohort",n=((_=t.find(y=>y.target_type==="cohort"))==null?void 0:_.target_value)||""):(e="students",r=t.filter(y=>y.target_type==="student").map(y=>String(y.target_value||"")).filter(Boolean)),m.value={assignment_id:a.id,title:a.title||"",description:a.description||"",due_at:It(a.due_at),target_mode:e,course_code:i,cohort_term_code:n,student_ids:r},Ee.value=!0},yt=()=>{Ee.value=!1,m.value=null,A.value="",T.value=!0},Yt=async()=>{var t,e,i,n,r;if(!m.value)return;if(A.value="",T.value=!0,!(m.value.title||"").trim()){T.value=!1,A.value="Title is required.";return}if(m.value.target_mode==="course"&&!m.value.course_code){T.value=!1,A.value="Please select a course.";return}if(m.value.target_mode==="cohort"&&!m.value.cohort_term_code){T.value=!1,A.value="Missing cohort term code (legacy). Please switch target to Course or Students.";return}if(m.value.target_mode==="students"&&(!m.value.student_ids||m.value.student_ids.length===0)){T.value=!1,A.value="Please select at least one student.";return}ne.value=!0;try{const v=await p.post("faculty_update_assignment.php",{assignment_id:m.value.assignment_id,title:m.value.title,description:m.value.description,due_at:m.value.due_at||"",target_mode:m.value.target_mode,course_code:m.value.course_code||"",cohort_term_code:m.value.cohort_term_code||"",student_ids:m.value.student_ids||[]});((t=v.data)==null?void 0:t.status)==="success"?(T.value=!0,A.value=((e=v.data)==null?void 0:e.message)||"Saved.",await ve(),j.value&&j.value.id===m.value.assignment_id&&(j.value=be.value.find(_=>_.id===m.value.assignment_id)||j.value),yt()):(T.value=!1,A.value=((i=v.data)==null?void 0:i.message)||"Save failed.")}catch(v){T.value=!1,A.value=((r=(n=v==null?void 0:v.response)==null?void 0:n.data)==null?void 0:r.message)||"Save failed."}finally{ne.value=!1}},zt=async a=>{var t,e,i,n,r;if(confirm(`Delete assignment "${a.title}" (#${a.id})? This will also delete submissions.`))try{const v=await p.post("faculty_delete_assignment.php",{assignment_id:a.id});((t=v.data)==null?void 0:t.status)==="success"?(await ve(),((e=j.value)==null?void 0:e.id)===a.id&&(j.value=null,le.value=[],oe.value="")):alert(((i=v.data)==null?void 0:i.message)||"Delete failed")}catch(v){alert(((r=(n=v==null?void 0:v.response)==null?void 0:n.data)==null?void 0:r.message)||"Delete failed")}},bt=(a,t)=>{z.value={...z.value,[a]:t}},ht=async a=>{var t,e,i,n,r,v;if(a!=null&&a.submission_id){J.value=String(a.submission_id),q.value="",Q.value=!0;try{const _=(t=z.value)==null?void 0:t[a.submission_id],y={submission_id:a.submission_id,grade:_===""?null:_},U=await p.post("faculty_grade_assignment_submission.php",y);((e=U.data)==null?void 0:e.status)==="success"?(q.value=((i=U.data)==null?void 0:i.message)||"Saved.",Q.value=!0,a.grade=U.data.grade,a.graded_at=U.data.graded_at??null):(q.value=((n=U.data)==null?void 0:n.message)||"Save failed.",Q.value=!1)}catch(_){q.value=((v=(r=_==null?void 0:_.response)==null?void 0:r.data)==null?void 0:v.message)||"Save failed.",Q.value=!1}finally{J.value=""}}},Jt=async a=>{a!=null&&a.submission_id&&(bt(a.submission_id,""),await ht(a))},Qt=async a=>{try{const t=await p.get(`download_assignment_file.php?assignment_id=${a.id}`,{responseType:"blob"});nt(t.data)}catch{alert("Download failed")}},Zt=async a=>{if(a.submission_id)try{const t=await p.get(`download_assignment_submission.php?submission_id=${a.submission_id}`,{responseType:"blob"});nt(t.data)}catch{alert("Download failed")}},kt=async a=>{var t;x.value=a,qe.value=!0,B.value="",ie.value=[],Be.value=!0;try{const e=await p.get(`assignment_submission_comments_list.php?submission_id=${a.submission_id}`);((t=e.data)==null?void 0:t.status)==="success"&&(ie.value=e.data.data||[])}finally{Be.value=!1}},Kt=()=>{qe.value=!1,x.value=null,ie.value=[],B.value=""},Xt=async()=>{var a,t,e,i,n;if((a=x.value)!=null&&a.submission_id){he.value=!0;try{const r=await p.post("faculty_add_submission_comment.php",{submission_id:x.value.submission_id,comment:B.value});((t=r.data)==null?void 0:t.status)==="success"?(B.value="",await kt(x.value),await gt(j.value)):alert(((e=r.data)==null?void 0:e.message)||"Failed to post comment")}catch(r){alert(((n=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to post comment")}finally{he.value=!1}}},Le=a=>`${a.first_name||""} ${a.last_name||""}`.trim()||a.student_username||"Student",wt=async(a,t)=>{if(confirm(`Are you sure you want to ${t.toUpperCase()} ${Le(a)}?`))try{const e=await p.post("faculty_respond_mp.php",{student_id:a.student_id,action:t});e.data.status==="success"?(alert("Success: "+e.data.message),it()):alert(e.data.message||"Failed")}catch{alert("Network Error")}},Ue=async a=>{var t,e;V.value=a,Xe.value=!0,H.value="",ce.value=[],et.value=!0;try{const i=await p.get(`document_comments_list.php?doc_id=${a.doc_id}`);i.data.status==="success"?ce.value=i.data.data||[]:alert(i.data.message||"Failed to load comments")}catch(i){alert(((e=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to load comments")}finally{et.value=!1}},es=()=>{Xe.value=!1,V.value=null,ce.value=[],H.value=""},ts=async()=>{var a,t;if(V.value){$e.value=!0;try{const e=await p.post("document_comments_add.php",{doc_id:V.value.doc_id,comment:H.value});e.data.status==="success"?(H.value="",await Ue(V.value)):alert(e.data.message||"Failed to post comment")}catch(e){alert(((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to post comment")}finally{$e.value=!1}}},ss=async()=>{try{await p.post("logout.php")}catch{}localStorage.removeItem("user"),je.push("/")};return(a,t)=>(o(),l("div",cs,[s("header",vs,[t[32]||(t[32]=s("div",{class:"brand"},"Grad System (Faculty Portal)",-1)),s("div",ms,[me.value.username?(o(),l("span",_s,"Prof. "+u(me.value.username),1)):c("",!0),s("button",{onClick:ss,class:"btn-logout"},"Logout")])]),s("div",ps,[s("aside",fs,[s("nav",null,[s("ul",null,[s("li",{class:S({active:k.value==="research"}),onClick:t[0]||(t[0]=e=>k.value="research")},"Research Hold",2),s("li",{class:S({active:k.value==="overview"}),onClick:t[1]||(t[1]=e=>k.value="overview")},"My Teaching",2),s("li",{class:S({active:k.value==="assignments"}),onClick:t[2]||(t[2]=e=>k.value="assignments")},"Assignments",2),s("li",{class:S({active:k.value==="docs"}),onClick:t[3]||(t[3]=e=>k.value="docs")},"Advisee Docs",2),s("li",{class:S({active:k.value==="thesis"}),onClick:t[4]||(t[4]=e=>k.value="thesis")},"Thesis / Project",2),s("li",{class:S({active:k.value==="mp"}),onClick:t[5]||(t[5]=e=>k.value="mp")},"MP Requests",2),s("li",{class:S({active:k.value==="profile"}),onClick:$t},"Profile",2)])])]),s("main",gs,[k.value==="research"?(o(),l("div",ys,[t[35]||(t[35]=s("h2",null,"Research Method Hold Check (Term 3)",-1)),t[36]||(t[36]=s("p",{class:"subtitle"},[$(" You can lift the "),s("strong",null,"research_method"),$(" hold only after the student has registered/taken the Research Method course. ")],-1)),I.value?(o(),l("div",{key:0,class:S(["msg",{ok:G.value,bad:!G.value}])},u(I.value),3)):c("",!0),Fe.value?(o(),l("div",bs,"Loading...")):Ne.value.length===0?(o(),l("div",hs,"No active research_method holds for your advisees.")):(o(),l("div",ks,[(o(!0),l(b,null,h(Ne.value,e=>(o(),l("div",{key:`${e.student_id}-${e.term_code||""}`,class:"review-item"},[s("div",ws,[s("span",Cs,u(e.student_username||`#${e.student_id}`),1),s("span",Ss,[$(" Hold: research_method · Term: "+u(e.term_code||"-")+" · Research Method: ",1),s("strong",null,u(Number(e.has_research_method)?"YES":"NO"),1)]),e.proof_doc_id?(o(),l("span",$s,[t[33]||(t[33]=$(" Proof uploaded: ",-1)),s("strong",null,u(String(e.proof_status||"pending")),1),e.proof_upload_date?(o(),l("span",As," · "+u(e.proof_upload_date),1)):c("",!0)])):c("",!0),e.proof_comment?(o(),l("span",Ts,[t[34]||(t[34]=$(" Reviewer comment: ",-1)),s("span",Ls,u(e.proof_comment),1)])):c("",!0),e.proof_doc_id?(o(),l("div",Us,[f(s("input",{"onUpdate:modelValue":i=>se.value[e.student_id]=i,class:"select",type:"text",placeholder:"Optional comment (visible to student)..."},null,8,Ms),[[C,se.value[e.student_id]]])])):c("",!0)]),s("div",js,[e.proof_doc_id?(o(),l("a",{key:0,href:tt({doc_id:e.proof_doc_id}),target:"_blank",class:"btn-view"},"View Proof",8,xs)):c("",!0),e.proof_doc_id?(o(),l("button",{key:1,class:"btn-view",onClick:i=>Tt(e),disabled:L.value===String(e.student_id)}," Comments ",8,Ds)):c("",!0),e.proof_doc_id?(o(),l("button",{key:2,class:"btn-approve",onClick:i=>dt(e,"approve"),disabled:L.value===String(e.student_id)},u(L.value===String(e.student_id)?"Working...":"Approve"),9,Vs)):c("",!0),e.proof_doc_id?(o(),l("button",{key:3,class:"btn-reject",onClick:i=>dt(e,"reject"),disabled:L.value===String(e.student_id)},u(L.value===String(e.student_id)?"Working...":"Reject"),9,Ps)):(o(),l("button",{key:4,class:"btn-approve",onClick:i=>jt(e),disabled:!Number(e.has_research_method)||L.value===String(e.student_id),title:Number(e.has_research_method)?"":"Student must register Research Method first."},u(L.value===String(e.student_id)?"Working...":"Lift Hold"),9,Rs))])]))),128))]))])):k.value==="overview"?(o(),l("div",Fs,[s("div",Ns,[t[40]||(t[40]=s("h2",null,"My Teaching Courses",-1)),He.value?ue.value?(o(),l("div",{key:1,class:S(["msg",{ok:de.value,bad:!de.value}])},u(ue.value),3)):c("",!0):(o(),l("div",Os,[...t[37]||(t[37]=[$(" Teaching courses table not found. Run ",-1),s("code",null,"backend/sql/10_faculty_courses.sql",-1),$(" in MySQL. ",-1)])])),s("div",Es,[f(s("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>Z.value=e),class:"select"},[t[38]||(t[38]=s("option",{disabled:"",value:""},"-- Select a course to add --",-1)),(o(!0),l(b,null,h(Ge.value,e=>(o(),l("option",{key:e.course_code,value:e.course_code},u(e.course_code)+" · "+u(e.course_name)+" ("+u(e.credits)+") ",9,qs))),128))],512),[[M,Z.value]]),s("button",{class:"btn-approve",onClick:Rt,disabled:!Z.value||!He.value||D.value},u(D.value?"Working...":"Add"),9,Bs)]),ke.value.length===0?(o(),l("div",Hs,"No courses added.")):(o(),l("div",Ws,[t[39]||(t[39]=s("div",{class:"row header"},[s("div",null,"Course"),s("div",null,"Name"),s("div",null,"Credits"),s("div")],-1)),(o(!0),l(b,null,h(ke.value,e=>(o(),l("div",{key:e.course_code,class:"row"},[s("div",null,[s("strong",null,u(e.course_code),1)]),s("div",null,u(e.course_name||"-"),1),s("div",null,u(e.credits||"-"),1),s("div",Is,[s("button",{class:"btn-view",onClick:i=>Ot(e),disabled:D.value},"Students",8,Gs),s("button",{class:"btn-reject",onClick:i=>Ft(e.course_code),disabled:D.value},"Remove",8,Ys)])]))),128))]))]),s("div",zs,[t[42]||(t[42]=s("h2",null,"My Advisees",-1)),s("div",Js,[f(s("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>Ie.value=e),class:"select",type:"text",placeholder:"Search by name / username / email / id..."},null,512),[[C,Ie.value]]),s("button",{class:"btn-view",onClick:Ae,disabled:D.value},"Refresh",8,Qs)]),mt.value.length===0?(o(),l("div",Zs,"No advisees found.")):(o(),l("div",Ks,[t[41]||(t[41]=s("div",{class:"row header"},[s("div",null,"Student"),s("div",null,"Email"),s("div",null,"Cohort"),s("div",null,"Status")],-1)),(o(!0),l(b,null,h(mt.value,e=>(o(),l("div",{key:e.student_id,class:"row"},[s("div",null,[s("strong",null,u(Te(e)),1)]),s("div",null,u(e.student_email||"-"),1),s("div",null,u(e.entry_term_code||"-"),1),s("div",null,u(e.mp_status),1)]))),128))]))])])):k.value==="assignments"?(o(),l("div",Xs,[s("div",ea,[t[55]||(t[55]=s("h2",null,"Create Assignment",-1)),s("div",ta,[s("div",sa,[t[43]||(t[43]=s("label",null,"Title",-1)),f(s("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>g.value.title=e),type:"text",placeholder:"e.g. HW1: Reading Summary"},null,512),[[C,g.value.title]])]),s("div",aa,[t[44]||(t[44]=s("label",null,"Due (optional)",-1)),f(s("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>g.value.due_at=e),type:"datetime-local"},null,512),[[C,g.value.due_at]])]),s("div",la,[t[45]||(t[45]=s("label",null,"Description (optional)",-1)),f(s("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>g.value.description=e),rows:"4",placeholder:"Details..."},null,512),[[C,g.value.description]])]),s("div",oa,[t[48]||(t[48]=s("label",null,"Target",-1)),f(s("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>g.value.target_mode=e)},[t[46]||(t[46]=s("option",{value:"all"},"All Students",-1)),s("option",{value:"course",disabled:!Y.value||F.value.length===0},"Course",8,na),t[47]||(t[47]=s("option",{value:"students"},"Selected Students",-1))],512),[[M,g.value.target_mode]])]),g.value.target_mode==="course"?(o(),l("div",ia,[t[51]||(t[51]=s("label",null,"Course",-1)),Y.value?c("",!0):(o(),l("div",ua,[...t[49]||(t[49]=[$(" Teaching courses table not found. Add courses in ",-1),s("strong",null,"My Teaching",-1),$(" first. ",-1)])])),f(s("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>g.value.course_code=e),disabled:!Y.value||F.value.length===0},[t[50]||(t[50]=s("option",{disabled:"",value:""},"-- Select Course --",-1)),(o(!0),l(b,null,h(F.value,e=>(o(),l("option",{key:e.course_code,value:e.course_code},u(e.course_code)+u(e.course_name?` · ${e.course_name}`:""),9,ra))),128))],8,da),[[M,g.value.course_code]])])):c("",!0),g.value.target_mode==="students"?(o(),l("div",ca,[t[52]||(t[52]=s("label",null,"Students",-1)),f(s("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>ae.value=e),multiple:"",class:"multi"},[(o(!0),l(b,null,h(pe.value,e=>(o(),l("option",{key:e.student_id,value:String(e.student_id)},u(e.username)+" "+u(e.entry_term_code?`· ${e.entry_term_code}`:""),9,va))),128))],512),[[M,ae.value]]),t[53]||(t[53]=s("div",{class:"hint"},"Hold Ctrl/Cmd to select multiple.",-1))])):c("",!0),s("div",ma,[t[54]||(t[54]=s("label",null,"Attachment (optional)",-1)),s("input",{type:"file",onChange:qt},null,32)])]),s("div",_a,[s("button",{class:"btn-approve",onClick:Bt,disabled:ge.value},u(ge.value?"Creating...":"Publish Assignment"),9,pa)]),N.value?(o(),l("div",{key:0,class:S(["msg",{ok:O.value,bad:!O.value}])},u(N.value),3)):c("",!0)]),s("div",fa,[t[59]||(t[59]=s("h2",null,"My Assignments",-1)),s("div",ga,[f(s("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>E.value.course_code=e),class:"select",style:{"min-width":"320px"}},[t[56]||(t[56]=s("option",{value:""},"All courses",-1)),(o(!0),l(b,null,h(F.value,e=>(o(),l("option",{key:e.course_code,value:e.course_code},u(e.course_name?`${e.course_name} (${e.course_code})`:e.course_code),9,ya))),128))],512),[[M,E.value.course_code]]),f(s("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>E.value.student_id=e),class:"select",style:{"min-width":"320px"}},[t[57]||(t[57]=s("option",{value:""},"All students",-1)),(o(!0),l(b,null,h(pe.value,e=>(o(),l("option",{key:e.student_id,value:String(e.student_id)},u(Dt(e)),9,ba))),128))],512),[[M,E.value.student_id]]),s("button",{class:"btn-view",onClick:Vt,disabled:!E.value.course_code&&!E.value.student_id}," Clear ",8,ha),s("button",{class:"btn-view",onClick:ve,disabled:ye.value},"Refresh",8,ka)]),ye.value?(o(),l("div",wa,"Loading...")):be.value.length===0?(o(),l("div",Ca,"No assignments yet.")):(o(),l("div",Sa,[ft.value.length===0?(o(),l("div",$a,"No assignments match your filters.")):c("",!0),(o(!0),l(b,null,h(ft.value,e=>(o(),l("div",{key:e.id,class:"review-item"},[s("div",Aa,[s("span",Ta,u(e.title),1),s("span",La,[$(" Created: "+u(e.created_at)+" ",1),e.due_at?(o(),l("span",Ua,"· Due: "+u(e.due_at),1)):c("",!0),t[58]||(t[58]=$(" · Submissions: ",-1)),s("strong",null,u(e.submissions_count),1)]),s("span",Ma,u(Ht(e.targets)),1)]),s("div",ja,[s("button",{class:"btn-view",onClick:i=>gt(e)},"View",8,xa),e.attachment_path?(o(),l("button",{key:0,class:"btn-view",onClick:i=>Qt(e)},"Attachment",8,Da)):c("",!0),s("button",{class:"btn-view",onClick:i=>Gt(e)},"Edit",8,Va),s("button",{class:"btn-reject",onClick:i=>zt(e)},"Delete",8,Pa)])]))),128))]))]),j.value?(o(),l("div",Ra,[s("h2",null,"Submissions · "+u(j.value.title),1),oe.value?(o(),l("div",Fa,u(oe.value),1)):c("",!0),Oe.value?(o(),l("div",Na,"Loading submissions...")):(o(),l("div",Oa,[(o(!0),l(b,null,h(le.value,e=>(o(),l("div",{key:e.student_id,class:"review-item"},[s("div",Ea,[s("span",qa,u(Le(e)),1),s("span",Ba,[$(u(e.submission_id?`Submitted: ${e.submitted_at}`:"Not submitted yet.")+" ",1),e.entry_term_code?(o(),l("span",Ha,"· Cohort: "+u(e.entry_term_code),1)):c("",!0)]),e.submission_id?(o(),l("span",Wa,[t[60]||(t[60]=$(" Grade: ",-1)),e.grade!==null&&e.grade!==void 0?(o(),l("strong",Ia,u(e.grade),1)):(o(),l("span",Ga,"-")),e.graded_at?(o(),l("span",Ya," · graded_at: "+u(e.graded_at),1)):c("",!0)])):c("",!0)]),s("div",za,[e.submission_id?(o(),l("button",{key:0,class:"btn-view",onClick:i=>Zt(e)},"Download",8,Ja)):c("",!0),e.submission_id?(o(),l("button",{key:1,class:"btn-view",onClick:i=>kt(e)}," Comments ("+u(Number(e.comments_count||0))+") ",9,Qa)):c("",!0),e.submission_id?(o(),l("div",Za,[s("input",{class:"grade-input",type:"number",min:"0",max:"100",step:"0.01",value:z.value[e.submission_id]??"",placeholder:"0-100",onInput:i=>{var n;return bt(e.submission_id,(n=i==null?void 0:i.target)==null?void 0:n.value)},disabled:J.value===String(e.submission_id)},null,40,Ka),s("button",{class:"btn-approve",onClick:i=>ht(e),disabled:J.value===String(e.submission_id)},u(J.value===String(e.submission_id)?"Saving...":"Save"),9,Xa),s("button",{class:"btn-reject",onClick:i=>Jt(e),disabled:J.value===String(e.submission_id)}," Clear ",8,el)])):c("",!0)])]))),128))])),q.value?(o(),l("div",{key:3,class:S(["msg",{ok:Q.value,bad:!Q.value}])},u(q.value),3)):c("",!0)])):c("",!0)])):k.value==="docs"?(o(),l("div",tl,[t[62]||(t[62]=s("h2",null,"My Advisee Documents",-1)),t[63]||(t[63]=s("p",{class:"subtitle"},"Documents submitted by students who selected you as their Major Professor.",-1)),s("div",sl,[f(s("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>Ze.value=e),class:"select",type:"text",placeholder:"Search by name / username / email / id..."},null,512),[[C,Ze.value]]),f(s("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>Ke.value=e),class:"select",style:{"min-width":"220px"}},[t[61]||(t[61]=s("option",{value:""},"All terms",-1)),(o(!0),l(b,null,h(Ut.value,e=>(o(),l("option",{key:e,value:e},u(e),9,al))),128))],512),[[M,Ke.value]]),s("button",{class:"btn-view",onClick:ut,disabled:D.value},"Refresh",8,ll)]),vt.value.length===0?(o(),l("div",ol,"No advisee documents.")):(o(),l("div",nl,[(o(!0),l(b,null,h(vt.value,e=>(o(),l("div",{key:e.doc_id,class:"review-item"},[s("div",il,[s("span",ul,[$(u(Le(e))+" ",1),e.entry_term_code?(o(),l("span",dl,"· "+u(e.entry_term_code),1)):c("",!0)]),s("div",rl,[s("span",cl,u(Me(is)(e.doc_type)),1),s("span",vl,u(Me(us)(e.file_path)),1),s("span",{class:S(["doc-status-pill",Me(ds)(e.status)])},u(Me(rs)(e.status)),3),e.upload_date?(o(),l("span",ml,"· "+u(e.upload_date),1)):c("",!0)])]),s("div",_l,[s("a",{href:tt(e),target:"_blank",class:"btn-view"},"View",8,pl),s("button",{class:"btn-view",onClick:i=>Ue(e)},"Comments",8,fl)])]))),128))]))])):k.value==="profile"?(o(),l("div",gl,[t[70]||(t[70]=s("h2",null,"My Profile",-1)),Ve.value?(o(),l("div",yl,"Loading...")):(o(),l("div",bl,[P.value?(o(),l("div",{key:0,class:S(["msg",{ok:R.value,bad:!R.value}])},u(P.value),3)):c("",!0),s("div",hl,[t[64]||(t[64]=s("label",null,"Username",-1)),s("input",{value:Re.value.username,disabled:""},null,8,kl)]),s("div",wl,[t[65]||(t[65]=s("label",null,"Role",-1)),s("input",{value:Re.value.role,disabled:""},null,8,Cl)]),s("div",Sl,[t[66]||(t[66]=s("label",null,"Email",-1)),f(s("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>w.value.email=e),type:"email",placeholder:"Optional"},null,512),[[C,w.value.email]])]),s("div",$l,[t[67]||(t[67]=s("label",null,"Major / Program",-1)),f(s("select",{"onUpdate:modelValue":t[19]||(t[19]=e=>w.value.major_code=e)},[(o(!0),l(b,null,h(at.value,e=>(o(),l("option",{key:e.major_code,value:e.major_code},u(e.major_name),9,Al))),128))],512),[[M,w.value.major_code]])]),s("div",Tl,[t[68]||(t[68]=s("label",null,"New Password",-1)),f(s("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>w.value.password=e),type:"password",placeholder:"Leave blank to keep current password"},null,512),[[C,w.value.password]])]),s("div",Ll,[t[69]||(t[69]=s("label",null,"Confirm Password",-1)),f(s("input",{"onUpdate:modelValue":t[21]||(t[21]=e=>w.value.confirm=e),type:"password",placeholder:"Re-enter new password"},null,512),[[C,w.value.confirm]])]),s("div",Ul,[s("button",{class:"btn-approve",onClick:At,disabled:_e.value},u(_e.value?"Saving...":"Save Changes"),9,Ml)])]))])):k.value==="thesis"?(o(),l("div",jl,[s("div",xl,[t[72]||(t[72]=s("h2",null,"Defense Window (Admin-published)",-1)),ze.value?(o(),l("div",Dl,"Loading...")):Je.value.length===0?(o(),l("div",Vl,"No defense windows published yet.")):(o(),l("div",Pl,[t[71]||(t[71]=s("div",{class:"row header defense-row"},[s("div",null,"Year"),s("div",null,"Start"),s("div",null,"End")],-1)),(o(!0),l(b,null,h(Je.value,e=>(o(),l("div",{key:e.year,class:"row defense-row"},[s("div",null,[s("strong",null,u(e.year),1)]),s("div",null,u(e.start_date),1),s("div",null,u(e.end_date),1)]))),128))]))]),s("div",Rl,[t[74]||(t[74]=s("h2",null,"Advisee Thesis / Project Timeline",-1)),s("div",Fl,[f(s("input",{"onUpdate:modelValue":t[22]||(t[22]=e=>Qe.value=e),class:"select",type:"text",placeholder:"Search advisees..."},null,512),[[C,Qe.value]]),s("button",{class:"btn-view",onClick:rt,disabled:Se.value},"Refresh",8,Nl)]),Se.value?(o(),l("div",Ol,"Loading...")):ct.value.length===0?(o(),l("div",El,"No data.")):(o(),l("div",ql,[t[73]||(t[73]=s("div",{class:"row header thesis-row"},[s("div",null,"Student"),s("div",null,"Term"),s("div",null,"Type"),s("div",null,"Submission"),s("div",null,"Defense"),s("div",null,"File"),s("div",null,"Title")],-1)),(o(!0),l(b,null,h(ct.value,e=>(o(),l("div",{key:e.student_id,class:"row thesis-row"},[s("div",null,[s("strong",null,u(e.student_username||`#${e.student_id}`),1)]),s("div",null,[e.term_number?(o(),l("span",Bl,"Term "+u(e.term_number),1)):(o(),l("span",Hl,"-"))]),s("div",null,u(e.type||"-"),1),s("div",null,u(e.submission_date||"-"),1),s("div",null,u(e.defense_date||"-"),1),s("div",null,[e.thesis_doc_id?(o(),l("div",Wl,[s("a",{href:tt({doc_id:e.thesis_doc_id}),target:"_blank",class:"btn-view"},"View",8,Il),s("button",{class:"btn-view",onClick:i=>Mt(e)},"Comments",8,Gl)])):(o(),l("span",Yl,"-"))]),s("div",null,u(e.title||"-"),1)]))),128))]))])])):(o(),l("div",zl,[t[75]||(t[75]=s("h2",null,"Major Professor Requests",-1)),t[76]||(t[76]=s("p",{class:"subtitle"},"Students requesting you as their advisor.",-1)),xe.value.length===0?(o(),l("div",Jl,"No new advising requests.")):(o(),l("div",Ql,[(o(!0),l(b,null,h(xe.value,e=>(o(),l("div",{key:e.student_id,class:"review-item highlight-item"},[s("div",Zl,[s("span",Kl,u(Le(e)),1),s("span",Xl,u(e.email),1)]),s("div",eo,[s("button",{onClick:i=>wt(e,"reject"),class:"btn-reject"},"Decline",8,to),s("button",{onClick:i=>wt(e,"accept"),class:"btn-approve"},"Accept Student",8,so)])]))),128))]))]))])]),Ye.value?(o(),l("div",ao,[s("div",lo,[t[78]||(t[78]=s("h3",null,"Course Students",-1)),K.value?(o(),l("div",oo,[s("strong",null,u(K.value),1)])):c("",!0),s("div",no,[f(s("input",{"onUpdate:modelValue":t[23]||(t[23]=e=>re.value=e),class:"select",type:"text",placeholder:"Search students..."},null,512),[[C,re.value]]),s("button",{class:"btn-view",onClick:pt,disabled:Ce.value},"Refresh",8,io)]),X.value?(o(),l("div",{key:1,class:S(["msg",{ok:ee.value,bad:!ee.value}])},u(X.value),3)):c("",!0),Ce.value?(o(),l("div",uo,"Loading...")):_t.value.length===0?(o(),l("div",ro,"No students found.")):(o(),l("div",co,[t[77]||(t[77]=s("div",{class:"row header roster-row"},[s("div",null,"Student"),s("div",null,"Email"),s("div",null,"Cohort"),s("div",null,"Term")],-1)),(o(!0),l(b,null,h(_t.value,e=>(o(),l("div",{key:e.student_id,class:"row roster-row"},[s("div",null,[s("strong",null,u(Nt(e)),1)]),s("div",null,u(e.email||"-"),1),s("div",null,u(e.entry_term_code||"-"),1),s("div",null,[e.term_number?(o(),l("span",vo,"Term "+u(e.term_number),1)):(o(),l("span",mo,"-"))])]))),128))])),s("div",{class:"modal-actions"},[s("button",{class:"btn-cancel",onClick:Et},"Close")])])])):c("",!0),Xe.value?(o(),l("div",_o,[s("div",po,[t[79]||(t[79]=s("h3",null,"Document Comments",-1)),V.value?(o(),l("div",fo,[s("div",null,[s("strong",null,u(V.value.student_username||`#${V.value.student_id}`),1),s("span",null," · "+u(V.value.doc_type)+" · doc_id="+u(V.value.doc_id),1)])])):c("",!0),s("div",go,[et.value?(o(),l("div",yo,"Loading comments...")):ce.value.length===0?(o(),l("div",bo,"No comments yet.")):(o(),l("div",ho,[(o(!0),l(b,null,h(ce.value,e=>(o(),l("div",{key:e.id,class:"comment-item"},[s("div",ko,[s("span",wo,u(e.author_username||e.author_role),1),s("span",Co,u(e.created_at),1)]),s("div",So,u(e.comment),1)]))),128))]))]),f(s("textarea",{"onUpdate:modelValue":t[24]||(t[24]=e=>H.value=e),placeholder:"Write a comment...",rows:"4"},null,512),[[C,H.value]]),s("div",$o,[s("button",{onClick:es,class:"btn-cancel"},"Close"),s("button",{onClick:ts,class:"btn-confirm-approve",disabled:$e.value||!H.value.trim()},u($e.value?"Posting...":"Post Comment"),9,Ao)])])])):c("",!0),qe.value?(o(),l("div",To,[s("div",Lo,[t[80]||(t[80]=s("h3",null,"Submission Comments",-1)),x.value?(o(),l("div",Uo,[s("div",null,[s("strong",null,u(x.value.student_username||`#${x.value.student_id}`),1),s("span",null," · submission_id="+u(x.value.submission_id),1)])])):c("",!0),s("div",Mo,[Be.value?(o(),l("div",jo,"Loading comments...")):ie.value.length===0?(o(),l("div",xo,"No comments yet.")):(o(),l("div",Do,[(o(!0),l(b,null,h(ie.value,e=>(o(),l("div",{key:e.id,class:"comment-item"},[s("div",Vo,[s("span",Po,u(e.author_username||e.author_role),1),s("span",Ro,u(e.created_at),1)]),s("div",Fo,u(e.comment),1)]))),128))]))]),f(s("textarea",{"onUpdate:modelValue":t[25]||(t[25]=e=>B.value=e),placeholder:"Write a comment...",rows:"4"},null,512),[[C,B.value]]),s("div",No,[s("button",{onClick:Kt,class:"btn-cancel"},"Close"),s("button",{onClick:Xt,class:"btn-confirm-approve",disabled:he.value||!B.value.trim()||!x.value},u(he.value?"Posting...":"Post Comment"),9,Oo)])])])):c("",!0),Ee.value?(o(),l("div",Eo,[s("div",qo,[t[93]||(t[93]=s("h3",null,"Edit Assignment",-1)),A.value?(o(),l("div",{key:0,class:S(["msg",{ok:T.value,bad:!T.value}])},u(A.value),3)):c("",!0),m.value?(o(),l("div",Bo,[s("div",Ho,[t[81]||(t[81]=s("label",null,"Title",-1)),f(s("input",{"onUpdate:modelValue":t[26]||(t[26]=e=>m.value.title=e),type:"text"},null,512),[[C,m.value.title]])]),s("div",Wo,[t[82]||(t[82]=s("label",null,"Description",-1)),f(s("textarea",{"onUpdate:modelValue":t[27]||(t[27]=e=>m.value.description=e),rows:"4"},null,512),[[C,m.value.description]])]),s("div",Io,[t[83]||(t[83]=s("label",null,"Due At",-1)),f(s("input",{"onUpdate:modelValue":t[28]||(t[28]=e=>m.value.due_at=e),type:"datetime-local"},null,512),[[C,m.value.due_at]])]),s("div",Go,[t[87]||(t[87]=s("label",null,"Target",-1)),f(s("select",{"onUpdate:modelValue":t[29]||(t[29]=e=>m.value.target_mode=e)},[t[84]||(t[84]=s("option",{value:"all"},"All Students",-1)),s("option",{value:"course",disabled:!Y.value||F.value.length===0},"Course",8,Yo),t[85]||(t[85]=s("option",{value:"cohort",disabled:""},"Cohort (Legacy)",-1)),t[86]||(t[86]=s("option",{value:"students"},"Specific Students",-1))],512),[[M,m.value.target_mode]])]),m.value.target_mode==="cohort"?(o(),l("div",zo,[t[88]||(t[88]=s("label",null,"Cohort Term Code (legacy)",-1)),s("input",{value:m.value.cohort_term_code||"",type:"text",disabled:""},null,8,Jo)])):c("",!0),m.value.target_mode==="course"?(o(),l("div",Qo,[t[90]||(t[90]=s("label",null,"Course",-1)),f(s("select",{"onUpdate:modelValue":t[30]||(t[30]=e=>m.value.course_code=e),class:"select",disabled:!Y.value||F.value.length===0},[t[89]||(t[89]=s("option",{disabled:"",value:""},"-- Select course --",-1)),(o(!0),l(b,null,h(F.value,e=>(o(),l("option",{key:e.course_code,value:e.course_code},u(e.course_code)+u(e.course_name?` · ${e.course_name}`:""),9,Ko))),128))],8,Zo),[[M,m.value.course_code]])])):c("",!0),m.value.target_mode==="students"?(o(),l("div",Xo,[t[91]||(t[91]=s("label",null,"Students",-1)),f(s("select",{"onUpdate:modelValue":t[31]||(t[31]=e=>m.value.student_ids=e),multiple:"",class:"multi"},[(o(!0),l(b,null,h(pe.value,e=>(o(),l("option",{key:e.student_id,value:String(e.student_id)},u(e.username)+" "+u(e.entry_term_code?`· ${e.entry_term_code}`:""),9,en))),128))],512),[[M,m.value.student_ids]]),t[92]||(t[92]=s("div",{class:"hint"},"Hold Ctrl/Cmd to select multiple.",-1))])):c("",!0)])):c("",!0),s("div",tn,[s("button",{class:"btn-cancel",onClick:yt,disabled:ne.value},"Cancel",8,sn),s("button",{class:"btn-confirm-approve",onClick:Yt,disabled:ne.value||!m.value},u(ne.value?"Saving...":"Save"),9,an)])])])):c("",!0)]))}},dn=as(ln,[["__scopeId","data-v-dbde4d5a"]]);export{dn as default};
