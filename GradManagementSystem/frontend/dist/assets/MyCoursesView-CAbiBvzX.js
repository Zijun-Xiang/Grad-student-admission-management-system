import{_ as J,r as i,l as T,h as W,i as _,j as h,c as o,a as s,t as n,u as V,k as d,F as U,f as B,d as O,s as K,n as q,o as r,e as Q,q as X}from"./index-DT2F-dT6.js";const Z={class:"dashboard-layout"},ee={class:"navbar"},se={class:"user-info"},te={class:"main-container"},ae={class:"content"},oe={class:"card"},re={key:0,class:"alert-box"},ne={key:1,class:"info-box"},le={key:2,class:"core-card"},ie={key:0,class:"loading-text"},de={key:1,class:"alert-box"},ce={key:2,class:"core-list"},ue=["value"],ve={class:"code"},_e={class:"name"},pe={class:"credits"},ge={class:"form-actions"},me=["disabled"],fe={key:3},he={class:"credit-card"},ye={class:"credit-row"},ke={class:"credit-values"},be={class:"progress"},Ce={key:0},xe={key:1},we={key:2},Se={key:0,class:"info-box"},Re={class:"course-list"},Ae={class:"code"},Ne={class:"name"},qe={key:0,class:"badge-deficiency"},Me={class:"credits"},De={class:"status"},Le={key:0,class:"badge-registered"},$e={key:1,class:"text-muted"},Ee={class:"action"},Fe=["onClick","disabled","title"],Ve={key:1,class:"text-registered"},y=12,c=20,Ue={__name:"MyCoursesView",setup(Be){const k=W(),M=i({}),D=i([]),b=i([]),p=i([]),C=i(!1),g=i(!1),m=i(!1),x=i(!1),w=i([]),S=i([]),f=i(!1),v=i("");T(()=>{const a=localStorage.getItem("user");a?(M.value=JSON.parse(a),L()):k.push("/")});const L=async()=>{var a;try{const e=await _.get("get_status.php");if(e.data.status==="success"){C.value=e.data.holds.length>0,p.value=e.data.deficiencies||[];const l=(e.data.documents||[]).find(j=>j.doc_type==="admission_letter");g.value=(l==null?void 0:l.status)==="approved";const N=(a=e.data.core_checklist)==null?void 0:a.submitted_at;m.value=g.value&&!N,C.value||(m.value?await Y():g.value&&(G(),$()))}}catch(e){console.error(e)}},Y=async()=>{var a,e;x.value=!0,v.value="";try{const t=await _.get("get_undergrad_core_courses.php");t.data.status==="success"?(w.value=t.data.data||[],w.value.length===0&&(v.value="No undergrad core courses found. Run backend/sql/07_core_courses_seed.sql first.")):v.value=t.data.message||"Failed to load core courses."}catch(t){v.value=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to load core courses. Run backend/sql/07_core_courses_seed.sql."}finally{x.value=!1}},z=async()=>{var a,e;f.value=!0;try{const t=await _.post("student_submit_core_checklist.php",{completed_courses:S.value});t.data.status==="success"?(alert(`Saved. Assigned deficiencies: ${t.data.assigned_deficiencies}`),m.value=!1,await L()):alert(t.data.message||"Failed to save checklist")}catch(t){alert(((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to save checklist")}finally{f.value=!1}},G=async()=>{const a=await _.get("get_courses.php");a.data.status==="success"&&(D.value=a.data.data)},$=async()=>{const a=await _.get("get_student_courses.php");a.data.status==="success"&&(b.value=a.data.data)},R=a=>p.value.some(e=>e.course_code===a),E=a=>b.value.some(e=>e.course_code===a),H=h(()=>D.value.filter(a=>{const e=String(a.level||"").toUpperCase(),t=Number(a.is_required||0)===1;return e==="UG"&&t?R(a.course_code):!0})),u=h(()=>b.value.reduce((a,e)=>a+Number(e.credits||0),0)),I=h(()=>Math.min(100,Math.round(u.value/c*100))),F=h(()=>u.value<y?"low":u.value<=c?"ok":"high"),A=a=>{const e=Number((a==null?void 0:a.credits)||0);return u.value+e>c},P=async a=>{var e,t;if(A(a))return alert(`Cannot exceed ${c} credits per term.`);if(confirm(`Register for ${a.course_code}?`))try{const l=await _.post("register_course.php",{course_code:a.course_code});l.data.status==="success"?(alert("Registered Successfully!"),$()):alert("Error: "+l.data.message)}catch(l){const N=((t=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:t.message)||"Network Error";alert(N)}};return(a,e)=>(r(),o("div",Z,[s("header",ee,[e[3]||(e[3]=s("div",{class:"brand"},"Grad System",-1)),s("div",se,[s("span",null,"Welcome, "+n(M.value.username),1),s("button",{onClick:e[0]||(e[0]=t=>V(k).push("/dashboard")),class:"btn-back"},"Back to Dashboard")])]),s("div",te,[s("main",ae,[s("div",oe,[e[16]||(e[16]=s("h2",null,"Course Registration",-1)),C.value?(r(),o("div",re,"You have active Holds. Registration is disabled.")):g.value?m.value?(r(),o("div",le,[e[7]||(e[7]=s("h3",null,"Undergraduate Core Courses Checklist",-1)),e[8]||(e[8]=s("p",{class:"text-muted"},[d(" Select the courses you have already completed in your undergraduate study. Any course not selected will become a "),s("strong",null,"Deficiency"),d(" that you must take before graduate courses. ")],-1)),x.value?(r(),o("div",ie,"Loading core courses...")):v.value?(r(),o("div",de,n(v.value),1)):(r(),o("div",ce,[(r(!0),o(U,null,B(w.value,t=>(r(),o("label",{key:t.course_code,class:"core-item"},[Q(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>S.value=l),value:t.course_code},null,8,ue),[[X,S.value]]),s("span",ve,n(t.course_code),1),s("span",_e,n(t.course_name),1),s("span",pe,n(t.credits),1)]))),128))])),s("div",ge,[s("button",{class:"btn-register",onClick:z,disabled:f.value},n(f.value?"Saving...":"Save & Continue"),9,me)])])):(r(),o("div",fe,[s("div",he,[s("div",ye,[e[12]||(e[12]=s("div",{class:"credit-title"},"Credit Requirement (per term)",-1)),s("div",ke,[e[9]||(e[9]=d(" Min ",-1)),s("strong",null,n(y)),e[10]||(e[10]=d(" · Max ",-1)),s("strong",null,n(c)),e[11]||(e[11]=d(" · Selected ",-1)),s("strong",null,n(u.value),1)])]),s("div",be,[s("div",{class:q(["bar",F.value]),style:K({width:I.value+"%"})},null,6)]),s("div",{class:q(["credit-hint",F.value])},[u.value<y?(r(),o("span",Ce,"You need at least "+n(y)+" credits.")):u.value<=c?(r(),o("span",xe,"On track.")):(r(),o("span",we,"Over the maximum of "+n(c)+" credits."))],2)]),p.value.length>0?(r(),o("div",Se,[e[13]||(e[13]=d(" You have ",-1)),s("strong",null,n(p.value.length)+" deficiency courses",1),e[14]||(e[14]=d(". According to policy, you must register for these first. ",-1))])):O("",!0),s("div",Re,[e[15]||(e[15]=s("div",{class:"list-header"},[s("span",null,"Course Code"),s("span",null,"Course Name"),s("span",null,"Credits"),s("span",null,"Status"),s("span",null,"Action")],-1)),(r(!0),o(U,null,B(H.value,t=>(r(),o("div",{key:t.course_code,class:q(["list-row",{"highlight-row":R(t.course_code)}])},[s("span",Ae,n(t.course_code),1),s("span",Ne,[d(n(t.course_name)+" ",1),R(t.course_code)?(r(),o("span",qe,"Deficiency")):O("",!0)]),s("span",Me,n(t.credits),1),s("span",De,[E(t.course_code)?(r(),o("span",Le,"Registered")):(r(),o("span",$e,"-"))]),s("span",Ee,[E(t.course_code)?(r(),o("span",Ve,"✓")):(r(),o("button",{key:0,onClick:l=>P(t),class:"btn-register",disabled:A(t),title:A(t)?`Exceeds max ${c} credits`:""}," Register ",8,Fe))])],2))),128))])])):(r(),o("div",ne,[e[4]||(e[4]=s("strong",null,"Admission Letter required.",-1)),e[5]||(e[5]=d(" Please upload your Admission Letter in ",-1)),s("span",{class:"link",onClick:e[1]||(e[1]=t=>V(k).push("/documents"))},"Documents"),e[6]||(e[6]=d(" and wait for approval before course selection. ",-1))]))])])])]))}},Ye=J(Ue,[["__scopeId","data-v-e86c82ba"]]);export{Ye as default};
