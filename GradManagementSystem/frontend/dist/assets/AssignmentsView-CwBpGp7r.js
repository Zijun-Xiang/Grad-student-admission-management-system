import{_ as W,r,j as G,l as E,h as J,i as v,c as o,a as t,d,t as a,u as h,F as R,f as D,o as i,k as I}from"./index-Dl1toHCS.js";const Y={class:"dashboard-layout"},q={class:"navbar"},z={class:"user-info"},H={key:0},K={class:"main-container"},Q={class:"sidebar"},X={class:"content"},Z={class:"card"},ss={key:0,class:"msg bad"},es={key:1,class:"loading-text"},ts={key:2,class:"empty-state"},ns={key:3,class:"assignment-list"},os={class:"head"},is={class:"title"},as={key:0,class:"badge"},ls={key:1,class:"badge warn"},ds={key:2,class:"badge ok"},us={class:"meta text-muted"},cs={key:0},rs={key:0,class:"desc"},ms={class:"actions"},_s=["onClick","disabled"],vs=["onClick","disabled"],bs=["onClick","disabled"],ps={class:"submit-box"},gs={class:"text-muted"},ys={key:0,class:"muted",style:{"margin-left":"8px"}},hs=["onChange"],ks=["onClick","disabled"],fs={key:0,class:"modal-overlay"},Cs={class:"modal-box wide-modal"},ws={key:0,class:"comment-meta"},Ss={key:0},Ns={class:"comment-list"},$s={key:0,class:"loading-text"},xs={key:1,class:"empty-state"},Fs={key:2},Ls={class:"comment-head"},js={class:"comment-author"},As={class:"comment-time"},Rs={class:"comment-body"},Ds={__name:"AssignmentsView",setup(Is){const m=J(),k=r({}),f=r(!0),C=r([]),g=r(""),u=r(0),b=r({}),w=r(!1),p=r(null),y=r([]),S=r(!1),N=r(null),$=G(()=>{const n=N.value||{};return{termNumber:Number(n.term_number||1)}});E(async()=>{var e;const n=localStorage.getItem("user");if(!n)return m.push("/");k.value=JSON.parse(n);try{const s=await v.get("get_status.php");((e=s.data)==null?void 0:e.status)==="success"&&(N.value=s.data.term||null)}catch{}await x()});const x=async()=>{var n,e,s,l;f.value=!0,g.value="";try{const c=await v.get("student_list_assignments.php");((n=c.data)==null?void 0:n.status)==="success"?C.value=c.data.data||[]:g.value=((e=c.data)==null?void 0:e.message)||"Failed to load assignments."}catch(c){g.value=((l=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to load assignments."}finally{f.value=!1}},T=(n,e)=>{var l,c;const s=((c=(l=e==null?void 0:e.target)==null?void 0:l.files)==null?void 0:c[0])??null;b.value={...b.value,[n]:s}},F=n=>{const e=URL.createObjectURL(n);window.open(e,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(e),6e4)},U=async n=>{u.value=n.id;try{const e=await v.get(`download_assignment_file.php?assignment_id=${n.id}`,{responseType:"blob"});F(e.data)}finally{u.value=0}},V=async n=>{if(n.submission_id){u.value=n.id;try{const e=await v.get(`download_assignment_submission.php?submission_id=${n.submission_id}`,{responseType:"blob"});F(e.data)}finally{u.value=0}}},B=async n=>{var s,l,c,L,j;const e=(s=b.value)==null?void 0:s[n.id];if(e){u.value=n.id;try{const _=new FormData;_.append("assignment_id",String(n.id)),_.append("file",e);const A=await v.post("student_submit_assignment.php",_);((l=A.data)==null?void 0:l.status)==="success"?(b.value={...b.value,[n.id]:null},await x()):alert(((c=A.data)==null?void 0:c.message)||"Submit failed")}catch(_){alert(((j=(L=_==null?void 0:_.response)==null?void 0:L.data)==null?void 0:j.message)||"Submit failed")}finally{u.value=0}}},M=async n=>{var e;p.value=n,w.value=!0,y.value=[],S.value=!0;try{const s=await v.get(`assignment_submission_comments_list.php?submission_id=${n.submission_id}`);((e=s.data)==null?void 0:e.status)==="success"&&(y.value=s.data.data||[])}finally{S.value=!1}},O=()=>{w.value=!1,p.value=null,y.value=[]},P=async()=>{try{await v.post("logout.php")}catch{}localStorage.removeItem("user"),m.push("/")};return(n,e)=>(i(),o("div",Y,[t("header",q,[e[5]||(e[5]=t("div",{class:"brand"},"Grad System",-1)),t("div",z,[k.value.username?(i(),o("span",H,"Welcome, "+a(k.value.username),1)):d("",!0),t("button",{onClick:P,class:"btn-logout"},"Logout")])]),t("div",K,[t("aside",Q,[t("nav",null,[t("ul",null,[t("li",{onClick:e[0]||(e[0]=s=>h(m).push("/dashboard"))},"Dashboard"),t("li",{onClick:e[1]||(e[1]=s=>h(m).push("/my-courses"))},"My Courses"),t("li",{onClick:e[2]||(e[2]=s=>h(m).push("/documents"))},"Documents"),e[6]||(e[6]=t("li",{class:"active"},"Assignments",-1)),$.value.termNumber>=2?(i(),o("li",{key:0,onClick:e[3]||(e[3]=s=>h(m).push("/major-professor"))},"Major Professor")):d("",!0),$.value.termNumber>=3?(i(),o("li",{key:1,onClick:e[4]||(e[4]=s=>h(m).push("/thesis-project"))},"Thesis / Project")):d("",!0)])])]),t("main",X,[t("div",Z,[e[7]||(e[7]=t("h2",null,"Assignments",-1)),g.value?(i(),o("div",ss,a(g.value),1)):d("",!0),f.value?(i(),o("div",es,"Loading...")):C.value.length===0?(i(),o("div",ts,"No assignments.")):(i(),o("div",ns,[(i(!0),o(R,null,D(C.value,s=>(i(),o("div",{key:s.id,class:"assignment-item"},[t("div",os,[t("div",is,[t("strong",null,a(s.title),1),s.submission_id?(i(),o("span",as,"Submitted")):(i(),o("span",ls,"Not submitted")),s.submission_id&&s.grade!==null&&s.grade!==void 0?(i(),o("span",ds,"Grade: "+a(s.grade),1)):d("",!0)]),t("div",us,[I(" From: "+a(s.faculty_username||"Faculty")+" ",1),s.due_at?(i(),o("span",cs,"· Due: "+a(s.due_at),1)):d("",!0)])]),s.description?(i(),o("div",rs,a(s.description),1)):d("",!0),t("div",ms,[s.attachment_path?(i(),o("button",{key:0,class:"btn-secondary",onClick:l=>U(s),disabled:u.value===s.id},a(u.value===s.id?"Working...":"Download"),9,_s)):d("",!0),s.submission_id?(i(),o("button",{key:1,class:"btn-secondary",onClick:l=>V(s),disabled:u.value===s.id},a(u.value===s.id?"Working...":"My Submission"),9,vs)):d("",!0),s.submission_id?(i(),o("button",{key:2,class:"btn-secondary",onClick:l=>M(s),disabled:u.value===s.id}," Comments ("+a(Number(s.comments_count||0))+") ",9,bs)):d("",!0)]),t("div",ps,[t("div",gs,[I(a(s.submission_id?"Resubmit (optional):":"Submit:")+" ",1),s.submission_id&&s.grade!==null&&s.grade!==void 0?(i(),o("span",ys," (Your grade: "+a(s.grade)+") ",1)):d("",!0)]),t("input",{type:"file",onChange:l=>T(s.id,l)},null,40,hs),t("button",{class:"btn-primary",onClick:l=>B(s),disabled:!b.value[s.id]||u.value===s.id},a(u.value===s.id?"Uploading...":s.submission_id?"Resubmit":"Submit"),9,ks)])]))),128))]))]),w.value?(i(),o("div",fs,[t("div",Cs,[e[8]||(e[8]=t("h3",null,"Faculty Comments",-1)),p.value?(i(),o("div",ws,[t("strong",null,a(p.value.title),1),p.value.submission_id?(i(),o("span",Ss," · submission_id="+a(p.value.submission_id),1)):d("",!0)])):d("",!0),t("div",Ns,[S.value?(i(),o("div",$s,"Loading comments...")):y.value.length===0?(i(),o("div",xs,"No comments yet.")):(i(),o("div",Fs,[(i(!0),o(R,null,D(y.value,s=>(i(),o("div",{key:s.id,class:"comment-item"},[t("div",Ls,[t("span",js,a(s.author_username||s.author_role),1),t("span",As,a(s.created_at),1)]),t("div",Rs,a(s.comment),1)]))),128))]))]),t("div",{class:"modal-actions"},[t("button",{class:"btn-cancel",onClick:O},"Close")])])])):d("",!0)])])]))}},Us=W(Ds,[["__scopeId","data-v-24780d5a"]]);export{Us as default};
