import{_ as _e,r as m,j as pe,w as te,l as fe,h as ye,c as o,a as e,d as h,t as v,n as S,F as x,f as F,e as _,g as p,v as ge,i as y,o as d}from"./index-CBvISKLU.js";const be={class:"dashboard-layout"},we={class:"navbar"},ke={class:"user-info"},he={key:0},Ce={class:"main-container"},De={class:"sidebar"},Ue={class:"content"},$e={key:0,class:"card mb-30 error-card"},Se={key:1,class:"card mb-30"},Ve={key:0,class:"loading-text"},xe={key:1,class:"empty-state"},Le={key:2,class:"table"},Ee={class:"actions"},Te=["onClick"],Ne={key:2,class:"card"},Fe={key:0,class:"loading-text"},Re={key:1,class:"empty-state"},je={key:2,class:"review-list"},Ae={class:"info"},Me={class:"student-name"},Pe={class:"file-link"},Oe={class:"actions"},Ie=["onClick"],Be=["onClick"],He=["onClick"],We={key:3,class:"stack"},Ye={class:"card mb-30"},qe={class:"form-row"},ze={class:"form-group"},Ge={class:"form-group"},Je={class:"form-group"},Ke={class:"form-group",style:{"align-self":"end"}},Qe=["disabled"],Xe={key:1,class:"loading-text"},Ze={key:2,class:"empty-state"},et={key:3,class:"table mt-20"},tt={class:"actions"},st=["onClick","disabled"],at=["onClick","disabled"],lt={key:4,class:"card mt-30"},nt={class:"form-row",style:{margin:"10px 0 6px"}},ot=["disabled"],dt={key:0,class:"loading-text"},it={key:1,class:"empty-state"},rt={key:2,class:"table mt-20"},ut={class:"muted"},vt={key:5,class:"card mt-30"},ct={class:"user-form"},mt={class:"form-row"},_t={class:"form-group"},pt={class:"form-group"},ft={class:"form-group"},yt={class:"form-row"},gt={class:"form-group"},bt={class:"form-group"},wt={key:0,class:"form-group"},kt={key:1,class:"form-group"},ht={key:2,class:"form-group"},Ct={class:"form-actions"},Dt=["disabled"],Ut=["disabled"],$t={key:0,class:"loading-text"},St={key:1,class:"empty-state"},Vt={key:2,class:"table mt-20"},xt={class:"actions"},Lt=["onClick","disabled"],Et=["onClick","disabled"],Tt={key:0,class:"modal-overlay"},Nt={class:"modal-box wide-modal"},Ft={key:1,class:"edit-grid"},Rt={class:"form-group"},jt=["value"],At={class:"form-group"},Mt=["value"],Pt={class:"form-group"},Ot={class:"form-group"},It={class:"form-group"},Bt={class:"form-group"},Ht={class:"modal-actions"},Wt=["disabled"],Yt={__name:"AdminDashboardView",setup(qt){const M=ye(),L=m({}),f=m("holds"),R=m(!0),P=m([]),O=m([]),E=m(""),g=m(!1),I=m([]),i=m({role:"student",entry_date:"",username:"",password:"",email:"",first_name:"",last_name:"",term_code:""}),B=m(!1),c=m(null),D=m(""),U=m(""),H=m(!1),C=m(!1),W=m([]),w=m({year:String(new Date().getFullYear()),start_date:"",end_date:""}),b=m(""),k=m(!0),j=m(!1),z=m([]),Y=m(""),se=a=>`${a.student_id}-${a.hold_type}-${a.term_code||""}`,ae=async a=>{var t,s;try{const l=(await y.get(`download_document.php?doc_id=${a.doc_id}`,{responseType:"blob"})).data,r=URL.createObjectURL(l);window.open(r,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(r),6e4)}catch(n){const l=(t=n==null?void 0:n.response)==null?void 0:t.status,r=(s=n==null?void 0:n.response)==null?void 0:s.data;try{if(r instanceof Blob){const u=await r.text();alert(`Failed to open document (${l||"network"}): ${u||"Forbidden/Not logged in"}`);return}}catch{}alert(`Failed to open document (${l||"network"}).`)}},V=async()=>{var a,t,s,n;R.value=!0,E.value="";try{const l=await y.get("admin_get_dashboard.php");((a=l.data)==null?void 0:a.status)==="success"?(P.value=l.data.holds||[],O.value=l.data.pending_documents||[]):E.value=((t=l.data)==null?void 0:t.message)||"Failed to load admin dashboard."}catch(l){E.value=((n=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:n.message)||(l==null?void 0:l.message)||"Failed to load admin dashboard."}finally{R.value=!1}},q=async()=>{var a;H.value=!0;try{const t=await y.get("defense_windows_list.php");((a=t.data)==null?void 0:a.status)==="success"&&(W.value=t.data.data||[])}catch{}finally{H.value=!1}},le=a=>{w.value={year:String(a.year),start_date:a.start_date,end_date:a.end_date},b.value=""},ne=async()=>{var a,t,s,n,l;b.value="",k.value=!0,C.value=!0;try{const r={year:Number(w.value.year),start_date:w.value.start_date,end_date:w.value.end_date},u=await y.post("admin_defense_windows_upsert.php",r);((a=u.data)==null?void 0:a.status)==="success"?(b.value=((t=u.data)==null?void 0:t.message)||"Saved.",k.value=!0,await q()):(b.value=((s=u.data)==null?void 0:s.message)||"Save failed.",k.value=!1)}catch(r){b.value=((l=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:l.message)||"Save failed.",k.value=!1}finally{C.value=!1}},oe=async a=>{var t,s,n,l,r;b.value="",k.value=!0,C.value=!0;try{const u=await y.post("admin_defense_windows_delete.php",{year:Number(a.year)});((t=u.data)==null?void 0:t.status)==="success"?(b.value=((s=u.data)==null?void 0:s.message)||"Deleted.",k.value=!0,await q()):(b.value=((n=u.data)==null?void 0:n.message)||"Delete failed.",k.value=!1)}catch(u){b.value=((r=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:r.message)||"Delete failed.",k.value=!1}finally{C.value=!1}},G=async()=>{var a;j.value=!0;try{const t=await y.get("admin_get_thesis_projects.php");((a=t.data)==null?void 0:a.status)==="success"&&(z.value=t.data.data||[])}catch{}finally{j.value=!1}},J=pe(()=>{const a=(Y.value||"").trim().toLowerCase(),t=z.value||[];return a?t.filter(s=>[s.student_id,s.username,s.email,s.first_name,s.last_name,s.type,s.title,s.submission_date,s.defense_date].map(l=>String(l||"").toLowerCase()).join(" ").includes(a)):t}),T=a=>{const t=new Date(a+"T00:00:00");if(isNaN(t.getTime()))return"";const s=t.getFullYear(),n=t.getMonth()+1;return n<=4?`${s}SP`:n<=8?`${s}SU`:`${s}FA`},K=()=>new Date().toISOString().slice(0,10);i.value.entry_date=K(),i.value.term_code=T(i.value.entry_date),te(()=>i.value.entry_date,a=>{i.value.term_code=T(a||"")});const N=async()=>{var a,t,s,n;g.value=!0;try{const l=await y.get("admin_users_list.php");((a=l.data)==null?void 0:a.status)==="success"?I.value=l.data.data||[]:alert(((t=l.data)==null?void 0:t.message)||"Failed to load users")}catch(l){alert(((n=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to load users")}finally{g.value=!1}},de=async()=>{var t,s,n,l;if(!i.value.username||!i.value.password)return alert("Username and password are required.");if(i.value.password.length<6)return alert("Password must be at least 6 characters.");if(confirm(`Create ${i.value.role} user "${i.value.username}"?`)){g.value=!0;try{const r=await y.post("admin_users_create.php",i.value);((t=r.data)==null?void 0:t.status)==="success"?(i.value.entry_date=K(),i.value.username="",i.value.password="",i.value.email="",i.value.first_name="",i.value.last_name="",i.value.term_code=T(i.value.entry_date),await N(),await V()):alert(((s=r.data)==null?void 0:s.message)||"Create failed")}catch(r){alert(((l=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:l.message)||"Create failed")}finally{g.value=!1}}},ie=async a=>{var s,n,l,r;if(a.role==="admin")return alert("Deleting admin is disabled.");if(confirm(`Delete user "${a.username}" (#${a.user_id})? This will also delete related records.`)){g.value=!0;try{const u=await y.post("admin_users_delete.php",{user_id:a.user_id});((s=u.data)==null?void 0:s.status)==="success"?(await N(),await V()):alert(((n=u.data)==null?void 0:n.message)||"Delete failed")}catch(u){alert(((r=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:r.message)||"Delete failed")}finally{g.value=!1}}},re=a=>{D.value="",U.value="",c.value={user_id:a.user_id,role:a.role,username:a.username,email:a.email||"",entry_date:a.entry_date||"",entry_term_code:a.entry_term_code||(a.entry_date?T(a.entry_date):"")},B.value=!0};te(()=>{var a;return(a=c.value)==null?void 0:a.entry_date},a=>{c.value&&(c.value.entry_term_code=T(a||""))});const Q=()=>{B.value=!1,c.value=null,D.value="",U.value=""},ue=async()=>{var a,t,s,n;if(c.value){g.value=!0,D.value="",U.value="";try{const l={user_id:c.value.user_id,username:c.value.username,email:c.value.email,entry_date:c.value.entry_date,entry_term_code:c.value.entry_term_code},r=await y.post("admin_users_update.php",l);((a=r.data)==null?void 0:a.status)==="success"?(Q(),await N(),await V()):(D.value=((t=r.data)==null?void 0:t.message)||"Update failed",U.value="err")}catch(l){D.value=((n=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:n.message)||"Update failed",U.value="err"}finally{g.value=!1}}},X=async(a,t)=>{var l,r,u,A,ee;if(!confirm(`${t.toUpperCase()} this document? (${a.doc_type} · student ${a.student_id})`))return;const n=t==="reject"?prompt("Reason (optional):"):"Approved";try{const $=await y.post("admin_review_document.php",{doc_id:a.doc_id,action:t,comment:n});((l=$.data)==null?void 0:l.status)==="success"?(alert(((r=$.data)==null?void 0:r.message)||"Saved."),await V()):alert(((u=$.data)==null?void 0:u.message)||"Action failed")}catch($){const me=((ee=(A=$==null?void 0:$.response)==null?void 0:A.data)==null?void 0:ee.message)||"Network error";alert(me)}},ve=async a=>{var s,n,l,r;if(confirm(`Lift hold "${a.hold_type}" for student ${a.student_id}?`))try{const u=await y.post("admin_lift_hold.php",{student_id:a.student_id,hold_type:a.hold_type,term_code:a.term_code||null});((s=u.data)==null?void 0:s.status)==="success"?(u.data.registrar_code&&alert(`Registrar code generated:
${u.data.registrar_code}`),await V()):alert(((n=u.data)==null?void 0:n.message)||"Lift failed")}catch(u){const A=((r=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:r.message)||"Network error";alert(A)}},ce=async()=>{try{await y.post("logout.php")}catch{}localStorage.removeItem("user"),M.push("/")},Z=async()=>{await Promise.all([V(),N(),q(),G()])};return fe(()=>{const a=localStorage.getItem("user");if(!a)return M.push("/");if(L.value=JSON.parse(a),L.value.role!=="admin")return M.push(L.value.role==="faculty"?"/faculty":"/dashboard");Z()}),(a,t)=>(d(),o(x,null,[e("div",be,[e("header",we,[t[21]||(t[21]=e("div",{class:"brand"},"Grad System (Admin Portal)",-1)),e("div",ke,[L.value.username?(d(),o("span",he,"Admin: "+v(L.value.username),1)):h("",!0),e("button",{onClick:Z,class:"btn-refresh"},"Refresh"),e("button",{onClick:ce,class:"btn-logout"},"Logout")])]),e("div",Ce,[e("aside",De,[e("nav",null,[e("ul",null,[e("li",{class:S({active:f.value==="holds"}),onClick:t[0]||(t[0]=s=>f.value="holds")},"Active Holds",2),e("li",{class:S({active:f.value==="docs"}),onClick:t[1]||(t[1]=s=>f.value="docs")},"Pending Documents",2),e("li",{class:S({active:f.value==="defense"}),onClick:t[2]||(t[2]=s=>f.value="defense")},"Defense Dates",2),e("li",{class:S({active:f.value==="thesis"}),onClick:t[3]||(t[3]=s=>f.value="thesis")},"Thesis / Project",2),e("li",{class:S({active:f.value==="users"}),onClick:t[4]||(t[4]=s=>f.value="users")},"User Management",2)])])]),e("main",Ue,[E.value?(d(),o("div",$e,v(E.value),1)):h("",!0),f.value==="holds"?(d(),o("div",Se,[t[23]||(t[23]=e("h2",null,"Active Holds",-1)),R.value?(d(),o("div",Ve,"Loading...")):P.value.length===0?(d(),o("div",xe,"No active holds.")):(d(),o("div",Le,[t[22]||(t[22]=e("div",{class:"row header"},[e("div",null,"Student"),e("div",null,"Hold Type"),e("div",null,"Term"),e("div")],-1)),(d(!0),o(x,null,F(P.value,s=>(d(),o("div",{key:s.hold_id||se(s),class:"row"},[e("div",null,v(s.student_username||`#${s.student_id}`)+" (#"+v(s.student_id)+")",1),e("div",null,v(s.hold_type),1),e("div",null,v(s.term_code||"-"),1),e("div",Ee,[e("button",{class:"btn-approve",onClick:n=>ve(s)},"Lift Hold",8,Te)])]))),128))]))])):f.value==="docs"?(d(),o("div",Ne,[t[24]||(t[24]=e("h2",null,"Pending Documents",-1)),R.value?(d(),o("div",Fe,"Loading...")):O.value.length===0?(d(),o("div",Re,"No pending documents.")):(d(),o("div",je,[(d(!0),o(x,null,F(O.value,s=>(d(),o("div",{key:s.doc_id,class:"review-item"},[e("div",Ae,[e("span",Me,v(s.student_username||`#${s.student_id}`)+" (#"+v(s.student_id)+")",1),e("span",Pe,v(s.doc_type)+" · "+v(s.file_path),1)]),e("div",Oe,[e("button",{class:"btn-view",onClick:n=>ae(s)},"View",8,Ie),e("button",{onClick:n=>X(s,"reject"),class:"btn-reject"},"Reject",8,Be),e("button",{onClick:n=>X(s,"approve"),class:"btn-approve"},"Approve",8,He)])]))),128))]))])):f.value==="defense"?(d(),o("div",We,[e("div",Ye,[t[29]||(t[29]=e("h2",null,"Defense Dates (Admin)",-1)),t[30]||(t[30]=e("p",{class:"subtitle"}," Publish a defense date window per year. Students must pick a defense date within the window. ",-1)),b.value?(d(),o("div",{key:0,class:S(["msg",{ok:k.value,bad:!k.value}])},v(b.value),3)):h("",!0),e("div",qe,[e("div",ze,[t[25]||(t[25]=e("label",null,"Year",-1)),_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>w.value.year=s),type:"number",min:"2000",max:"2100"},null,512),[[p,w.value.year]])]),e("div",Ge,[t[26]||(t[26]=e("label",null,"Start Date",-1)),_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>w.value.start_date=s),type:"date"},null,512),[[p,w.value.start_date]])]),e("div",Je,[t[27]||(t[27]=e("label",null,"End Date",-1)),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>w.value.end_date=s),type:"date"},null,512),[[p,w.value.end_date]])]),e("div",Ke,[e("button",{class:"btn-approve",onClick:ne,disabled:C.value},v(C.value?"Saving...":"Save"),9,Qe)])]),H.value?(d(),o("div",Xe,"Loading windows...")):W.value.length===0?(d(),o("div",Ze,"No windows.")):(d(),o("div",et,[t[28]||(t[28]=e("div",{class:"row header"},[e("div",null,"Year"),e("div",null,"Start"),e("div",null,"End"),e("div")],-1)),(d(!0),o(x,null,F(W.value,s=>(d(),o("div",{key:s.year,class:"row"},[e("div",null,[e("strong",null,v(s.year),1)]),e("div",null,v(s.start_date),1),e("div",null,v(s.end_date),1),e("div",tt,[e("button",{class:"btn-view",onClick:n=>le(s),disabled:C.value},"Edit",8,st),e("button",{class:"btn-reject",onClick:n=>oe(s),disabled:C.value},"Delete",8,at)])]))),128))]))])])):f.value==="thesis"?(d(),o("div",lt,[t[32]||(t[32]=e("h2",null,"Student Thesis / Project Timeline",-1)),e("div",nt,[_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>Y.value=s),class:"select",type:"text",placeholder:"Search students..."},null,512),[[p,Y.value]]),e("button",{class:"btn-view",onClick:G,disabled:j.value},"Refresh",8,ot)]),j.value?(d(),o("div",dt,"Loading...")):J.value.length===0?(d(),o("div",it,"No data.")):(d(),o("div",rt,[t[31]||(t[31]=e("div",{class:"row header thesis-row"},[e("div",null,"Student"),e("div",null,"Type"),e("div",null,"Submission"),e("div",null,"Defense"),e("div",null,"Title")],-1)),(d(!0),o(x,null,F(J.value,s=>(d(),o("div",{key:s.student_id,class:"row thesis-row"},[e("div",null,[e("strong",null,v(s.username||`#${s.student_id}`),1),e("span",ut," (#"+v(s.student_id)+")",1)]),e("div",null,v(s.type||"-"),1),e("div",null,v(s.submission_date||"-"),1),e("div",null,v(s.defense_date||"-"),1),e("div",null,v(s.title||"-"),1)]))),128))]))])):(d(),o("div",vt,[t[43]||(t[43]=e("h2",null,"User Management",-1)),e("div",ct,[e("div",mt,[e("div",_t,[t[34]||(t[34]=e("label",null,"Role",-1)),_(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>i.value.role=s)},[...t[33]||(t[33]=[e("option",{value:"student"},"Student",-1),e("option",{value:"faculty"},"Faculty",-1)])],512),[[ge,i.value.role]])]),e("div",pt,[t[35]||(t[35]=e("label",null,"Entry Date",-1)),_(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>i.value.entry_date=s),type:"date"},null,512),[[p,i.value.entry_date]])]),e("div",ft,[t[36]||(t[36]=e("label",null,"Username",-1)),_(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>i.value.username=s),type:"text",placeholder:"e.g. student2 / prof_jamil"},null,512),[[p,i.value.username]])])]),e("div",yt,[e("div",gt,[t[37]||(t[37]=e("label",null,"Password",-1)),_(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>i.value.password=s),type:"password",placeholder:"At least 6 characters"},null,512),[[p,i.value.password]])]),e("div",bt,[t[38]||(t[38]=e("label",null,"Email (optional)",-1)),_(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>i.value.email=s),type:"email",placeholder:"Optional"},null,512),[[p,i.value.email]])]),i.value.role==="student"?(d(),o("div",wt,[t[39]||(t[39]=e("label",null,"First Name (optional)",-1)),_(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>i.value.first_name=s),type:"text",placeholder:"Optional"},null,512),[[p,i.value.first_name]])])):h("",!0),i.value.role==="student"?(d(),o("div",kt,[t[40]||(t[40]=e("label",null,"Last Name (optional)",-1)),_(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>i.value.last_name=s),type:"text",placeholder:"Optional"},null,512),[[p,i.value.last_name]])])):h("",!0),i.value.role==="student"?(d(),o("div",ht,[t[41]||(t[41]=e("label",null,"Entry Term Code (auto)",-1)),_(e("input",{"onUpdate:modelValue":t[16]||(t[16]=s=>i.value.term_code=s),type:"text",disabled:""},null,512),[[p,i.value.term_code]])])):h("",!0)]),e("div",Ct,[e("button",{class:"btn-view",onClick:N,disabled:g.value},"Refresh",8,Dt),e("button",{class:"btn-approve",onClick:de,disabled:g.value},"Create User",8,Ut)])]),g.value?(d(),o("div",$t,"Loading users...")):I.value.length===0?(d(),o("div",St,"No users.")):(d(),o("div",Vt,[t[42]||(t[42]=e("div",{class:"row header users-header"},[e("div",null,"Username"),e("div",null,"Role"),e("div",null,"Email"),e("div",null,"Entry Date"),e("div",null,"Entry Term"),e("div")],-1)),(d(!0),o(x,null,F(I.value,s=>(d(),o("div",{key:s.user_id,class:"row users-row"},[e("div",null,v(s.username)+" (#"+v(s.user_id)+")",1),e("div",null,v(s.role),1),e("div",null,v(s.email||"-"),1),e("div",null,v(s.entry_date||"-"),1),e("div",null,v(s.entry_term_code||"-"),1),e("div",xt,[e("button",{class:"btn-view",onClick:n=>re(s),disabled:s.role==="admin"},"Edit",8,Lt),e("button",{class:"btn-reject",onClick:n=>ie(s),disabled:s.role==="admin"},"Delete",8,Et)])]))),128))]))]))])])]),B.value?(d(),o("div",Tt,[e("div",Nt,[t[50]||(t[50]=e("h3",null,"Edit Registration Info",-1)),D.value?(d(),o("div",{key:0,class:S(["inline-msg",{ok:U.value==="ok",err:U.value==="err"}])},v(D.value),3)):h("",!0),c.value?(d(),o("div",Ft,[e("div",Rt,[t[44]||(t[44]=e("label",null,"User ID",-1)),e("input",{value:c.value.user_id,disabled:""},null,8,jt)]),e("div",At,[t[45]||(t[45]=e("label",null,"Role",-1)),e("input",{value:c.value.role,disabled:""},null,8,Mt)]),e("div",Pt,[t[46]||(t[46]=e("label",null,"Username",-1)),_(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>c.value.username=s)},null,512),[[p,c.value.username]])]),e("div",Ot,[t[47]||(t[47]=e("label",null,"Email",-1)),_(e("input",{"onUpdate:modelValue":t[18]||(t[18]=s=>c.value.email=s),type:"email"},null,512),[[p,c.value.email]])]),e("div",It,[t[48]||(t[48]=e("label",null,"Entry Date",-1)),_(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>c.value.entry_date=s),type:"date"},null,512),[[p,c.value.entry_date]])]),e("div",Bt,[t[49]||(t[49]=e("label",null,"Entry Term Code (auto)",-1)),_(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>c.value.entry_term_code=s),disabled:""},null,512),[[p,c.value.entry_term_code]])])])):h("",!0),e("div",Ht,[e("button",{class:"btn-cancel",onClick:Q},"Cancel"),e("button",{class:"btn-confirm-approve",onClick:ue,disabled:g.value},"Save",8,Wt)])])])):h("",!0)],64))}},Gt=_e(Yt,[["__scopeId","data-v-42dde5b1"]]);export{Gt as default};
