import{_ as H,k as p,r as v,w as ee,c as a,a as t,d as h,t as l,F as U,f as I,n as B,l as M,j as o,o as te,h as se,i as A,u as C,m as ne,p as ae}from"./index-CHzR5xCe.js";const oe={class:"calendar"},le={class:"cal-header"},re={class:"title"},ie={class:"dow"},ue={class:"grid"},de={class:"num"},ce={key:0,class:"legend"},ve={__name:"MiniCalendar",props:{entryDate:{type:String,default:""}},setup(E){const m=E,j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],S=r=>{if(!r)return null;const i=new Date(r+"T00:00:00");return isNaN(i.getTime())?null:i},$=new Date,N=p(()=>S(m.entryDate)),y=v($.getFullYear()),d=v($.getMonth());ee(()=>m.entryDate,r=>{const i=S(r);i&&(y.value=i.getFullYear(),d.value=i.getMonth())},{immediate:!0});const L=p(()=>new Date(y.value,d.value,1).toLocaleString("en-US",{month:"long",year:"numeric"})),w=p(()=>{const r=N.value;if(!r)return"";const i=r.getFullYear(),_=String(r.getMonth()+1).padStart(2,"0"),g=String(r.getDate()).padStart(2,"0");return`${i}-${_}-${g}`}),T=(r,i)=>r&&i&&r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()&&r.getDate()===i.getDate(),f=p(()=>{const i=new Date(y.value,d.value,1).getDay(),_=new Date(y.value,d.value+1,0).getDate(),g=[];for(let D=0;D<i;D++)g.push({day:"",date:null});for(let D=1;D<=_;D++)g.push({day:D,date:new Date(y.value,d.value,D)});for(;g.length%7!==0;)g.push({day:"",date:null});return g}),k=r=>r.date?{today:T(r.date,$),entry:T(r.date,N.value)}:"empty",Y=()=>{d.value===0?(d.value=11,y.value-=1):d.value-=1},x=()=>{d.value===11?(d.value=0,y.value+=1):d.value+=1};return(r,i)=>(o(),a("div",oe,[t("div",le,[t("button",{class:"nav",onClick:Y},"<"),t("div",re,l(L.value),1),t("button",{class:"nav",onClick:x},">")]),t("div",ie,[(o(),a(U,null,I(j,_=>t("div",{key:_,class:"dow-cell"},l(_),1)),64))]),t("div",ue,[(o(!0),a(U,null,I(f.value,(_,g)=>(o(),a("div",{key:g,class:B(["cell",k(_)])},[t("span",de,l(_.day),1)],2))),128))]),w.value?(o(),a("div",ce,[i[0]||(i[0]=t("span",{class:"dot entry"},null,-1)),M(" Entry: "+l(w.value)+" ",1),i[1]||(i[1]=t("span",{class:"dot today"},null,-1)),i[2]||(i[2]=M(" Today ",-1))])):h("",!0)]))}},me=H(ve,[["__scopeId","data-v-571cb7a7"]]),_e={class:"dashboard-layout"},ye={class:"navbar"},ge={class:"user-info"},pe={key:0},he={class:"main-container"},fe={class:"sidebar"},ke={class:"content"},be={class:"card"},De={key:0,class:"loading-text"},Se={key:1},we={class:"major-banner"},Ce={class:"major-pill"},Te={class:"status-grid"},Me={class:"left-panel"},$e={class:"status-item"},Ne={key:0,class:"text-muted"},xe={class:"text-muted"},Fe={class:"status-item"},je={class:"progress-wrap"},Ye={class:"progress-inner"},Pe={class:"progress-pct"},Ue={class:"progress-sub"},Ie={class:"status-item"},Le={key:0,class:"status-bad"},Ae={key:1,class:"status-good"},Be={key:2,class:"hold-list"},Ee={class:"status-item deficiency-section"},Re={key:0,class:"text-muted"},Ve={key:1,class:"deficiency-list"},Ge={class:"course-code"},Oe={class:"course-name"},We={class:"course-badge"},qe={class:"right-panel"},ze={class:"status-item upload-section"},He={class:"doc-status"},Je={class:"doc-row"},Ke={class:"doc-right"},Qe={key:0,class:"doc-comment"},Xe={class:"doc-row"},Ze={class:"doc-right"},et={key:1,class:"doc-comment"},tt={class:"status-item events-section"},st={class:"events-head"},nt=["disabled"],at={key:1,class:"loading-text"},ot={key:2,class:"text-muted"},lt={key:3,class:"events-list"},rt=["disabled","onChange"],it={class:"event-body"},ut={class:"event-title"},dt={class:"event-meta text-muted"},ct={key:0},vt={key:1},P=4,mt={__name:"DashboardView",setup(E){const m=se(),j=v({}),S=v([]),$=v([]),N=v([]),y=v(null),d=v(null),L=v(!0),w=v([]),T=v(!1),f=v(""),k=v(!0),Y=v(""),x=s=>$.value.find(e=>e.doc_type===s)||null,r=p(()=>{var s;return((s=x("admission_letter"))==null?void 0:s.status)||"none"}),i=p(()=>{var s;return((s=x("admission_letter"))==null?void 0:s.admin_comment)||""}),_=p(()=>{var s;return((s=x("major_professor_form"))==null?void 0:s.status)||"none"}),g=p(()=>{var s;return((s=x("major_professor_form"))==null?void 0:s.admin_comment)||""}),D=p(()=>{var n,u;const s=String(((n=y.value)==null?void 0:n.major_name)||"").trim();if(s)return s;const e=String(((u=y.value)==null?void 0:u.major_code)||"").trim();return e==="CS"?"Computer Science":e||"Not set"}),R=s=>{const e=new Date(s+"T00:00:00");if(isNaN(e.getTime()))return"Unknown";const n=e.getFullYear(),u=e.getMonth()+1;return u<=4?`${n}SP`:u<=8?`${n}SU`:`${n}FA`},V=s=>{const e=String(s).match(/^(\d{4})(SP|SU|FA)$/);if(!e)return 0;const n=Number(e[1]),u=e[2],c=u==="SP"?0:u==="SU"?1:2;return n*3+c},b=p(()=>{if(d.value)return{entryDate:d.value.entry_date||"",entryTerm:d.value.entry_term_code||"Unknown",currentTerm:d.value.current_term_code||"Unknown",termNumber:Number(d.value.term_number||1)};const s=y.value||{},e=s.entry_date||"",n=s.entry_term_code||(e?R(e):""),u=R(new Date().toISOString().slice(0,10)),c=n?Math.max(1,V(u)-V(n)+1):1;return{entryDate:e,entryTerm:n||"Unknown",currentTerm:u,termNumber:c}}),G=p(()=>{var n;const s=Number(((n=b.value)==null?void 0:n.termNumber)||1),e=Math.max(1,Math.min(P,s));return Math.round(e/P*100)}),J=p(()=>({background:`conic-gradient(#16a34a ${G.value}%, #e5e7eb 0)`}));te(async()=>{const s=localStorage.getItem("user");s?(j.value=JSON.parse(s),await K(),await O()):m.push("/")});const K=async()=>{try{const s=await A.get("get_status.php");s.data.status==="success"&&(S.value=s.data.holds,$.value=s.data.documents,N.value=s.data.deficiencies||[],y.value=s.data.profile||null,d.value=s.data.term||null)}catch(s){console.error(s)}finally{L.value=!1}},O=async()=>{var s,e,n,u;T.value=!0,f.value="",k.value=!0;try{const c=await A.get("student_list_events.php");((s=c.data)==null?void 0:s.status)==="success"?w.value=c.data.data||[]:(k.value=!1,f.value=((e=c.data)==null?void 0:e.message)||"Failed to load events.")}catch(c){k.value=!1,f.value=((u=(n=c==null?void 0:c.response)==null?void 0:n.data)==null?void 0:u.message)||"Failed to load events."}finally{T.value=!1}},Q=async(s,e)=>{var u,c,W,q,z;if((u=e==null?void 0:e.target)!=null&&u.checked){Y.value=String((s==null?void 0:s.id)||""),f.value="",k.value=!0;try{const F=await A.post("student_mark_assignment_read.php",{assignment_id:s.id});((c=F.data)==null?void 0:c.status)==="success"?w.value=(w.value||[]).filter(Z=>Z.id!==s.id):(k.value=!1,f.value=((W=F.data)==null?void 0:W.message)||"Failed.",e!=null&&e.target&&(e.target.checked=!1))}catch(F){k.value=!1,f.value=((z=(q=F==null?void 0:F.response)==null?void 0:q.data)==null?void 0:z.message)||"Failed.",e!=null&&e.target&&(e.target.checked=!1)}finally{Y.value=""}}},X=async()=>{try{await A.post("logout.php")}catch{}localStorage.removeItem("user"),m.push("/")};return(s,e)=>(o(),a("div",_e,[t("header",ye,[e[8]||(e[8]=t("div",{class:"brand"},"Grad System",-1)),t("div",ge,[j.value.username?(o(),a("span",pe,"Welcome, "+l(j.value.username),1)):h("",!0),t("button",{onClick:X,class:"btn-logout"},"Logout")])]),t("div",he,[t("aside",fe,[t("nav",null,[t("ul",null,[e[9]||(e[9]=t("li",{class:"active"},"Dashboard",-1)),t("li",{onClick:e[0]||(e[0]=n=>C(m).push("/my-courses"))},"My Courses"),t("li",{onClick:e[1]||(e[1]=n=>C(m).push("/documents"))},"Documents"),t("li",{onClick:e[2]||(e[2]=n=>C(m).push("/assignments"))},"Assignments"),t("li",{onClick:e[3]||(e[3]=n=>C(m).push("/profile"))},"Profile"),b.value.termNumber>=2?(o(),a("li",{key:0,onClick:e[4]||(e[4]=n=>C(m).push("/major-professor"))},"Major Professor")):h("",!0),b.value.termNumber>=3?(o(),a("li",{key:1,onClick:e[5]||(e[5]=n=>C(m).push("/thesis-project"))},"Thesis / Project")):h("",!0)])])]),t("main",ke,[t("div",be,[e[24]||(e[24]=t("h2",null,"Student Status",-1)),L.value?(o(),a("div",De,"Loading status...")):(o(),a("div",Se,[t("div",we,[e[10]||(e[10]=t("span",{class:"major-label"},"Major / Program",-1)),t("span",Ce,l(D.value),1)]),t("div",Te,[t("div",Me,[t("div",$e,[e[15]||(e[15]=t("h3",null,"Academic Calendar",-1)),b.value.entryDate?(o(),a("div",Ne,[e[11]||(e[11]=M(" Entry Date: ",-1)),t("strong",null,l(b.value.entryDate),1),e[12]||(e[12]=M(" · Entry Term: ",-1)),t("strong",null,l(b.value.entryTerm),1)])):h("",!0),t("div",xe,[e[13]||(e[13]=M(" Current Term: ",-1)),t("strong",null,l(b.value.currentTerm),1),e[14]||(e[14]=M(" · You are in ",-1)),t("strong",null,"Term "+l(b.value.termNumber),1)]),ne(me,{"entry-date":b.value.entryDate},null,8,["entry-date"])]),t("div",Fe,[e[16]||(e[16]=t("h3",null,"Graduation Progress",-1)),t("div",je,[t("div",{class:"progress-ring",style:ae(J.value)},[t("div",Ye,[t("div",Pe,l(G.value)+"%",1),t("div",Ue,"Term "+l(Math.min(b.value.termNumber,P))+" / "+l(P),1)])],4),t("div",{class:"text-muted"}," Based on your current term in the program (Term 1 → Term "+l(P)+"). ")])]),t("div",Ie,[e[17]||(e[17]=t("h3",null,"Current Holds",-1)),S.value.length>0?(o(),a("div",Le,"You have "+l(S.value.length)+" active hold(s).",1)):(o(),a("div",Ae,"No Holds. You are good to register.")),S.value.length>0?(o(),a("ul",Be,[(o(!0),a(U,null,I(S.value,n=>(o(),a("li",{key:n.id},l(n.hold_type)+" (Active)",1))),128))])):h("",!0)]),t("div",Ee,[e[18]||(e[18]=t("h3",null,"Deficiency Courses",-1)),N.value.length===0?(o(),a("div",Re,"No deficiency courses assigned.")):(o(),a("ul",Ve,[(o(!0),a(U,null,I(N.value,n=>(o(),a("li",{key:n.course_code},[t("span",Ge,l(n.course_code),1),t("span",Oe,l(n.course_name),1),t("span",We,l(n.status),1)]))),128))]))])]),t("div",qe,[t("div",ze,[e[21]||(e[21]=t("h3",null,"Documents Status",-1)),t("div",He,[t("div",Je,[e[19]||(e[19]=t("div",{class:"doc-left"},[t("div",{class:"doc-title"},"Admission Letter"),t("div",{class:"doc-sub"},"Required for Term 1 hold release")],-1)),t("div",Ke,[t("span",{class:B(["badge",r.value])},l(r.value),3)])]),r.value==="rejected"&&i.value?(o(),a("div",Qe," Reviewer comment: "+l(i.value),1)):h("",!0),t("div",Xe,[e[20]||(e[20]=t("div",{class:"doc-left"},[t("div",{class:"doc-title"},"Major Professor Form"),t("div",{class:"doc-sub"},"Required for Term 2 hold release")],-1)),t("div",Ze,[t("span",{class:B(["badge",_.value])},l(_.value),3)])]),_.value==="rejected"&&g.value?(o(),a("div",et," Reviewer comment: "+l(g.value),1)):h("",!0)]),t("button",{class:"btn-primary",onClick:e[6]||(e[6]=n=>C(m).push("/documents"))},"Go to Documents"),e[22]||(e[22]=t("p",{class:"text-muted",style:{"margin-top":"10px"}}," Uploads are handled in Documents. Dashboard only shows status. ",-1))]),t("div",tt,[t("div",st,[e[23]||(e[23]=t("h3",{style:{margin:"0"}},"Events",-1)),t("button",{class:"btn-secondary",onClick:O,disabled:T.value},"Refresh",8,nt)]),f.value?(o(),a("div",{key:0,class:B(["msg",{ok:k.value,bad:!k.value}])},l(f.value),3)):h("",!0),T.value?(o(),a("div",at,"Loading events...")):w.value.length===0?(o(),a("div",ot,"No new events.")):(o(),a("div",lt,[(o(!0),a(U,null,I(w.value,n=>(o(),a("label",{key:n.id,class:"event-item"},[t("input",{type:"checkbox",disabled:Y.value===String(n.id),onChange:u=>Q(n,u)},null,40,rt),t("div",it,[t("div",ut,l(n.title),1),t("div",dt,[n.course_name||n.course_code?(o(),a("span",ct,"Course: "+l(n.course_name||n.course_code)+" · ",1)):h("",!0),M(" From: "+l(n.faculty_username||"Faculty")+" · "+l(n.created_at)+" ",1),n.due_at?(o(),a("span",vt," · Due: "+l(n.due_at),1)):h("",!0)])])]))),128))])),t("button",{class:"btn-primary",style:{"margin-top":"12px"},onClick:e[7]||(e[7]=n=>C(m).push("/assignments"))},"Go to Assignments")])])])]))])])])]))}},yt=H(mt,[["__scopeId","data-v-5d8a74c0"]]);export{yt as default};
