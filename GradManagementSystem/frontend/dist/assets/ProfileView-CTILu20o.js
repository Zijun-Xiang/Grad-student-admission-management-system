import{_ as $,r as v,o as F,h as L,c as r,a,d as f,t as h,u as _,n as D,e as g,g as b,v as A,F as B,f as E,i as k,j as u}from"./index-CHzR5xCe.js";const I={class:"dashboard-layout"},R={class:"navbar"},T={class:"user-info"},O={key:0},z={class:"main-container"},G={class:"sidebar"},J={class:"content"},W={class:"card"},q={key:0,class:"loading-text"},H={key:1,class:"form-grid"},K={class:"form-group"},Q=["value"],X={class:"form-group"},Y=["value"],Z={key:1,class:"form-group"},ee={key:2,class:"form-group"},ae={class:"form-group"},se={class:"form-group"},le=["value"],te={class:"form-group"},oe={class:"form-group"},ne={class:"form-actions"},re=["disabled"],ue={__name:"ProfileView",setup(ie){const i=L(),y=v({}),j=v(null),S=v(!0),C=v(!1),d=v(""),m=v(!0),P=v([{major_code:"CS",major_name:"Computer Science"}]),c=v({username:"",role:"student"}),s=v({first_name:"",last_name:"",email:"",major_code:"CS",password:"",confirm:""}),M=async()=>{var t;try{const e=await k.get("majors_list.php");((t=e.data)==null?void 0:t.status)==="success"&&Array.isArray(e.data.data)&&e.data.data.length>0&&(P.value=e.data.data)}catch{}},V=async()=>{var n,o;const t=await k.get("profile_get.php");if(((n=t.data)==null?void 0:n.status)!=="success")throw new Error(((o=t.data)==null?void 0:o.message)||"Failed");const e=t.data.data||{};c.value=e,s.value.first_name=e.first_name||"",s.value.last_name=e.last_name||"",s.value.email=e.email||"",s.value.major_code=e.major_code||"CS"},U=async()=>{var t;try{const e=await k.get("get_status.php");((t=e.data)==null?void 0:t.status)==="success"&&(j.value=e.data.term||null)}catch{j.value=null}};F(async()=>{var e,n;const t=localStorage.getItem("user");if(!t)return i.push("/");if(y.value=JSON.parse(t),y.value.role!=="student")return i.push(y.value.role==="faculty"?"/faculty":"/admin");S.value=!0,d.value="";try{await Promise.all([M(),V(),U()])}catch(o){m.value=!1,d.value=((n=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:n.message)||(o==null?void 0:o.message)||"Failed to load profile."}finally{S.value=!1}});const x=async()=>{var t,e,n,o,w;if(d.value="",m.value=!0,s.value.password&&s.value.password!==s.value.confirm){m.value=!1,d.value="Passwords do not match.";return}C.value=!0;try{const p={email:s.value.email,major_code:s.value.major_code,first_name:c.value.role==="student"?s.value.first_name:void 0,last_name:c.value.role==="student"?s.value.last_name:void 0,password:s.value.password||""},l=await k.post("profile_update.php",p);((t=l.data)==null?void 0:t.status)==="success"?(m.value=!0,d.value=((e=l.data)==null?void 0:e.message)||"Saved.",s.value.password="",s.value.confirm="",await V()):(m.value=!1,d.value=((n=l.data)==null?void 0:n.message)||"Save failed.")}catch(p){m.value=!1,d.value=((w=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:w.message)||"Save failed."}finally{C.value=!1}},N=async()=>{try{await k.post("logout.php")}catch{}localStorage.removeItem("user"),i.push("/")};return(t,e)=>{var n,o,w,p;return u(),r("div",I,[a("header",R,[e[12]||(e[12]=a("div",{class:"brand"},"Grad System",-1)),a("div",T,[y.value.username?(u(),r("span",O,"Welcome, "+h(y.value.username),1)):f("",!0),a("button",{onClick:N,class:"btn-logout"},"Logout")])]),a("div",z,[a("aside",G,[a("nav",null,[a("ul",null,[a("li",{onClick:e[0]||(e[0]=l=>_(i).push("/dashboard"))},"Dashboard"),a("li",{onClick:e[1]||(e[1]=l=>_(i).push("/my-courses"))},"My Courses"),a("li",{onClick:e[2]||(e[2]=l=>_(i).push("/documents"))},"Documents"),a("li",{onClick:e[3]||(e[3]=l=>_(i).push("/assignments"))},"Assignments"),e[13]||(e[13]=a("li",{class:"active"},"Profile",-1)),(o=(n=j.value)==null?void 0:n.unlocks)!=null&&o.term2?(u(),r("li",{key:0,onClick:e[4]||(e[4]=l=>_(i).push("/major-professor"))},"Major Professor")):f("",!0),(p=(w=j.value)==null?void 0:w.unlocks)!=null&&p.term3?(u(),r("li",{key:1,onClick:e[5]||(e[5]=l=>_(i).push("/thesis-project"))},"Thesis / Project")):f("",!0)])])]),a("main",J,[a("div",W,[e[22]||(e[22]=a("h2",null,"My Profile",-1)),S.value?(u(),r("div",q,"Loading...")):(u(),r("div",H,[d.value?(u(),r("div",{key:0,class:D(["msg",{ok:m.value,bad:!m.value}])},h(d.value),3)):f("",!0),a("div",K,[e[14]||(e[14]=a("label",null,"Username",-1)),a("input",{value:c.value.username,disabled:""},null,8,Q)]),a("div",X,[e[15]||(e[15]=a("label",null,"Role",-1)),a("input",{value:c.value.role,disabled:""},null,8,Y)]),c.value.role==="student"?(u(),r("div",Z,[e[16]||(e[16]=a("label",null,"First Name",-1)),g(a("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.first_name=l),type:"text"},null,512),[[b,s.value.first_name]])])):f("",!0),c.value.role==="student"?(u(),r("div",ee,[e[17]||(e[17]=a("label",null,"Last Name",-1)),g(a("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.last_name=l),type:"text"},null,512),[[b,s.value.last_name]])])):f("",!0),a("div",ae,[e[18]||(e[18]=a("label",null,"Email",-1)),g(a("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.email=l),type:"email",placeholder:"Optional"},null,512),[[b,s.value.email]])]),a("div",se,[e[19]||(e[19]=a("label",null,"Major / Program",-1)),g(a("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.major_code=l)},[(u(!0),r(B,null,E(P.value,l=>(u(),r("option",{key:l.major_code,value:l.major_code},h(l.major_name),9,le))),128))],512),[[A,s.value.major_code]])]),a("div",te,[e[20]||(e[20]=a("label",null,"New Password",-1)),g(a("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.password=l),type:"password",placeholder:"Leave blank to keep current password"},null,512),[[b,s.value.password]])]),a("div",oe,[e[21]||(e[21]=a("label",null,"Confirm Password",-1)),g(a("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.confirm=l),type:"password",placeholder:"Re-enter new password"},null,512),[[b,s.value.confirm]])]),a("div",ne,[a("button",{class:"btn-primary",onClick:x,disabled:C.value},h(C.value?"Saving...":"Save Changes"),9,re)])]))])])])])}}},ve=$(ue,[["__scopeId","data-v-bbc1892a"]]);export{ve as default};
