import{_ as S,r as l,o as N,h as q,i as y,c as a,a as e,t as p,d as b,u,l as i,e as F,v as Y,F as $,f as R,j as n}from"./index-CHzR5xCe.js";const T={class:"dashboard-layout"},V={class:"navbar"},D={class:"user-info"},L={class:"main-container"},U={class:"sidebar"},B={class:"content"},I={class:"content-inner"},A={class:"card"},E={key:0,class:"status-box pending"},G={class:"text-muted"},H={key:1,class:"status-box approved"},J={key:2,class:"status-box pending"},O={key:3,class:"form-block"},W={class:"form-section"},z=["value"],K=["disabled"],Q={key:0,class:"card mt-20"},X={key:0,class:"status-box pending"},Z={key:1,class:"status-box approved"},ss={key:2,class:"status-box"},es={key:0,class:"text-error"},ts={key:1},os={__name:"MajorProfessorView",setup(as){const r=q(),P=l({}),g=l([]),v=l(""),m=l("none"),c=l(""),j=l([]),f=l("none"),d=l(1);N(()=>{const o=localStorage.getItem("user");o?(P.value=JSON.parse(o),w(),x()):r.push("/")});const w=async()=>{try{const o=await y.get("get_faculty_list.php");o.data.status==="success"&&(g.value=o.data.data)}catch(o){console.error(o)}},x=async()=>{var o,s;try{const t=await y.get("get_status.php");if(t.data.status!=="success")return;d.value=Number(((s=(o=t.data)==null?void 0:o.term)==null?void 0:s.term_number)||1);const k=t.data.mp_info;k&&(m.value=k.mp_status,c.value=k.prof_name||"Unknown"),j.value=t.data.documents||[];const _=j.value.find(C=>C.doc_type==="major_professor_form");f.value=(_==null?void 0:_.status)||"none"}catch(t){console.error("Failed to check status",t)}},M=async()=>{try{const o=await y.post("request_major_professor.php",{professor_id:v.value});if(o.data.status==="success"){alert("Request sent. Please wait for approval."),m.value="pending";const s=g.value.find(t=>t.user_id===v.value);c.value=s?s.username:"Unknown"}else alert(o.data.message||"Request failed")}catch{alert("Network Error")}},h=async()=>{try{await y.post("logout.php")}catch{}localStorage.removeItem("user"),r.push("/")};return(o,s)=>(n(),a("div",T,[e("header",V,[s[8]||(s[8]=e("div",{class:"brand"},"Grad System",-1)),e("div",D,[e("span",null,"Welcome, "+p(P.value.username),1),e("button",{onClick:h,class:"btn-logout"},"Logout")])]),e("div",L,[e("aside",U,[e("nav",null,[e("ul",null,[e("li",{onClick:s[0]||(s[0]=t=>u(r).push("/dashboard"))},"Dashboard"),e("li",{onClick:s[1]||(s[1]=t=>u(r).push("/my-courses"))},"My Courses"),e("li",{onClick:s[2]||(s[2]=t=>u(r).push("/documents"))},"Documents"),e("li",{onClick:s[3]||(s[3]=t=>u(r).push("/assignments"))},"Assignments"),e("li",{onClick:s[4]||(s[4]=t=>u(r).push("/profile"))},"Profile"),s[9]||(s[9]=e("li",{class:"active"},"Major Professor",-1)),d.value>=3?(n(),a("li",{key:0,onClick:s[5]||(s[5]=t=>u(r).push("/thesis-project"))},"Thesis / Project")):b("",!0)])])]),e("main",B,[e("div",I,[e("div",A,[s[21]||(s[21]=e("h2",null,"Select Major Professor",-1)),d.value<2?(n(),a("div",E,[s[10]||(s[10]=e("h3",null,"Locked",-1)),s[11]||(s[11]=e("p",null,[i("Major Professor selection is available starting "),e("strong",null,"Term 2"),i(".")],-1)),e("p",G,"You are currently in Term "+p(d.value)+".",1)])):b("",!0),m.value==="approved"?(n(),a("div",H,[s[13]||(s[13]=e("h3",null,"You have a Major Professor",-1)),e("p",null,[s[12]||(s[12]=i("Your advisor is: ",-1)),e("strong",null,p(c.value),1)])])):d.value>=2&&m.value==="pending"?(n(),a("div",J,[s[16]||(s[16]=e("h3",null,"Request Pending",-1)),e("p",null,[s[14]||(s[14]=i("You have requested ",-1)),e("strong",null,p(c.value),1),s[15]||(s[15]=i(" as your advisor.",-1))]),s[17]||(s[17]=e("p",null,"Please wait for their approval.",-1))])):d.value>=2?(n(),a("div",O,[s[20]||(s[20]=e("div",{class:"alert-box"},'You have a "Major Professor" Hold. Please select an advisor to proceed.',-1)),e("div",W,[s[19]||(s[19]=e("label",null,"Choose a Faculty Member:",-1)),F(e("select",{"onUpdate:modelValue":s[6]||(s[6]=t=>v.value=t),class:"prof-select"},[s[18]||(s[18]=e("option",{disabled:"",value:""},"-- Select Professor --",-1)),(n(!0),a($,null,R(g.value,t=>(n(),a("option",{key:t.user_id,value:t.user_id},p(t.username)+" ("+p(t.email)+") ",9,z))),128))],512),[[Y,v.value]]),e("button",{onClick:M,class:"btn-primary",disabled:!v.value},"Submit Request",8,K)])])):b("",!0)]),m.value==="approved"?(n(),a("div",Q,[s[24]||(s[24]=e("h2",null,"Major Professor Form (Term 2)",-1)),s[25]||(s[25]=e("p",{class:"text-muted"},[i(" All document uploads are handled in "),e("strong",null,"Documents"),i(". This page only manages advisor selection. ")],-1)),f.value==="pending"?(n(),a("div",X,[...s[22]||(s[22]=[e("p",null,"Your form is under review.",-1)])])):f.value==="approved"?(n(),a("div",Z,[...s[23]||(s[23]=[e("p",null,"Your form has been approved.",-1)])])):(n(),a("div",ss,[f.value==="rejected"?(n(),a("p",es,"Previous upload was rejected. Please re-upload.")):(n(),a("p",ts,"No form uploaded yet.")),e("button",{class:"btn-primary",onClick:s[7]||(s[7]=t=>u(r).push("/documents"))},"Go to Documents")]))])):b("",!0)])])])]))}},rs=S(os,[["__scopeId","data-v-2f61791a"]]);export{rs as default};
