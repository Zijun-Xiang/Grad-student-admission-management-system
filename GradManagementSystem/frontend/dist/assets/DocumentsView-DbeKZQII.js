import{_ as O,r as i,l as B,h as I,c as a,a as s,d as r,t as n,u as D,n as L,F as j,f as x,k as P,i as m,o as l}from"./index-DT2F-dT6.js";const W={class:"dashboard-layout"},q={class:"navbar"},z={class:"user-info"},E={key:0},G={class:"main-container"},J={class:"sidebar"},H={class:"content"},K={class:"card mb-30"},Q={class:"upload-grid"},X={class:"upload-panel"},Y=["disabled"],Z={class:"upload-panel"},ss=["disabled"],es={class:"card"},ts={key:0,class:"loading-text"},os={key:1,class:"empty-state"},as={key:2,class:"doc-list"},ls={class:"info"},ns={class:"title"},is={class:"meta"},ds={key:0},us={key:0,class:"comment"},cs={class:"actions"},rs=["onClick"],ms=["onClick"],vs={key:0,class:"modal-overlay"},ps={class:"modal-box wide-modal"},_s={key:0,class:"comment-meta"},fs={class:"comment-list"},hs={key:0,class:"loading-text"},ys={key:1,class:"empty-state"},gs={key:2},bs={class:"comment-head"},ks={class:"comment-author"},Cs={class:"comment-time"},ws={class:"comment-body"},Fs={__name:"DocumentsView",setup(Us){const v=I(),b=i({}),k=i(!0),C=i([]),p=i(null),_=i(null),y=i(!1),g=i(!1),d=i(""),c=i(!0),w=i(!1),f=i(null),h=i([]),F=i(!1),M=o=>{var t,e;p.value=((e=(t=o==null?void 0:o.target)==null?void 0:t.files)==null?void 0:e[0])??null},R=o=>{var t,e;_.value=((e=(t=o==null?void 0:o.target)==null?void 0:t.files)==null?void 0:e[0])??null},U=async()=>{k.value=!0;try{const o=await m.get("get_status.php");o.data.status==="success"&&(C.value=o.data.documents||[])}finally{k.value=!1}},$=async()=>{var o,t;if(p.value){y.value=!0,d.value="";try{const e=new FormData;e.append("file",p.value);const u=await m.post("upload_letter.php",e);u.data.status==="success"?(c.value=!0,d.value="Admission letter uploaded. Waiting for review.",p.value=null,await U()):(c.value=!1,d.value=u.data.message||"Upload failed")}catch(e){c.value=!1,d.value=((t=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:t.message)||"Upload failed"}finally{y.value=!1}}},A=async()=>{var o,t;if(_.value){g.value=!0,d.value="";try{const e=new FormData;e.append("file",_.value);const u=await m.post("upload_major_professor_form.php",e);u.data.status==="success"?(c.value=!0,d.value="Major Professor form uploaded. Waiting for review.",_.value=null,await U()):(c.value=!1,d.value=u.data.message||"Upload failed")}catch(e){c.value=!1,d.value=((t=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:t.message)||"Upload failed"}finally{g.value=!1}}},N=async o=>{try{const e=(await m.get(`download_document.php?doc_id=${o.doc_id}`,{responseType:"blob"})).data,u=URL.createObjectURL(e);window.open(u,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(u),6e4)}catch{alert("Failed to open document.")}},V=async o=>{f.value=o,w.value=!0,h.value=[],F.value=!0;try{const t=await m.get(`document_comments_list.php?doc_id=${o.doc_id}`);t.data.status==="success"&&(h.value=t.data.data||[])}finally{F.value=!1}},S=()=>{w.value=!1,f.value=null,h.value=[]},T=async()=>{try{await m.post("logout.php")}catch{}localStorage.removeItem("user"),v.push("/")};return B(()=>{const o=localStorage.getItem("user");if(!o)return v.push("/");b.value=JSON.parse(o),U()}),(o,t)=>(l(),a("div",W,[s("header",q,[t[3]||(t[3]=s("div",{class:"brand"},"Grad System",-1)),s("div",z,[b.value.username?(l(),a("span",E,"Welcome, "+n(b.value.username),1)):r("",!0),s("button",{onClick:T,class:"btn-logout"},"Logout")])]),s("div",G,[s("aside",J,[s("nav",null,[s("ul",null,[s("li",{onClick:t[0]||(t[0]=e=>D(v).push("/dashboard"))},"Dashboard"),s("li",{onClick:t[1]||(t[1]=e=>D(v).push("/my-courses"))},"My Courses"),t[4]||(t[4]=s("li",{class:"active"},"Documents",-1)),s("li",{onClick:t[2]||(t[2]=e=>D(v).push("/major-professor"))},"Major Professor")])])]),s("main",H,[s("div",K,[t[9]||(t[9]=s("h2",null,"Upload Documents",-1)),s("div",Q,[s("div",X,[t[5]||(t[5]=s("h3",null,"Admission Letter",-1)),t[6]||(t[6]=s("p",{class:"text-muted"},"Required for Term 1 hold release.",-1)),s("input",{type:"file",onChange:M,accept:".pdf,.jpg,.png"},null,32),s("button",{class:"btn-primary",onClick:$,disabled:!p.value||y.value},n(y.value?"Uploading...":"Upload"),9,Y)]),s("div",Z,[t[7]||(t[7]=s("h3",null,"Major Professor Form",-1)),t[8]||(t[8]=s("p",{class:"text-muted"},"Required for Term 2 hold release.",-1)),s("input",{type:"file",onChange:R,accept:".pdf,.jpg,.png"},null,32),s("button",{class:"btn-primary",onClick:A,disabled:!_.value||g.value},n(g.value?"Uploading...":"Upload"),9,ss)])]),d.value?(l(),a("div",{key:0,class:L(["msg",{ok:c.value,bad:!c.value}])},n(d.value),3)):r("",!0)]),s("div",es,[t[10]||(t[10]=s("h2",null,"My Documents",-1)),k.value?(l(),a("div",ts,"Loading...")):C.value.length===0?(l(),a("div",os,"No documents uploaded.")):(l(),a("div",as,[(l(!0),a(j,null,x(C.value,e=>(l(),a("div",{key:e.doc_id,class:"doc-item"},[s("div",ls,[s("div",ns,[s("strong",null,n(e.doc_type),1),s("span",{class:L(["badge",e.status])},n(e.status),3)]),s("div",is,[s("span",null,n(e.file_path),1),e.upload_date?(l(),a("span",ds,"· "+n(e.upload_date),1)):r("",!0)]),e.admin_comment?(l(),a("div",us,"Admin comment: "+n(e.admin_comment),1)):r("",!0)]),s("div",cs,[s("button",{class:"btn-secondary",onClick:u=>N(e)},"View",8,rs),s("button",{class:"btn-secondary",onClick:u=>V(e)},"Comments",8,ms)])]))),128))]))])])]),w.value?(l(),a("div",vs,[s("div",ps,[t[11]||(t[11]=s("h3",null,"Comments",-1)),f.value?(l(),a("div",_s,[s("strong",null,n(f.value.doc_type),1),P(" · doc_id="+n(f.value.doc_id),1)])):r("",!0),s("div",fs,[F.value?(l(),a("div",hs,"Loading comments...")):h.value.length===0?(l(),a("div",ys,"No comments yet.")):(l(),a("div",gs,[(l(!0),a(j,null,x(h.value,e=>(l(),a("div",{key:e.id,class:"comment-item"},[s("div",bs,[s("span",ks,n(e.author_username||e.author_role),1),s("span",Cs,n(e.created_at),1)]),s("div",ws,n(e.comment),1)]))),128))]))]),s("div",{class:"modal-actions"},[s("button",{class:"btn-cancel",onClick:S},"Close")])])])):r("",!0)]))}},Ls=O(Fs,[["__scopeId","data-v-f1645808"]]);export{Ls as default};
