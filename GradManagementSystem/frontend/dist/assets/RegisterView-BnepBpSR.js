import{_ as B,r as l,w as Y,o as I,c as u,a as t,b as L,d as N,e as r,v as k,F as x,f as P,g as n,t as y,u as G,h as H,i as $,j as d}from"./index-CHzR5xCe.js";const J={class:"login-container"},z={class:"login-card"},K={class:"form-group"},Q={class:"form-group"},W=["value"],X={class:"form-row"},Z={class:"form-group"},h=["value"],ee={class:"form-group"},te={key:0,class:"form-row"},ae={class:"form-group"},se={class:"form-group"},le={class:"form-group"},oe={class:"form-group"},re={class:"form-group"},ue={class:"form-group"},ne={class:"form-group"},de={key:1,class:"error-msg"},ie={key:2,class:"success-msg"},ve=["disabled"],me={__name:"RegisterView",setup(pe){const T=H(),b=l("student"),V=l(""),_=l(""),v=l(""),o=l(""),p=l(new Date().getFullYear()),C=l([]),U=l(""),F=l(""),w=l(""),M=l(""),j=l([{major_code:"CS",major_name:"Computer Science"}]),f=l("CS"),m=l(""),D=l(""),S=l(!1),R=s=>{const e=new Date(s+"T00:00:00");if(isNaN(e.getTime()))return"";const a=e.getFullYear(),g=e.getMonth()+1;return g<=4?`${a}SP`:g<=8?`${a}SU`:`${a}FA`};(()=>{const s=new Date().getFullYear();C.value=[];for(let e=s-5;e<=s+5;e++)C.value.push(e)})();const A=()=>new Date().toISOString().slice(0,10);o.value=A(),v.value=R(o.value);const E=()=>{if(!o.value)return;const s=o.value.split("-");s.length===3&&(o.value=`${p.value}-${s[1]}-${s[2]}`,v.value=R(o.value))},O=()=>{if(!o.value)return;const s=new Date(o.value+"T00:00:00");isNaN(s.getTime())||(p.value=s.getFullYear(),v.value=R(o.value))};Y(p,E),Y(o,O),I(async()=>{var s;try{const e=await $.get("majors_list.php");((s=e.data)==null?void 0:s.status)==="success"&&Array.isArray(e.data.data)&&e.data.data.length>0&&(j.value=e.data.data,j.value.some(a=>a.major_code===f.value)||(f.value=j.value[0].major_code))}catch{}});const q=async()=>{var s,e,a,g;if(m.value="",D.value="",w.value!==M.value){m.value="Passwords do not match.";return}S.value=!0;try{const c={role:b.value,username:U.value,email:F.value,password:w.value,first_name:V.value,last_name:_.value,term_code:v.value,entry_date:o.value,major_code:f.value},i=await $.post("register.php",c);((s=i.data)==null?void 0:s.status)==="success"?(localStorage.setItem("user",JSON.stringify(i.data.user)),D.value="Registration successful. Redirecting...",setTimeout(()=>{T.push(i.data.user.role==="faculty"?"/faculty":i.data.user.role==="admin"?"/admin":"/dashboard")},1500)):m.value=((e=i.data)==null?void 0:e.message)||"Registration failed."}catch(c){const i=(g=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:g.message;m.value=i||"Registration failed (network/CORS/DB)."}finally{S.value=!1}};return(s,e)=>(d(),u("div",J,[t("div",z,[e[25]||(e[25]=t("div",{class:"login-header"},[t("h1",null,"Create Account"),t("p",null,"Register as Student or Faculty")],-1)),t("form",{onSubmit:L(q,["prevent"])},[t("div",K,[e[13]||(e[13]=t("label",null,"Role",-1)),r(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),required:""},[...e[12]||(e[12]=[t("option",{value:"student"},"Student",-1),t("option",{value:"faculty"},"Faculty (GPD/Major Professor)",-1)])],512),[[k,b.value]])]),t("div",Q,[e[14]||(e[14]=t("label",null,"Major / Program",-1)),r(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),required:""},[(d(!0),u(x,null,P(j.value,a=>(d(),u("option",{key:a.major_code,value:a.major_code},y(a.major_name),9,W))),128))],512),[[k,f.value]])]),t("div",X,[t("div",Z,[e[15]||(e[15]=t("label",null,"Entry Year",-1)),r(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a)},[(d(!0),u(x,null,P(C.value,a=>(d(),u("option",{key:a,value:a},y(a),9,h))),128))],512),[[k,p.value]])]),t("div",ee,[e[16]||(e[16]=t("label",null,"Entry Date",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value=a),type:"date"},null,512),[[n,o.value]])])]),b.value==="student"?(d(),u("div",te,[t("div",ae,[e[17]||(e[17]=t("label",null,"First Name",-1)),r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>V.value=a),type:"text",placeholder:"First name"},null,512),[[n,V.value]])]),t("div",se,[e[18]||(e[18]=t("label",null,"Last Name",-1)),r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>_.value=a),type:"text",placeholder:"Last name"},null,512),[[n,_.value]])])])):N("",!0),t("div",le,[e[19]||(e[19]=t("label",null,"Entry Term Code (auto)",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a),type:"text",disabled:""},null,512),[[n,v.value]]),e[20]||(e[20]=t("div",{class:"hint"},"Derived from Entry Date. Used to tag your first-semester Hold.",-1))]),t("div",oe,[e[21]||(e[21]=t("label",null,"Username",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>U.value=a),type:"text",placeholder:"e.g. student1 / prof_jamil",required:""},null,512),[[n,U.value]])]),t("div",re,[e[22]||(e[22]=t("label",null,"Email",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>F.value=a),type:"email",placeholder:"Optional"},null,512),[[n,F.value]])]),t("div",ue,[e[23]||(e[23]=t("label",null,"Password",-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>w.value=a),type:"password",placeholder:"At least 6 characters",required:""},null,512),[[n,w.value]])]),t("div",ne,[e[24]||(e[24]=t("label",null,"Confirm Password",-1)),r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>M.value=a),type:"password",placeholder:"Re-enter password",required:""},null,512),[[n,M.value]])]),m.value?(d(),u("div",de,y(m.value),1)):N("",!0),D.value?(d(),u("div",ie,y(D.value),1)):N("",!0),t("button",{type:"submit",class:"btn-primary",disabled:S.value},y(S.value?"Creating...":"Create account"),9,ve),t("button",{type:"button",class:"btn-secondary",onClick:e[11]||(e[11]=a=>G(T).push("/"))},"Back to login")],32)])]))}},ye=B(me,[["__scopeId","data-v-0effcbb2"]]);export{ye as default};
