import{_ as C,r as l,l as N,h as q,i as y,c as a,a as e,t as d,d as b,u as p,k as u,e as F,v as Y,F as R,f as T,o as n}from"./index-Dl1toHCS.js";const V={class:"dashboard-layout"},$={class:"navbar"},D={class:"user-info"},L={class:"main-container"},U={class:"sidebar"},B={class:"content"},I={class:"content-inner"},A={class:"card"},E={key:0,class:"status-box pending"},G={class:"text-muted"},H={key:1,class:"status-box approved"},J={key:2,class:"status-box pending"},O={key:3,class:"form-block"},W={class:"form-section"},z=["value"],K=["disabled"],Q={key:0,class:"card mt-20"},X={key:0,class:"status-box pending"},Z={key:1,class:"status-box approved"},ss={key:2,class:"status-box"},es={key:0,class:"text-error"},ts={key:1},os={__name:"MajorProfessorView",setup(as){const r=q(),P=l({}),g=l([]),v=l(""),m=l("none"),c=l(""),j=l([]),f=l("none"),i=l(1);N(()=>{const o=localStorage.getItem("user");o?(P.value=JSON.parse(o),w(),x()):r.push("/")});const w=async()=>{try{const o=await y.get("get_faculty_list.php");o.data.status==="success"&&(g.value=o.data.data)}catch(o){console.error(o)}},x=async()=>{var o,s;try{const t=await y.get("get_status.php");if(t.data.status!=="success")return;i.value=Number(((s=(o=t.data)==null?void 0:o.term)==null?void 0:s.term_number)||1);const k=t.data.mp_info;k&&(m.value=k.mp_status,c.value=k.prof_name||"Unknown"),j.value=t.data.documents||[];const _=j.value.find(S=>S.doc_type==="major_professor_form");f.value=(_==null?void 0:_.status)||"none"}catch(t){console.error("Failed to check status",t)}},h=async()=>{try{const o=await y.post("request_major_professor.php",{professor_id:v.value});if(o.data.status==="success"){alert("Request sent. Please wait for approval."),m.value="pending";const s=g.value.find(t=>t.user_id===v.value);c.value=s?s.username:"Unknown"}else alert(o.data.message||"Request failed")}catch{alert("Network Error")}},M=async()=>{try{await y.post("logout.php")}catch{}localStorage.removeItem("user"),r.push("/")};return(o,s)=>(n(),a("div",V,[e("header",$,[s[7]||(s[7]=e("div",{class:"brand"},"Grad System",-1)),e("div",D,[e("span",null,"Welcome, "+d(P.value.username),1),e("button",{onClick:M,class:"btn-logout"},"Logout")])]),e("div",L,[e("aside",U,[e("nav",null,[e("ul",null,[e("li",{onClick:s[0]||(s[0]=t=>p(r).push("/dashboard"))},"Dashboard"),e("li",{onClick:s[1]||(s[1]=t=>p(r).push("/my-courses"))},"My Courses"),e("li",{onClick:s[2]||(s[2]=t=>p(r).push("/documents"))},"Documents"),e("li",{onClick:s[3]||(s[3]=t=>p(r).push("/assignments"))},"Assignments"),s[8]||(s[8]=e("li",{class:"active"},"Major Professor",-1)),i.value>=3?(n(),a("li",{key:0,onClick:s[4]||(s[4]=t=>p(r).push("/thesis-project"))},"Thesis / Project")):b("",!0)])])]),e("main",B,[e("div",I,[e("div",A,[s[20]||(s[20]=e("h2",null,"Select Major Professor",-1)),i.value<2?(n(),a("div",E,[s[9]||(s[9]=e("h3",null,"Locked",-1)),s[10]||(s[10]=e("p",null,[u("Major Professor selection is available starting "),e("strong",null,"Term 2"),u(".")],-1)),e("p",G,"You are currently in Term "+d(i.value)+".",1)])):b("",!0),m.value==="approved"?(n(),a("div",H,[s[12]||(s[12]=e("h3",null,"You have a Major Professor",-1)),e("p",null,[s[11]||(s[11]=u("Your advisor is: ",-1)),e("strong",null,d(c.value),1)])])):i.value>=2&&m.value==="pending"?(n(),a("div",J,[s[15]||(s[15]=e("h3",null,"Request Pending",-1)),e("p",null,[s[13]||(s[13]=u("You have requested ",-1)),e("strong",null,d(c.value),1),s[14]||(s[14]=u(" as your advisor.",-1))]),s[16]||(s[16]=e("p",null,"Please wait for their approval.",-1))])):i.value>=2?(n(),a("div",O,[s[19]||(s[19]=e("div",{class:"alert-box"},'You have a "Major Professor" Hold. Please select an advisor to proceed.',-1)),e("div",W,[s[18]||(s[18]=e("label",null,"Choose a Faculty Member:",-1)),F(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>v.value=t),class:"prof-select"},[s[17]||(s[17]=e("option",{disabled:"",value:""},"-- Select Professor --",-1)),(n(!0),a(R,null,T(g.value,t=>(n(),a("option",{key:t.user_id,value:t.user_id},d(t.username)+" ("+d(t.email)+") ",9,z))),128))],512),[[Y,v.value]]),e("button",{onClick:h,class:"btn-primary",disabled:!v.value},"Submit Request",8,K)])])):b("",!0)]),m.value==="approved"?(n(),a("div",Q,[s[23]||(s[23]=e("h2",null,"Major Professor Form (Term 2)",-1)),s[24]||(s[24]=e("p",{class:"text-muted"},[u(" All document uploads are handled in "),e("strong",null,"Documents"),u(". This page only manages advisor selection. ")],-1)),f.value==="pending"?(n(),a("div",X,[...s[21]||(s[21]=[e("p",null,"Your form is under review.",-1)])])):f.value==="approved"?(n(),a("div",Z,[...s[22]||(s[22]=[e("p",null,"Your form has been approved.",-1)])])):(n(),a("div",ss,[f.value==="rejected"?(n(),a("p",es,"Previous upload was rejected. Please re-upload.")):(n(),a("p",ts,"No form uploaded yet.")),e("button",{class:"btn-primary",onClick:s[6]||(s[6]=t=>p(r).push("/documents"))},"Go to Documents")]))])):b("",!0)])])])]))}},rs=C(os,[["__scopeId","data-v-daa087f4"]]);export{rs as default};
