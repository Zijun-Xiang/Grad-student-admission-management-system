import{_ as X,l as g,r as _,w as ot,c as a,a as e,d as v,t as l,F as E,f as L,n as R,m as C,k as o,o as lt,i as rt,j as N,u as S,g as it,p as ut,b as dt}from"./index-CqwOMfHx.js";const ct={class:"calendar"},mt={class:"cal-header"},vt={class:"title"},_t={class:"dow"},pt={class:"grid"},yt={class:"num"},gt={key:0,class:"legend"},ht={__name:"MiniCalendar",props:{entryDate:{type:String,default:""}},setup(q){const m=q,P=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],$=u=>{if(!u)return null;const i=new Date(u+"T00:00:00");return isNaN(i.getTime())?null:i},j=new Date,A=g(()=>$(m.entryDate)),f=_(j.getFullYear()),d=_(j.getMonth());ot(()=>m.entryDate,u=>{const i=$(u);i&&(f.value=i.getFullYear(),d.value=i.getMonth())},{immediate:!0});const G=g(()=>new Date(f.value,d.value,1).toLocaleString("en-US",{month:"long",year:"numeric"})),p=g(()=>{const u=A.value;if(!u)return"";const i=u.getFullYear(),y=String(u.getMonth()+1).padStart(2,"0"),h=String(u.getDate()).padStart(2,"0");return`${i}-${y}-${h}`}),T=(u,i)=>u&&i&&u.getFullYear()===i.getFullYear()&&u.getMonth()===i.getMonth()&&u.getDate()===i.getDate(),k=g(()=>{const i=new Date(f.value,d.value,1).getDay(),y=new Date(f.value,d.value+1,0).getDate(),h=[];for(let w=0;w<i;w++)h.push({day:"",date:null});for(let w=1;w<=y;w++)h.push({day:w,date:new Date(f.value,d.value,w)});for(;h.length%7!==0;)h.push({day:"",date:null});return h}),b=u=>u.date?{today:T(u.date,j),entry:T(u.date,A.value)}:"empty",Y=()=>{d.value===0?(d.value=11,f.value-=1):d.value-=1},U=()=>{d.value===11?(d.value=0,f.value+=1):d.value+=1};return(u,i)=>(o(),a("div",ct,[e("div",mt,[e("button",{class:"nav",onClick:Y},"<"),e("div",vt,l(G.value),1),e("button",{class:"nav",onClick:U},">")]),e("div",_t,[(o(),a(E,null,L(P,y=>e("div",{key:y,class:"dow-cell"},l(y),1)),64))]),e("div",pt,[(o(!0),a(E,null,L(k.value,(y,h)=>(o(),a("div",{key:h,class:R(["cell",b(y)])},[e("span",yt,l(y.day),1)],2))),128))]),p.value?(o(),a("div",gt,[i[0]||(i[0]=e("span",{class:"dot entry"},null,-1)),C(" Entry: "+l(p.value)+" ",1),i[1]||(i[1]=e("span",{class:"dot today"},null,-1)),i[2]||(i[2]=C(" Today ",-1))])):v("",!0)]))}},ft=X(ht,[["__scopeId","data-v-571cb7a7"]]),kt={class:"dashboard-layout"},bt={class:"navbar"},wt={class:"user-info"},Dt={key:0},St={class:"main-container"},Ct={class:"sidebar"},xt={class:"content"},$t={class:"card"},Mt={key:0,class:"loading-text"},Tt={key:1},Ft={class:"major-banner"},Nt={class:"major-pill"},jt={class:"status-grid"},At={class:"left-panel"},Yt={class:"status-item"},Et={key:0,class:"text-muted"},Pt={class:"text-muted"},Ut={class:"status-item"},Bt={class:"progress-wrap"},It={class:"progress-inner"},Lt={class:"progress-pct"},Gt={class:"progress-sub"},Vt={class:"status-item"},Rt={key:0,class:"status-bad"},Ot={key:1,class:"status-good"},Wt={key:2,class:"hold-list"},qt={class:"status-item deficiency-section"},zt={key:0,class:"text-muted"},Ht={key:1,class:"deficiency-list"},Jt={class:"course-code"},Kt={class:"course-name"},Qt={class:"course-badge"},Xt={class:"right-panel"},Zt={class:"status-item upload-section"},te={class:"doc-status"},ee={class:"doc-row"},se={class:"doc-right"},ne={key:0,class:"doc-comment"},ae={class:"doc-row"},oe={class:"doc-right"},le={key:1,class:"doc-comment"},re={class:"status-item events-section"},ie={class:"events-head"},ue={class:"dismiss-all"},de=["disabled"],ce={key:1,class:"loading-text"},me={key:2,class:"text-muted"},ve={key:3,class:"events-list"},_e={key:0,class:"event-item"},pe=["disabled","onChange"],ye={class:"event-body"},ge={class:"event-title"},he={class:"event-meta text-muted"},fe={key:0},ke={key:1},be={key:1,class:"event-item"},we=["disabled","onChange"],De={class:"event-body"},Se={class:"event-title"},Ce={class:"event-meta text-muted"},xe={key:0},$e={key:0,class:"event-meta text-muted",style:{"margin-top":"6px"}},Me={class:"event-meta text-muted",style:{"margin-top":"6px"}},Te={style:{display:"flex",gap:"10px","margin-top":"12px","flex-wrap":"wrap"}},I=4,Fe={__name:"DashboardView",setup(q){const m=rt(),P=_({}),$=_([]),j=_([]),A=_([]),f=_(null),d=_(null),G=_(!0),p=_([]),T=_(!1),k=_(""),b=_(!0),Y=_(""),U=_(!1),u=g(()=>(p.value||[]).some(s=>((s==null?void 0:s.type)||"assignment")==="assignment")),i=g(()=>(p.value||[]).some(s=>((s==null?void 0:s.type)||"assignment")==="course_action")),y=s=>j.value.find(t=>t.doc_type===s)||null,h=g(()=>{var s;return((s=y("admission_letter"))==null?void 0:s.status)||"none"}),w=g(()=>{var s;return((s=y("admission_letter"))==null?void 0:s.admin_comment)||""}),O=g(()=>{var s;return((s=y("major_professor_form"))==null?void 0:s.status)||"none"}),z=g(()=>{var s;return((s=y("major_professor_form"))==null?void 0:s.admin_comment)||""}),Z=g(()=>{var n,r;const s=String(((n=f.value)==null?void 0:n.major_name)||"").trim();if(s)return s;const t=String(((r=f.value)==null?void 0:r.major_code)||"").trim();return t==="CS"?"Computer Science":t||"Not set"}),H=s=>{const t=new Date(s+"T00:00:00");if(isNaN(t.getTime()))return"Unknown";const n=t.getFullYear(),r=t.getMonth()+1;return r<=4?`${n}SP`:r<=8?`${n}SU`:`${n}FA`},J=s=>{const t=String(s).match(/^(\d{4})(SP|SU|FA)$/);if(!t)return 0;const n=Number(t[1]),r=t[2],c=r==="SP"?0:r==="SU"?1:2;return n*3+c},D=g(()=>{if(d.value)return{entryDate:d.value.entry_date||"",entryTerm:d.value.entry_term_code||"Unknown",currentTerm:d.value.current_term_code||"Unknown",termNumber:Number(d.value.term_number||1)};const s=f.value||{},t=s.entry_date||"",n=s.entry_term_code||(t?H(t):""),r=H(new Date().toISOString().slice(0,10)),c=n?Math.max(1,J(r)-J(n)+1):1;return{entryDate:t,entryTerm:n||"Unknown",currentTerm:r,termNumber:c}}),K=g(()=>{var n;const s=Number(((n=D.value)==null?void 0:n.termNumber)||1),t=Math.max(1,Math.min(I,s));return Math.round(t/I*100)}),tt=g(()=>({background:`conic-gradient(#16a34a ${K.value}%, #e5e7eb 0)`}));lt(async()=>{const s=localStorage.getItem("user");s?(P.value=JSON.parse(s),await et(),await st()):m.push("/")});const et=async()=>{try{const s=await N.get("get_status.php");s.data.status==="success"&&($.value=s.data.holds,j.value=s.data.documents,A.value=s.data.deficiencies||[],f.value=s.data.profile||null,d.value=s.data.term||null)}catch(s){console.error(s)}finally{G.value=!1}},st=async()=>{var s,t,n,r;T.value=!0,k.value="",b.value=!0;try{const c=await N.get("student_list_events.php");((s=c.data)==null?void 0:s.status)==="success"?p.value=c.data.data||[]:(b.value=!1,k.value=((t=c.data)==null?void 0:t.message)||"Failed to load events.")}catch(c){b.value=!1,k.value=((r=(n=c==null?void 0:c.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to load events."}finally{T.value=!1}},Q=async(s,t)=>{var c,B,M,x,V;if(!!!((c=t==null?void 0:t.target)!=null&&c.checked))return;const r=String((s==null?void 0:s.type)||"assignment");Y.value=r==="assignment"?String((s==null?void 0:s.id)||""):`course-${(s==null?void 0:s.id)||""}`,k.value="",b.value=!0;try{const F=r==="assignment"?await N.post("student_mark_assignment_read.php",{assignment_id:s.id}):await N.post("student_mark_course_action_read.php",{action_id:s.id});((B=F.data)==null?void 0:B.status)==="success"?p.value=(p.value||[]).filter(W=>W.id!==s.id):(b.value=!1,k.value=((M=F.data)==null?void 0:M.message)||"Failed.",t!=null&&t.target&&(t.target.checked=!1))}catch(F){b.value=!1,k.value=((V=(x=F==null?void 0:F.response)==null?void 0:x.data)==null?void 0:V.message)||"Failed.",t!=null&&t.target&&(t.target.checked=!1)}finally{Y.value=""}},nt=async s=>{var n,r,c,B;if((n=s==null?void 0:s.target)!=null&&n.checked){U.value=!0,k.value="",b.value=!0;try{const M=Array.isArray(p.value)?[...p.value]:[];for(const x of M){const V=String((x==null?void 0:x.type)||"assignment");try{((r=(V==="assignment"?await N.post("student_mark_assignment_read.php",{assignment_id:x.id}):await N.post("student_mark_course_action_read.php",{action_id:x.id})).data)==null?void 0:r.status)==="success"&&(p.value=(p.value||[]).filter(W=>W.id!==x.id))}catch{}}}catch(M){b.value=!1,k.value=((B=(c=M==null?void 0:M.response)==null?void 0:c.data)==null?void 0:B.message)||"Failed."}finally{U.value=!1,s!=null&&s.target&&(s.target.checked=!1)}}},at=async()=>{try{await N.post("logout.php")}catch{}localStorage.removeItem("user"),m.push("/")};return(s,t)=>(o(),a("div",kt,[e("header",bt,[t[10]||(t[10]=e("div",{class:"brand"},"Grad System",-1)),e("div",wt,[P.value.username?(o(),a("span",Dt,"Welcome, "+l(P.value.username),1)):v("",!0),e("button",{onClick:at,class:"btn-logout"},"Logout")])]),e("div",St,[e("aside",Ct,[e("nav",null,[e("ul",null,[t[11]||(t[11]=e("li",{class:"active"},"Dashboard",-1)),e("li",{onClick:t[0]||(t[0]=n=>S(m).push("/my-courses"))},"My Courses"),e("li",{onClick:t[1]||(t[1]=n=>S(m).push("/documents"))},"Documents"),e("li",{onClick:t[2]||(t[2]=n=>S(m).push("/assignments"))},"Assignments"),e("li",{onClick:t[3]||(t[3]=n=>S(m).push("/profile"))},"Profile"),D.value.termNumber>=2?(o(),a("li",{key:0,onClick:t[4]||(t[4]=n=>S(m).push("/major-professor"))},"Major Professor")):v("",!0),D.value.termNumber>=3?(o(),a("li",{key:1,onClick:t[5]||(t[5]=n=>S(m).push("/thesis-project"))},"Thesis / Project")):v("",!0)])])]),e("main",xt,[e("div",$t,[t[29]||(t[29]=e("h2",null,"Student Status",-1)),G.value?(o(),a("div",Mt,"Loading status...")):(o(),a("div",Tt,[e("div",Ft,[t[12]||(t[12]=e("span",{class:"major-label"},"Major / Program",-1)),e("span",Nt,l(Z.value),1)]),e("div",jt,[e("div",At,[e("div",Yt,[t[17]||(t[17]=e("h3",null,"Academic Calendar",-1)),D.value.entryDate?(o(),a("div",Et,[t[13]||(t[13]=C(" Entry Date: ",-1)),e("strong",null,l(D.value.entryDate),1),t[14]||(t[14]=C(" · Entry Term: ",-1)),e("strong",null,l(D.value.entryTerm),1)])):v("",!0),e("div",Pt,[t[15]||(t[15]=C(" Current Term: ",-1)),e("strong",null,l(D.value.currentTerm),1),t[16]||(t[16]=C(" · You are in ",-1)),e("strong",null,"Term "+l(D.value.termNumber),1)]),it(ft,{"entry-date":D.value.entryDate},null,8,["entry-date"])]),e("div",Ut,[t[18]||(t[18]=e("h3",null,"Graduation Progress",-1)),e("div",Bt,[e("div",{class:"progress-ring",style:ut(tt.value)},[e("div",It,[e("div",Lt,l(K.value)+"%",1),e("div",Gt,"Term "+l(Math.min(D.value.termNumber,I))+" / "+l(I),1)])],4),e("div",{class:"text-muted"}," Based on your current term in the program (Term 1 → Term "+l(I)+"). ")])]),e("div",Vt,[t[19]||(t[19]=e("h3",null,"Current Holds",-1)),$.value.length>0?(o(),a("div",Rt,"You have "+l($.value.length)+" active hold(s).",1)):(o(),a("div",Ot,"No Holds. You are good to register.")),$.value.length>0?(o(),a("ul",Wt,[(o(!0),a(E,null,L($.value,n=>(o(),a("li",{key:n.id},l(n.hold_type)+" (Active)",1))),128))])):v("",!0)]),e("div",qt,[t[20]||(t[20]=e("h3",null,"Deficiency Courses",-1)),A.value.length===0?(o(),a("div",zt,"No deficiency courses assigned.")):(o(),a("ul",Ht,[(o(!0),a(E,null,L(A.value,n=>(o(),a("li",{key:n.course_code},[e("span",Jt,l(n.course_code),1),e("span",Kt,l(n.course_name),1),e("span",Qt,l(n.status),1)]))),128))]))])]),e("div",Xt,[e("div",Zt,[t[23]||(t[23]=e("h3",null,"Documents Status",-1)),e("div",te,[e("div",ee,[t[21]||(t[21]=e("div",{class:"doc-left"},[e("div",{class:"doc-title"},"Admission Letter"),e("div",{class:"doc-sub"},"Required for Term 1 hold release")],-1)),e("div",se,[e("span",{class:R(["badge",h.value])},l(h.value),3)])]),h.value==="rejected"&&w.value?(o(),a("div",ne," Reviewer comment: "+l(w.value),1)):v("",!0),e("div",ae,[t[22]||(t[22]=e("div",{class:"doc-left"},[e("div",{class:"doc-title"},"Major Professor Form"),e("div",{class:"doc-sub"},"Required for Term 2 hold release")],-1)),e("div",oe,[e("span",{class:R(["badge",O.value])},l(O.value),3)])]),O.value==="rejected"&&z.value?(o(),a("div",le," Reviewer comment: "+l(z.value),1)):v("",!0)]),e("button",{class:"btn-primary",onClick:t[6]||(t[6]=n=>S(m).push("/documents"))},"Go to Documents"),t[24]||(t[24]=e("p",{class:"text-muted",style:{"margin-top":"10px"}}," Uploads are handled in Documents. Dashboard only shows status. ",-1))]),e("div",re,[e("div",ie,[t[26]||(t[26]=e("h3",{style:{margin:"0"}},"Events",-1)),e("label",ue,[e("input",{type:"checkbox",disabled:T.value||U.value,onChange:nt},null,40,de),t[25]||(t[25]=e("span",null,"Dismiss all",-1))])]),k.value?(o(),a("div",{key:0,class:R(["msg",{ok:b.value,bad:!b.value}])},l(k.value),3)):v("",!0),T.value?(o(),a("div",ce,"Loading events...")):p.value.length===0?(o(),a("div",me,"No new events.")):(o(),a("div",ve,[(o(!0),a(E,null,L(p.value,n=>(o(),a(E,{key:`${n.type||"assignment"}-${n.id}`},[(n.type||"assignment")==="assignment"?(o(),a("label",_e,[e("input",{type:"checkbox",disabled:Y.value===String(n.id),onChange:r=>Q(n,r)},null,40,pe),e("div",ye,[e("div",ge,l(n.title),1),e("div",he,[n.course_name||n.course_code?(o(),a("span",fe,"Course: "+l(n.course_name||n.course_code)+" · ",1)):v("",!0),C(" From: "+l(n.faculty_username||"Faculty")+" · "+l(n.created_at)+" ",1),n.due_at?(o(),a("span",ke," · Due: "+l(n.due_at),1)):v("",!0)])])])):(o(),a("label",be,[e("input",{type:"checkbox",disabled:Y.value===`course-${n.id}`,onChange:r=>Q(n,r)},null,40,we),e("div",De,[e("div",Se,l(n.title),1),e("div",Ce,[n.course_name||n.course_code?(o(),a("span",xe,"Course: "+l(n.course_name||n.course_code)+" · ",1)):v("",!0),C(" From: "+l(n.faculty_username||"Faculty")+" · "+l(n.created_at),1)]),n.comment?(o(),a("div",$e,"Comment: "+l(n.comment),1)):v("",!0),e("div",Me,[t[27]||(t[27]=C(" Go to ",-1)),e("span",{class:"link",onClick:t[7]||(t[7]=dt(r=>S(m).push("/my-courses"),["stop"]))},"My Courses"),t[28]||(t[28]=C(" to review/apply. ",-1))])])]))],64))),128))])),e("div",Te,[u.value?(o(),a("button",{key:0,class:"btn-primary",onClick:t[8]||(t[8]=n=>S(m).push("/assignments"))},"Go to Assignments")):v("",!0),i.value?(o(),a("button",{key:1,class:"btn-primary",onClick:t[9]||(t[9]=n=>S(m).push("/my-courses"))},"Go to My Courses")):v("",!0)])])])])]))])])])]))}},je=X(Fe,[["__scopeId","data-v-900aa9c6"]]);export{je as default};
