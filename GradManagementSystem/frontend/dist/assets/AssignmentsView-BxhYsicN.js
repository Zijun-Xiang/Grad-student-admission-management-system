import{_ as z,r,k as T,o as H,h as K,i as v,c as o,a as t,d as u,t as l,u as g,e as I,v as Q,F as N,f as F,g as X,j as n,l as B}from"./index-CHzR5xCe.js";const Z={class:"dashboard-layout"},ss={class:"navbar"},es={class:"user-info"},ts={key:0},os={class:"main-container"},ns={class:"sidebar"},as={class:"content"},is={class:"card"},ls={key:0,class:"msg bad"},us={key:1,class:"loading-text"},ds={key:2,class:"empty-state"},cs={key:3,class:"assignment-list"},rs={class:"filter-row"},ms=["value"],_s=["disabled"],vs={key:0,class:"empty-state"},ps={class:"head"},ys={class:"title"},bs={key:0,class:"badge"},gs={key:1,class:"badge warn"},hs={key:2,class:"badge ok"},fs={class:"meta text-muted"},ks={key:0},Cs={key:1},ws={key:2},Ss={key:0,class:"desc"},$s={class:"actions"},xs=["onClick","disabled"],Ns=["onClick","disabled"],Fs=["onClick","disabled"],Ls={class:"submit-box"},As={class:"text-muted"},js={key:0,class:"muted",style:{"margin-left":"8px"}},Ds=["onChange"],Rs=["onClick","disabled"],Us={key:0,class:"modal-overlay"},Vs={class:"modal-box wide-modal"},Ms={key:0,class:"comment-meta"},Ts={key:0},Is={class:"comment-list"},Bs={key:0,class:"loading-text"},Ps={key:1,class:"empty-state"},Os={key:2},Ws={class:"comment-head"},Gs={class:"comment-author"},Es={class:"comment-time"},Js={class:"comment-body"},Ys={__name:"AssignmentsView",setup(qs){const _=K(),C=r({}),w=r(!0),S=r([]),h=r(""),c=r(0),y=r({}),L=r([]),m=r({course_code:"",faculty:""}),$=r(!1),b=r(null),f=r([]),x=r(!1),A=r(null),j=T(()=>{const a=A.value||{};return{termNumber:Number(a.term_number||1)}});H(async()=>{var e,s;const a=localStorage.getItem("user");if(!a)return _.push("/");C.value=JSON.parse(a);try{const i=await v.get("get_status.php");((e=i.data)==null?void 0:e.status)==="success"&&(A.value=i.data.term||null)}catch{}try{const i=await v.get("get_student_courses.php");((s=i.data)==null?void 0:s.status)==="success"&&(L.value=i.data.data||[])}catch{}await D()});const D=async()=>{var a,e,s,i;w.value=!0,h.value="";try{const d=await v.get("student_list_assignments.php");((a=d.data)==null?void 0:a.status)==="success"?S.value=d.data.data||[]:h.value=((e=d.data)==null?void 0:e.message)||"Failed to load assignments."}catch(d){h.value=((i=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to load assignments."}finally{w.value=!1}},R=T(()=>{const a=String(m.value.course_code||"").trim(),e=String(m.value.faculty||"").trim().toLowerCase();return(S.value||[]).filter(i=>!(a&&String(i.course_code||"")!==a||e&&![i.faculty_username,i.title,i.course_name,i.course_code].map(k=>String(k||"").toLowerCase()).join(" ").includes(e)))}),P=()=>{m.value={course_code:"",faculty:""}},O=(a,e)=>{var i,d;const s=((d=(i=e==null?void 0:e.target)==null?void 0:i.files)==null?void 0:d[0])??null;y.value={...y.value,[a]:s}},U=a=>{const e=URL.createObjectURL(a);window.open(e,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(e),6e4)},W=async a=>{c.value=a.id;try{const e=await v.get(`download_assignment_file.php?assignment_id=${a.id}`,{responseType:"blob"});U(e.data)}finally{c.value=0}},G=async a=>{if(a.submission_id){c.value=a.id;try{const e=await v.get(`download_assignment_submission.php?submission_id=${a.submission_id}`,{responseType:"blob"});U(e.data)}finally{c.value=0}}},E=async a=>{var s,i,d,k,V;const e=(s=y.value)==null?void 0:s[a.id];if(e){c.value=a.id;try{const p=new FormData;p.append("assignment_id",String(a.id)),p.append("file",e);const M=await v.post("student_submit_assignment.php",p);((i=M.data)==null?void 0:i.status)==="success"?(y.value={...y.value,[a.id]:null},await D()):alert(((d=M.data)==null?void 0:d.message)||"Submit failed")}catch(p){alert(((V=(k=p==null?void 0:p.response)==null?void 0:k.data)==null?void 0:V.message)||"Submit failed")}finally{c.value=0}}},J=async a=>{var e;b.value=a,$.value=!0,f.value=[],x.value=!0;try{const s=await v.get(`assignment_submission_comments_list.php?submission_id=${a.submission_id}`);((e=s.data)==null?void 0:e.status)==="success"&&(f.value=s.data.data||[])}finally{x.value=!1}},Y=()=>{$.value=!1,b.value=null,f.value=[]},q=async()=>{try{await v.post("logout.php")}catch{}localStorage.removeItem("user"),_.push("/")};return(a,e)=>(n(),o("div",Z,[t("header",ss,[e[8]||(e[8]=t("div",{class:"brand"},"Grad System",-1)),t("div",es,[C.value.username?(n(),o("span",ts,"Welcome, "+l(C.value.username),1)):u("",!0),t("button",{onClick:q,class:"btn-logout"},"Logout")])]),t("div",os,[t("aside",ns,[t("nav",null,[t("ul",null,[t("li",{onClick:e[0]||(e[0]=s=>g(_).push("/dashboard"))},"Dashboard"),t("li",{onClick:e[1]||(e[1]=s=>g(_).push("/my-courses"))},"My Courses"),t("li",{onClick:e[2]||(e[2]=s=>g(_).push("/documents"))},"Documents"),e[9]||(e[9]=t("li",{class:"active"},"Assignments",-1)),t("li",{onClick:e[3]||(e[3]=s=>g(_).push("/profile"))},"Profile"),j.value.termNumber>=2?(n(),o("li",{key:0,onClick:e[4]||(e[4]=s=>g(_).push("/major-professor"))},"Major Professor")):u("",!0),j.value.termNumber>=3?(n(),o("li",{key:1,onClick:e[5]||(e[5]=s=>g(_).push("/thesis-project"))},"Thesis / Project")):u("",!0)])])]),t("main",as,[t("div",is,[e[11]||(e[11]=t("h2",null,"Assignments",-1)),h.value?(n(),o("div",ls,l(h.value),1)):u("",!0),w.value?(n(),o("div",us,"Loading...")):S.value.length===0?(n(),o("div",ds,"No assignments.")):(n(),o("div",cs,[t("div",rs,[I(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.course_code=s),class:"filter-control"},[e[10]||(e[10]=t("option",{value:""},"All courses",-1)),(n(!0),o(N,null,F(L.value,s=>(n(),o("option",{key:s.course_code,value:s.course_code},l(s.course_name?`${s.course_name} (${s.course_code})`:s.course_code),9,ms))),128))],512),[[Q,m.value.course_code]]),I(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>m.value.faculty=s),class:"filter-control",type:"text",placeholder:"Search by faculty name (username)..."},null,512),[[X,m.value.faculty]]),t("button",{class:"btn-secondary",onClick:P,disabled:!m.value.course_code&&!m.value.faculty},"Clear",8,_s)]),R.value.length===0?(n(),o("div",vs,"No assignments match your filters.")):u("",!0),(n(!0),o(N,null,F(R.value,s=>(n(),o("div",{key:s.id,class:"assignment-item"},[t("div",ps,[t("div",ys,[t("strong",null,l(s.title),1),s.submission_id?(n(),o("span",bs,"Submitted")):(n(),o("span",gs,"Not submitted")),s.submission_id&&s.grade!==null&&s.grade!==void 0?(n(),o("span",hs,"Grade: "+l(s.grade),1)):u("",!0)]),t("div",fs,[s.course_name||s.course_code?(n(),o("span",ks,"Course: "+l(s.course_name||s.course_code),1)):u("",!0),s.course_name||s.course_code?(n(),o("span",Cs," · ")):u("",!0),B(" From: "+l(s.faculty_username||"Faculty")+" ",1),s.due_at?(n(),o("span",ws,"· Due: "+l(s.due_at),1)):u("",!0)])]),s.description?(n(),o("div",Ss,l(s.description),1)):u("",!0),t("div",$s,[s.attachment_path?(n(),o("button",{key:0,class:"btn-secondary",onClick:i=>W(s),disabled:c.value===s.id},l(c.value===s.id?"Working...":"Download"),9,xs)):u("",!0),s.submission_id?(n(),o("button",{key:1,class:"btn-secondary",onClick:i=>G(s),disabled:c.value===s.id},l(c.value===s.id?"Working...":"My Submission"),9,Ns)):u("",!0),s.submission_id?(n(),o("button",{key:2,class:"btn-secondary",onClick:i=>J(s),disabled:c.value===s.id}," Comments ("+l(Number(s.comments_count||0))+") ",9,Fs)):u("",!0)]),t("div",Ls,[t("div",As,[B(l(s.submission_id?"Resubmit (optional):":"Submit:")+" ",1),s.submission_id&&s.grade!==null&&s.grade!==void 0?(n(),o("span",js," (Your grade: "+l(s.grade)+") ",1)):u("",!0)]),t("input",{type:"file",onChange:i=>O(s.id,i)},null,40,Ds),t("button",{class:"btn-primary",onClick:i=>E(s),disabled:!y.value[s.id]||c.value===s.id},l(c.value===s.id?"Uploading...":s.submission_id?"Resubmit":"Submit"),9,Rs)])]))),128))]))]),$.value?(n(),o("div",Us,[t("div",Vs,[e[12]||(e[12]=t("h3",null,"Faculty Comments",-1)),b.value?(n(),o("div",Ms,[t("strong",null,l(b.value.title),1),b.value.submission_id?(n(),o("span",Ts," · submission_id="+l(b.value.submission_id),1)):u("",!0)])):u("",!0),t("div",Is,[x.value?(n(),o("div",Bs,"Loading comments...")):f.value.length===0?(n(),o("div",Ps,"No comments yet.")):(n(),o("div",Os,[(n(!0),o(N,null,F(f.value,s=>(n(),o("div",{key:s.id,class:"comment-item"},[t("div",Ws,[t("span",Gs,l(s.author_username||s.author_role),1),t("span",Es,l(s.created_at),1)]),t("div",Js,l(s.comment),1)]))),128))]))]),t("div",{class:"modal-actions"},[t("button",{class:"btn-cancel",onClick:Y},"Close")])])])):u("",!0)])])]))}},Hs=z(Ys,[["__scopeId","data-v-0566ae84"]]);export{Hs as default};
