import{_ as q,r as v,l as D,w as H,o as K,i as Q,c as o,a as s,d as g,t as d,u as w,m,F as O,n as X,e as P,v as A,f as Z,h as ee,g as B,j as x,k as u}from"./index-CqwOMfHx.js";import{D as E}from"./DatePicker-DTCrqjIm.js";const se={class:"dashboard-layout"},te={class:"navbar"},le={class:"user-info"},ae={key:0},ne={class:"main-container"},oe={class:"sidebar"},ue={class:"content"},ie={class:"content-inner"},de={class:"card"},re={key:0,class:"status-box pending"},ve={class:"text-muted"},me={key:1,class:"msg bad"},fe={class:"card-lite"},ce={key:0,class:"loading-text"},pe={key:1,class:"empty-state"},be={key:2,class:"form-grid"},_e={class:"form-group"},ye=["value"],ge={class:"form-group"},we=["value"],ke={class:"form-group"},Se=["value"],he={class:"card-lite mt-20"},Te={class:"form-grid"},Ne={class:"form-group"},De={class:"form-group"},xe={class:"form-group"},Ve={class:"form-group"},Ce={key:0,class:"hint text-muted"},je={class:"form-actions"},Pe=["disabled"],Me=["disabled"],Ue={key:0,class:"mt-20"},Le={class:"table mt-10"},We={class:"row"},Ye={__name:"ThesisProjectView",setup($e){const f=Q(),C=v({}),k=v(null),j=v(!1),S=v([]),c=v(""),b=v(""),_=v(!0),h=v(!1),n=v(null),l=v({type:"thesis",title:"",submission_date:"",defense_date:""}),M=D(()=>{const t=(S.value||[]).map(e=>Number(e.year)).filter(e=>!Number.isNaN(e));return Array.from(new Set(t)).sort((e,i)=>i-e)}),y=D(()=>{const t=Number(c.value);return t&&(S.value||[]).find(e=>Number(e.year)===t)||null}),T=D(()=>{const t=l.value.defense_date;if(!t)return"";const e=new Date(t+"T00:00:00");if(isNaN(e.getTime()))return"";const i=e.getMonth();return e.setMonth(i-1),e.toISOString().slice(0,10)}),V=D(()=>{var e;const t=Number(((e=k.value)==null?void 0:e.term_number)||1);return t>=3&&t<=4}),F=D(()=>!(!V.value||!y.value||!l.value.defense_date||!l.value.submission_date));H(()=>l.value.defense_date,t=>{if(!t)return;const e=t.slice(0,4);e&&e!==c.value&&M.value.includes(Number(e))&&(c.value=e),l.value.submission_date&&T.value&&l.value.submission_date>T.value&&(l.value.submission_date="")});const R=async()=>{var t;try{const e=await x.get("get_status.php");((t=e.data)==null?void 0:t.status)==="success"&&(k.value=e.data.term||null)}catch{}},z=async()=>{var t;j.value=!0;try{const e=await x.get("defense_windows_list.php");if(((t=e.data)==null?void 0:t.status)==="success"){S.value=e.data.data||[];const i=String(e.data.current_year||new Date().getFullYear());!c.value&&(S.value||[]).some(p=>String(p.year)===i)&&(c.value=i)}}finally{j.value=!1}},U=async()=>{var t;try{const e=await x.get("student_get_thesis_project.php");((t=e.data)==null?void 0:t.status)==="success"&&(n.value=e.data.data||null,n.value&&(l.value.type=n.value.type||"thesis",l.value.title=n.value.title||"",l.value.submission_date=n.value.submission_date||"",l.value.defense_date=n.value.defense_date||"",n.value.defense_date&&(c.value=n.value.defense_date.slice(0,4))))}catch{}},L=async()=>{b.value="",await Promise.all([R(),z(),U()])},G=async()=>{var t,e,i,p,N;b.value="",_.value=!0,h.value=!0;try{const r=await x.post("submit_thesis_project.php",{type:l.value.type,title:l.value.title,submission_date:l.value.submission_date,defense_date:l.value.defense_date});((t=r.data)==null?void 0:t.status)==="success"?(b.value=((e=r.data)==null?void 0:e.message)||"Saved.",_.value=!0,await U()):(b.value=((i=r.data)==null?void 0:i.message)||"Save failed.",_.value=!1)}catch(r){b.value=((N=(p=r==null?void 0:r.response)==null?void 0:p.data)==null?void 0:N.message)||"Save failed.",_.value=!1}finally{h.value=!1}},J=async()=>{try{await x.post("logout.php")}catch{}localStorage.removeItem("user"),f.push("/")};return K(async()=>{const t=localStorage.getItem("user");if(!t)return f.push("/");C.value=JSON.parse(t),await L()}),(t,e)=>{var i,p,N,r,W,Y,$,I;return u(),o("div",se,[s("header",te,[e[11]||(e[11]=s("div",{class:"brand"},"Grad System",-1)),s("div",le,[C.value.username?(u(),o("span",ae,"Welcome, "+d(C.value.username),1)):g("",!0),s("button",{onClick:J,class:"btn-logout"},"Logout")])]),s("div",ne,[s("aside",oe,[s("nav",null,[s("ul",null,[s("li",{onClick:e[0]||(e[0]=a=>w(f).push("/dashboard"))},"Dashboard"),s("li",{onClick:e[1]||(e[1]=a=>w(f).push("/my-courses"))},"My Courses"),s("li",{onClick:e[2]||(e[2]=a=>w(f).push("/documents"))},"Documents"),s("li",{onClick:e[3]||(e[3]=a=>w(f).push("/assignments"))},"Assignments"),s("li",{onClick:e[4]||(e[4]=a=>w(f).push("/profile"))},"Profile"),(p=(i=k.value)==null?void 0:i.unlocks)!=null&&p.term2?(u(),o("li",{key:0,onClick:e[5]||(e[5]=a=>w(f).push("/major-professor"))},"Major Professor")):g("",!0),e[12]||(e[12]=s("li",{class:"active"},"Thesis / Project",-1))])])]),s("main",ue,[s("div",ie,[s("div",de,[e[32]||(e[32]=s("h2",null,"Thesis / Project Timeline",-1)),Number(((N=k.value)==null?void 0:N.term_number)||1)<3?(u(),o("div",re,[e[13]||(e[13]=s("h3",null,"Locked",-1)),e[14]||(e[14]=s("p",null,[m("This feature is available starting "),s("strong",null,"Term 3"),m(".")],-1)),s("p",ve,"You are currently in Term "+d(Number(((r=k.value)==null?void 0:r.term_number)||1))+".",1)])):(u(),o(O,{key:1},[e[31]||(e[31]=s("div",{class:"subtitle"},[m(" Rule: submission date must be at least "),s("strong",null,"1 month"),m(" before defense date. ")],-1)),b.value?(u(),o("div",{key:0,class:X(["msg",{ok:_.value,bad:!_.value}])},d(b.value),3)):g("",!0),V.value?g("",!0):(u(),o("div",me,[...e[15]||(e[15]=[m(" Locked: you can edit this timeline only in ",-1),s("strong",null,"Term 3",-1),m(" and ",-1),s("strong",null,"Term 4",-1),m(". ",-1)])])),s("div",fe,[e[20]||(e[20]=s("h3",null,"Admin-published Defense Window",-1)),j.value?(u(),o("div",ce,"Loading windows...")):S.value.length===0?(u(),o("div",pe," No defense window published yet. Please contact admin. ")):(u(),o("div",be,[s("div",_e,[e[17]||(e[17]=s("label",null,"Defense Year",-1)),P(s("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>c.value=a),class:"select"},[e[16]||(e[16]=s("option",{disabled:"",value:""},"-- Select year --",-1)),(u(!0),o(O,null,Z(M.value,a=>(u(),o("option",{key:a,value:String(a)},d(a),9,ye))),128))],512),[[A,c.value]])]),s("div",ge,[e[18]||(e[18]=s("label",null,"Window Start",-1)),s("input",{value:((W=y.value)==null?void 0:W.start_date)||"-",disabled:""},null,8,we)]),s("div",ke,[e[19]||(e[19]=s("label",null,"Window End",-1)),s("input",{value:((Y=y.value)==null?void 0:Y.end_date)||"-",disabled:""},null,8,Se)])]))]),s("div",he,[e[30]||(e[30]=s("h3",null,"Your Selected Dates",-1)),s("div",Te,[s("div",Ne,[e[22]||(e[22]=s("label",null,"Type",-1)),P(s("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.type=a),class:"select"},[...e[21]||(e[21]=[s("option",{value:"thesis"},"Thesis",-1),s("option",{value:"project"},"Project",-1)])],512),[[A,l.value.type]])]),s("div",De,[e[23]||(e[23]=s("label",null,"Title (optional)",-1)),P(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.title=a),placeholder:"Optional"},null,512),[[ee,l.value.title]])]),s("div",xe,[e[24]||(e[24]=s("label",null,"Defense Date",-1)),B(E,{modelValue:l.value.defense_date,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.defense_date=a),locale:"en-US",min:(($=y.value)==null?void 0:$.start_date)||"",max:((I=y.value)==null?void 0:I.end_date)||"",disabled:!y.value||!V.value},null,8,["modelValue","min","max","disabled"])]),s("div",Ve,[e[27]||(e[27]=s("label",null,"Submission Date",-1)),B(E,{modelValue:l.value.submission_date,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.submission_date=a),locale:"en-US",max:T.value||"",disabled:!l.value.defense_date||!V.value},null,8,["modelValue","max","disabled"]),T.value?(u(),o("div",Ce,[e[25]||(e[25]=m(" Must be on/before ",-1)),s("strong",null,d(T.value),1),e[26]||(e[26]=m(". ",-1))])):g("",!0)])]),s("div",je,[s("button",{class:"btn-primary",onClick:G,disabled:h.value||!F.value},d(h.value?"Saving...":"Save"),9,Pe),s("button",{class:"btn-view",onClick:L,disabled:h.value},"Refresh",8,Me)]),n.value?(u(),o("div",Ue,[e[29]||(e[29]=s("div",{class:"text-muted"},"Current record:",-1)),s("div",Le,[e[28]||(e[28]=s("div",{class:"row header"},[s("div",null,"Type"),s("div",null,"Title"),s("div",null,"Submission"),s("div",null,"Defense"),s("div",null,"Updated")],-1)),s("div",We,[s("div",null,d(n.value.type),1),s("div",null,d(n.value.title||"-"),1),s("div",null,d(n.value.submission_date),1),s("div",null,d(n.value.defense_date),1),s("div",null,d(n.value.created_at),1)])])])):g("",!0)])],64))])])])])])}}},Ae=q(Ye,[["__scopeId","data-v-577bd69f"]]);export{Ae as default};
