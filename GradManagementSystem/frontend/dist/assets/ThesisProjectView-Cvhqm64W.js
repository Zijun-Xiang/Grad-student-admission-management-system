import{_ as J,r as v,j as T,w as q,l as H,h as K,c as o,a as s,d as g,t as d,u as N,k as m,F as A,n as Q,e as x,v as B,f as X,g as P,i as D,o as u}from"./index-Dl1toHCS.js";const Z={class:"dashboard-layout"},ee={class:"navbar"},se={class:"user-info"},te={key:0},le={class:"main-container"},ae={class:"sidebar"},ne={class:"content"},oe={class:"content-inner"},ue={class:"card"},ie={key:0,class:"status-box pending"},de={class:"text-muted"},re={key:1,class:"msg bad"},ve={class:"card-lite"},me={key:0,class:"loading-text"},ce={key:1,class:"empty-state"},fe={key:2,class:"form-grid"},pe={class:"form-group"},be=["value"],_e={class:"form-group"},ye=["value"],ge={class:"form-group"},we=["value"],ke={class:"card-lite mt-20"},Se={class:"form-grid"},he={class:"form-group"},Te={class:"form-group"},Ne={class:"form-group"},xe=["min","max","disabled"],De={class:"form-group"},Ce=["max","disabled"],je={key:0,class:"hint text-muted"},Ve={class:"form-actions"},Me=["disabled"],Pe=["disabled"],Le={key:0,class:"mt-20"},Ue={class:"table mt-10"},We={class:"row"},Ye={__name:"ThesisProjectView",setup($e){const p=K(),j=v({}),w=v(null),V=v(!1),k=v([]),c=v(""),b=v(""),_=v(!0),S=v(!1),n=v(null),l=v({type:"thesis",title:"",submission_date:"",defense_date:""}),L=T(()=>{const t=(k.value||[]).map(e=>Number(e.year)).filter(e=>!Number.isNaN(e));return Array.from(new Set(t)).sort((e,i)=>i-e)}),y=T(()=>{const t=Number(c.value);return t&&(k.value||[]).find(e=>Number(e.year)===t)||null}),M=T(()=>{const t=l.value.defense_date;if(!t)return"";const e=new Date(t+"T00:00:00");if(isNaN(e.getTime()))return"";const i=e.getMonth();return e.setMonth(i-1),e.toISOString().slice(0,10)}),C=T(()=>{var e;const t=Number(((e=w.value)==null?void 0:e.term_number)||1);return t>=3&&t<=4}),E=T(()=>!(!C.value||!y.value||!l.value.defense_date||!l.value.submission_date));q(()=>l.value.defense_date,t=>{if(!t)return;const e=t.slice(0,4);e&&e!==c.value&&L.value.includes(Number(e))&&(c.value=e)});const F=async()=>{var t;try{const e=await D.get("get_status.php");((t=e.data)==null?void 0:t.status)==="success"&&(w.value=e.data.term||null)}catch{}},R=async()=>{var t;V.value=!0;try{const e=await D.get("defense_windows_list.php");if(((t=e.data)==null?void 0:t.status)==="success"){k.value=e.data.data||[];const i=String(e.data.current_year||new Date().getFullYear());!c.value&&(k.value||[]).some(f=>String(f.year)===i)&&(c.value=i)}}finally{V.value=!1}},U=async()=>{var t;try{const e=await D.get("student_get_thesis_project.php");((t=e.data)==null?void 0:t.status)==="success"&&(n.value=e.data.data||null,n.value&&(l.value.type=n.value.type||"thesis",l.value.title=n.value.title||"",l.value.submission_date=n.value.submission_date||"",l.value.defense_date=n.value.defense_date||"",n.value.defense_date&&(c.value=n.value.defense_date.slice(0,4))))}catch{}},W=async()=>{b.value="",await Promise.all([F(),R(),U()])},z=async()=>{var t,e,i,f,h;b.value="",_.value=!0,S.value=!0;try{const r=await D.post("submit_thesis_project.php",{type:l.value.type,title:l.value.title,submission_date:l.value.submission_date,defense_date:l.value.defense_date});((t=r.data)==null?void 0:t.status)==="success"?(b.value=((e=r.data)==null?void 0:e.message)||"Saved.",_.value=!0,await U()):(b.value=((i=r.data)==null?void 0:i.message)||"Save failed.",_.value=!1)}catch(r){b.value=((h=(f=r==null?void 0:r.response)==null?void 0:f.data)==null?void 0:h.message)||"Save failed.",_.value=!1}finally{S.value=!1}},G=async()=>{try{await D.post("logout.php")}catch{}localStorage.removeItem("user"),p.push("/")};return H(async()=>{const t=localStorage.getItem("user");if(!t)return p.push("/");j.value=JSON.parse(t),await W()}),(t,e)=>{var i,f,h,r,Y,$,I,O;return u(),o("div",Z,[s("header",ee,[e[10]||(e[10]=s("div",{class:"brand"},"Grad System",-1)),s("div",se,[j.value.username?(u(),o("span",te,"Welcome, "+d(j.value.username),1)):g("",!0),s("button",{onClick:G,class:"btn-logout"},"Logout")])]),s("div",le,[s("aside",ae,[s("nav",null,[s("ul",null,[s("li",{onClick:e[0]||(e[0]=a=>N(p).push("/dashboard"))},"Dashboard"),s("li",{onClick:e[1]||(e[1]=a=>N(p).push("/my-courses"))},"My Courses"),s("li",{onClick:e[2]||(e[2]=a=>N(p).push("/documents"))},"Documents"),s("li",{onClick:e[3]||(e[3]=a=>N(p).push("/assignments"))},"Assignments"),(f=(i=w.value)==null?void 0:i.unlocks)!=null&&f.term2?(u(),o("li",{key:0,onClick:e[4]||(e[4]=a=>N(p).push("/major-professor"))},"Major Professor")):g("",!0),e[11]||(e[11]=s("li",{class:"active"},"Thesis / Project",-1))])])]),s("main",ne,[s("div",oe,[s("div",ue,[e[31]||(e[31]=s("h2",null,"Thesis / Project Timeline",-1)),Number(((h=w.value)==null?void 0:h.term_number)||1)<3?(u(),o("div",ie,[e[12]||(e[12]=s("h3",null,"Locked",-1)),e[13]||(e[13]=s("p",null,[m("This feature is available starting "),s("strong",null,"Term 3"),m(".")],-1)),s("p",de,"You are currently in Term "+d(Number(((r=w.value)==null?void 0:r.term_number)||1))+".",1)])):(u(),o(A,{key:1},[e[30]||(e[30]=s("div",{class:"subtitle"},[m(" Rule: submission date must be at least "),s("strong",null,"1 month"),m(" before defense date. ")],-1)),b.value?(u(),o("div",{key:0,class:Q(["msg",{ok:_.value,bad:!_.value}])},d(b.value),3)):g("",!0),C.value?g("",!0):(u(),o("div",re,[...e[14]||(e[14]=[m(" Locked: you can edit this timeline only in ",-1),s("strong",null,"Term 3",-1),m(" and ",-1),s("strong",null,"Term 4",-1),m(". ",-1)])])),s("div",ve,[e[19]||(e[19]=s("h3",null,"Admin-published Defense Window",-1)),V.value?(u(),o("div",me,"Loading windows...")):k.value.length===0?(u(),o("div",ce," No defense window published yet. Please contact admin. ")):(u(),o("div",fe,[s("div",pe,[e[16]||(e[16]=s("label",null,"Defense Year",-1)),x(s("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>c.value=a),class:"select"},[e[15]||(e[15]=s("option",{disabled:"",value:""},"-- Select year --",-1)),(u(!0),o(A,null,X(L.value,a=>(u(),o("option",{key:a,value:String(a)},d(a),9,be))),128))],512),[[B,c.value]])]),s("div",_e,[e[17]||(e[17]=s("label",null,"Window Start",-1)),s("input",{value:((Y=y.value)==null?void 0:Y.start_date)||"-",disabled:""},null,8,ye)]),s("div",ge,[e[18]||(e[18]=s("label",null,"Window End",-1)),s("input",{value:(($=y.value)==null?void 0:$.end_date)||"-",disabled:""},null,8,we)])]))]),s("div",ke,[e[29]||(e[29]=s("h3",null,"Your Selected Dates",-1)),s("div",Se,[s("div",he,[e[21]||(e[21]=s("label",null,"Type",-1)),x(s("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.type=a),class:"select"},[...e[20]||(e[20]=[s("option",{value:"thesis"},"Thesis",-1),s("option",{value:"project"},"Project",-1)])],512),[[B,l.value.type]])]),s("div",Te,[e[22]||(e[22]=s("label",null,"Title (optional)",-1)),x(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.title=a),placeholder:"Optional"},null,512),[[P,l.value.title]])]),s("div",Ne,[e[23]||(e[23]=s("label",null,"Defense Date",-1)),x(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.defense_date=a),type:"date",min:((I=y.value)==null?void 0:I.start_date)||void 0,max:((O=y.value)==null?void 0:O.end_date)||void 0,disabled:!y.value||!C.value},null,8,xe),[[P,l.value.defense_date]])]),s("div",De,[e[26]||(e[26]=s("label",null,"Submission Date",-1)),x(s("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.submission_date=a),type:"date",max:M.value||void 0,disabled:!l.value.defense_date||!C.value},null,8,Ce),[[P,l.value.submission_date]]),M.value?(u(),o("div",je,[e[24]||(e[24]=m(" Must be on/before ",-1)),s("strong",null,d(M.value),1),e[25]||(e[25]=m(". ",-1))])):g("",!0)])]),s("div",Ve,[s("button",{class:"btn-primary",onClick:z,disabled:S.value||!E.value},d(S.value?"Saving...":"Save"),9,Me),s("button",{class:"btn-view",onClick:W,disabled:S.value},"Refresh",8,Pe)]),n.value?(u(),o("div",Le,[e[28]||(e[28]=s("div",{class:"text-muted"},"Current record:",-1)),s("div",Ue,[e[27]||(e[27]=s("div",{class:"row header"},[s("div",null,"Type"),s("div",null,"Title"),s("div",null,"Submission"),s("div",null,"Defense"),s("div",null,"Updated")],-1)),s("div",We,[s("div",null,d(n.value.type),1),s("div",null,d(n.value.title||"-"),1),s("div",null,d(n.value.submission_date),1),s("div",null,d(n.value.defense_date),1),s("div",null,d(n.value.created_at),1)])])])):g("",!0)])],64))])])])])])}}},Oe=J(Ye,[["__scopeId","data-v-7e11076a"]]);export{Oe as default};
