import{_ as Q,r as d,l as B,o as X,i as Z,j as v,c as o,a as t,d as u,t as l,u as f,n as ss,e as O,v as es,F as A,f as j,h as ts,k as n,m as W,g as os}from"./index-CqwOMfHx.js";import{F as ns}from"./FilePicker-DKtqNUbc.js";const as={class:"dashboard-layout"},is={class:"navbar"},ls={class:"user-info"},us={key:0},ds={class:"main-container"},cs={class:"sidebar"},rs={class:"content"},ms={class:"card"},_s={key:1,class:"msg bad"},vs={key:2,class:"loading-text"},ys={key:3,class:"empty-state"},bs={key:4,class:"assignment-list"},ps={class:"filter-row"},gs=["value"],fs=["disabled"],hs={key:0,class:"empty-state"},ks={class:"head"},Cs={class:"title"},ws={key:0,class:"badge"},Ss={key:1,class:"badge warn"},Fs={key:2,class:"badge ok"},$s={class:"meta text-muted"},Ns={key:0},xs={key:1},Ls={key:2},As={key:0,class:"desc"},js={class:"actions"},Vs=["onClick","disabled"],Ds=["onClick","disabled"],Ms=["onClick","disabled"],Rs={class:"submit-box"},Us={class:"text-muted"},Ts={key:0,class:"muted",style:{"margin-left":"8px"}},Is=["onClick","disabled"],Ps={key:0,class:"modal-overlay"},Bs={class:"modal-box wide-modal"},Os={key:0,class:"comment-meta"},Ws={key:0},Gs={class:"comment-list"},zs={key:0,class:"loading-text"},Es={key:1,class:"empty-state"},Js={key:2},Ys={class:"comment-head"},qs={class:"comment-author"},Hs={class:"comment-time"},Ks={class:"comment-body"},Qs={__name:"AssignmentsView",setup(Xs){const _=Z(),S=d({}),F=d(!0),$=d([]),h=d(""),b=d(""),k=d(!0),r=d(0),p=d({}),V=d([]),m=d({course_code:"",faculty:""}),N=d(!1),g=d(null),C=d([]),x=d(!1),D=d(null),M=B(()=>{const a=D.value||{};return{termNumber:Number(a.term_number||1)}});X(async()=>{var e,s;const a=localStorage.getItem("user");if(!a)return _.push("/");S.value=JSON.parse(a);try{const i=await v.get("get_status.php");((e=i.data)==null?void 0:e.status)==="success"&&(D.value=i.data.term||null)}catch{}try{const i=await v.get("get_student_courses.php");((s=i.data)==null?void 0:s.status)==="success"&&(V.value=i.data.data||[])}catch{}await R()});const R=async()=>{var a,e,s,i;F.value=!0,h.value="";try{const c=await v.get("student_list_assignments.php");((a=c.data)==null?void 0:a.status)==="success"?$.value=c.data.data||[]:h.value=((e=c.data)==null?void 0:e.message)||"Failed to load assignments."}catch(c){h.value=((i=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to load assignments."}finally{F.value=!1}},U=B(()=>{const a=String(m.value.course_code||"").trim(),e=String(m.value.faculty||"").trim().toLowerCase();return($.value||[]).filter(i=>!(a&&String(i.course_code||"")!==a||e&&![i.faculty_username,i.title,i.course_name,i.course_code].map(w=>String(w||"").toLowerCase()).join(" ").includes(e)))}),G=()=>{m.value={course_code:"",faculty:""}},z=(a,e)=>{var i,c;const s=e&&typeof File<"u"&&e instanceof File?e:((c=(i=e==null?void 0:e.target)==null?void 0:i.files)==null?void 0:c[0])??null;p.value={...p.value,[a]:s}},T=a=>{const e=URL.createObjectURL(a);window.open(e,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(e),6e4)},E=async a=>{r.value=a.id;try{const e=await v.get(`download_assignment_file.php?assignment_id=${a.id}`,{responseType:"blob"});T(e.data)}finally{r.value=0}},J=async a=>{if(a.submission_id){r.value=a.id;try{const e=await v.get(`download_assignment_submission.php?submission_id=${a.submission_id}`,{responseType:"blob"});T(e.data)}finally{r.value=0}}},Y=async a=>{var s,i,c,w,I,P;const e=(s=p.value)==null?void 0:s[a.id];if(e){r.value=a.id,b.value="";try{const y=new FormData;y.append("assignment_id",String(a.id)),y.append("file",e);const L=await v.post("student_submit_assignment.php",y);((i=L.data)==null?void 0:i.status)==="success"?(k.value=!0,b.value=((c=L.data)==null?void 0:c.message)||"Submitted.",p.value={...p.value,[a.id]:null},await R()):(k.value=!1,b.value=((w=L.data)==null?void 0:w.message)||"Submit failed")}catch(y){k.value=!1,b.value=((P=(I=y==null?void 0:y.response)==null?void 0:I.data)==null?void 0:P.message)||"Submit failed"}finally{r.value=0}}},q=async a=>{var e;g.value=a,N.value=!0,C.value=[],x.value=!0;try{const s=await v.get(`assignment_submission_comments_list.php?submission_id=${a.submission_id}`);((e=s.data)==null?void 0:e.status)==="success"&&(C.value=s.data.data||[])}finally{x.value=!1}},H=()=>{N.value=!1,g.value=null,C.value=[]},K=async()=>{try{await v.post("logout.php")}catch{}localStorage.removeItem("user"),_.push("/")};return(a,e)=>(n(),o("div",as,[t("header",is,[e[8]||(e[8]=t("div",{class:"brand"},"Grad System",-1)),t("div",ls,[S.value.username?(n(),o("span",us,"Welcome, "+l(S.value.username),1)):u("",!0),t("button",{onClick:K,class:"btn-logout"},"Logout")])]),t("div",ds,[t("aside",cs,[t("nav",null,[t("ul",null,[t("li",{onClick:e[0]||(e[0]=s=>f(_).push("/dashboard"))},"Dashboard"),t("li",{onClick:e[1]||(e[1]=s=>f(_).push("/my-courses"))},"My Courses"),t("li",{onClick:e[2]||(e[2]=s=>f(_).push("/documents"))},"Documents"),e[9]||(e[9]=t("li",{class:"active"},"Assignments",-1)),t("li",{onClick:e[3]||(e[3]=s=>f(_).push("/profile"))},"Profile"),M.value.termNumber>=2?(n(),o("li",{key:0,onClick:e[4]||(e[4]=s=>f(_).push("/major-professor"))},"Major Professor")):u("",!0),M.value.termNumber>=3?(n(),o("li",{key:1,onClick:e[5]||(e[5]=s=>f(_).push("/thesis-project"))},"Thesis / Project")):u("",!0)])])]),t("main",rs,[t("div",ms,[e[11]||(e[11]=t("h2",null,"Assignments",-1)),b.value?(n(),o("div",{key:0,class:ss(["msg",{ok:k.value,bad:!k.value}])},l(b.value),3)):u("",!0),h.value?(n(),o("div",_s,l(h.value),1)):u("",!0),F.value?(n(),o("div",vs,"Loading...")):$.value.length===0?(n(),o("div",ys,"No assignments.")):(n(),o("div",bs,[t("div",ps,[O(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.course_code=s),class:"filter-control"},[e[10]||(e[10]=t("option",{value:""},"All courses",-1)),(n(!0),o(A,null,j(V.value,s=>(n(),o("option",{key:s.course_code,value:s.course_code},l(s.course_name?`${s.course_name} (${s.course_code})`:s.course_code),9,gs))),128))],512),[[es,m.value.course_code]]),O(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>m.value.faculty=s),class:"filter-control",type:"text",placeholder:"Search by faculty name (username)..."},null,512),[[ts,m.value.faculty]]),t("button",{class:"btn-secondary",onClick:G,disabled:!m.value.course_code&&!m.value.faculty},"Clear",8,fs)]),U.value.length===0?(n(),o("div",hs,"No assignments match your filters.")):u("",!0),(n(!0),o(A,null,j(U.value,s=>(n(),o("div",{key:s.id,class:"assignment-item"},[t("div",ks,[t("div",Cs,[t("strong",null,l(s.title),1),s.submission_id?(n(),o("span",ws,"Submitted")):(n(),o("span",Ss,"Not submitted")),s.submission_id&&s.grade!==null&&s.grade!==void 0?(n(),o("span",Fs,"Grade: "+l(s.grade),1)):u("",!0)]),t("div",$s,[s.course_name||s.course_code?(n(),o("span",Ns,"Course: "+l(s.course_name||s.course_code),1)):u("",!0),s.course_name||s.course_code?(n(),o("span",xs," · ")):u("",!0),W(" From: "+l(s.faculty_username||"Faculty")+" ",1),s.due_at?(n(),o("span",Ls,"· Due: "+l(s.due_at),1)):u("",!0)])]),s.description?(n(),o("div",As,l(s.description),1)):u("",!0),t("div",js,[s.attachment_path?(n(),o("button",{key:0,class:"btn-secondary",onClick:i=>E(s),disabled:r.value===s.id},l(r.value===s.id?"Working...":"Download"),9,Vs)):u("",!0),s.submission_id?(n(),o("button",{key:1,class:"btn-secondary",onClick:i=>J(s),disabled:r.value===s.id},l(r.value===s.id?"Working...":"My Submission"),9,Ds)):u("",!0),s.submission_id?(n(),o("button",{key:2,class:"btn-secondary",onClick:i=>q(s),disabled:r.value===s.id}," Comments ("+l(Number(s.comments_count||0))+") ",9,Ms)):u("",!0)]),t("div",Rs,[t("div",Us,[W(l(s.submission_id?"Resubmit (optional):":"Submit:")+" ",1),s.submission_id&&s.grade!==null&&s.grade!==void 0?(n(),o("span",Ts," (Your grade: "+l(s.grade)+") ",1)):u("",!0)]),os(ns,{onChange:i=>z(s.id,i)},null,8,["onChange"]),t("button",{class:"btn-primary",onClick:i=>Y(s),disabled:!p.value[s.id]||r.value===s.id},l(r.value===s.id?"Uploading...":s.submission_id?"Resubmit":"Submit"),9,Is)])]))),128))]))]),N.value?(n(),o("div",Ps,[t("div",Bs,[e[12]||(e[12]=t("h3",null,"Faculty Comments",-1)),g.value?(n(),o("div",Os,[t("strong",null,l(g.value.title),1),g.value.submission_id?(n(),o("span",Ws," · submission_id="+l(g.value.submission_id),1)):u("",!0)])):u("",!0),t("div",Gs,[x.value?(n(),o("div",zs,"Loading comments...")):C.value.length===0?(n(),o("div",Es,"No comments yet.")):(n(),o("div",Js,[(n(!0),o(A,null,j(C.value,s=>(n(),o("div",{key:s.id,class:"comment-item"},[t("div",Ys,[t("span",qs,l(s.author_username||s.author_role),1),t("span",Hs,l(s.created_at),1)]),t("div",Ks,l(s.comment),1)]))),128))]))]),t("div",{class:"modal-actions"},[t("button",{class:"btn-cancel",onClick:H},"Close")])])])):u("",!0)])])]))}},ee=Q(Qs,[["__scopeId","data-v-b9d9cb04"]]);export{ee as default};
