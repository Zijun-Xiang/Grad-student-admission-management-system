import{_ as ge,r,o as ye,i as fe,j as g,l as E,c as o,a as s,t as n,d as h,u as A,m as y,F as O,f as P,n as M,p as he,k as l,e as le,y as ke,h as be}from"./index-CqwOMfHx.js";const Ce={class:"dashboard-layout"},xe={class:"navbar"},we={class:"user-info"},Ae={class:"main-container"},Se={class:"sidebar"},Re={class:"content"},$e={class:"content-inner"},Fe={class:"card"},Me={key:0,class:"alert-box"},qe={key:1,class:"info-box"},De={key:2,class:"core-card"},Ne={key:0,class:"loading-text"},je={key:1,class:"alert-box"},Le={key:2,class:"core-list"},Be=["value"],Ve={class:"code"},Ue={class:"name"},Ee={class:"credits"},Oe={class:"form-actions"},Pe=["disabled"],Ie={key:3},We={class:"advisor-card"},He={class:"advisor-head"},Te=["disabled"],Ye={key:1,class:"loading-text"},ze={key:2,class:"text-muted"},Ge={key:3,class:"events-list",style:{"margin-top":"10px"}},Je=["disabled","onChange"],Ke={class:"event-body"},Qe={class:"event-title"},Xe={class:"event-meta text-muted"},Ze={key:0,class:"text-muted",style:{"margin-top":"6px"}},es={class:"form-row",style:{"margin-top":"10px"}},ss=["onUpdate:modelValue","disabled"],ts=["onClick","disabled"],as={key:4,style:{"margin-top":"14px"}},os={class:"events-list",style:{"margin-top":"8px"}},ls={class:"event-body",style:{"margin-left":"0"}},is={class:"event-title"},ns={class:"event-meta text-muted"},ds={key:0},rs={key:0,class:"text-muted",style:{"margin-top":"6px"}},us={class:"credit-card"},cs={class:"credit-row"},vs={class:"credit-values"},_s={class:"progress"},ps={key:0},ms={key:1},gs={key:2},ys={key:1,class:"info-box"},fs={class:"course-list"},hs={class:"code"},ks={class:"name"},bs={key:0,class:"badge-deficiency"},Cs={class:"credits"},xs={class:"status"},ws={key:0,class:"badge-registered"},As={key:1,class:"text-muted"},Ss={class:"action"},Rs=["onClick","disabled","title"],$s=["onClick","disabled"],I=12,C=20,Fs={__name:"MyCoursesView",setup(Ms){const k=fe(),ee=r({}),W=r(null),se=r([]),H=r([]),q=r([]),T=r(!1),$=r(!1),D=r(!1),Y=r(!1),z=r([]),G=r([]),N=r(!1),S=r(""),v=r(""),_=r(!0),J=r({}),j=r(!1),p=r(!0),m=r(""),K=r([]),Q=r([]),b=r(""),F=r({}),L=(t,e)=>{J.value={...J.value,[t]:e}},R=t=>{var e;return!!((e=J.value)!=null&&e[t])};ye(()=>{const t=localStorage.getItem("user");t?(ee.value=JSON.parse(t),B()):k.push("/")});const B=async()=>{var t;try{const e=await g.get("get_status.php");if(e.data.status==="success"){W.value=e.data.term||null,T.value=e.data.holds.length>0,q.value=e.data.deficiencies||[];const d=(e.data.documents||[]).find(f=>f.doc_type==="admission_letter");$.value=(d==null?void 0:d.status)==="approved";const u=(t=e.data.core_checklist)==null?void 0:t.submitted_at;D.value=$.value&&!u,T.value||(D.value?await ne():$.value&&(ce(),U())),$.value&&V()}}catch(e){console.error(e)}},ie=async()=>{try{await g.post("logout.php")}catch{}localStorage.removeItem("user"),k.push("/")},ne=async()=>{var t,e;Y.value=!0,S.value="";try{const i=await g.get("get_undergrad_core_courses.php");i.data.status==="success"?(z.value=i.data.data||[],z.value.length===0&&(S.value="No undergrad core courses found. Run backend/sql/07_core_courses_seed.sql first.")):S.value=i.data.message||"Failed to load core courses."}catch(i){S.value=((e=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to load core courses. Run backend/sql/07_core_courses_seed.sql."}finally{Y.value=!1}},de=async()=>{var t,e;N.value=!0,v.value="",_.value=!0;try{const i=await g.post("student_submit_core_checklist.php",{completed_courses:G.value});i.data.status==="success"?(_.value=!0,v.value=`Saved. Assigned deficiencies: ${i.data.assigned_deficiencies}`,D.value=!1,await B()):(_.value=!1,v.value=i.data.message||"Failed to save checklist")}catch(i){_.value=!1,v.value=((e=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to save checklist"}finally{N.value=!1}},V=async()=>{var t,e,i,d;j.value=!0,p.value=!0,m.value="";try{const u=await g.get("student_list_course_actions.php");((t=u.data)==null?void 0:t.status)==="success"?(K.value=u.data.pending||[],Q.value=u.data.history||[]):(p.value=!1,m.value=((e=u.data)==null?void 0:e.message)||"Failed to load advisor requests.")}catch(u){p.value=!1,m.value=((d=(i=u==null?void 0:u.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to load advisor requests."}finally{j.value=!1}},re=async(t,e)=>{var d,u,f,a,c,oe;if((d=e==null?void 0:e.target)!=null&&d.checked){b.value=String((t==null?void 0:t.id)||""),m.value="",p.value=!0;try{const w=await g.post("student_apply_course_action.php",{action_id:t.id});((u=w.data)==null?void 0:u.status)==="success"?(_.value=!0,v.value=((f=w.data)==null?void 0:f.message)||"Saved.",await U(),await V()):(p.value=!1,m.value=((a=w.data)==null?void 0:a.message)||"Failed.",e!=null&&e.target&&(e.target.checked=!1))}catch(w){p.value=!1,m.value=((oe=(c=w==null?void 0:w.response)==null?void 0:c.data)==null?void 0:oe.message)||"Failed.",e!=null&&e.target&&(e.target.checked=!1)}finally{b.value=""}}},ue=async t=>{var e,i,d,u,f,a;if(t!=null&&t.id){b.value=String(t.id),m.value="",p.value=!0;try{const c=await g.post("student_reject_course_action.php",{action_id:t.id,comment:((e=F.value)==null?void 0:e[t.id])||""});((i=c.data)==null?void 0:i.status)==="success"?(_.value=!0,v.value=((d=c.data)==null?void 0:d.message)||"Rejected.",F.value={...F.value,[t.id]:""},await V()):(p.value=!1,m.value=((u=c.data)==null?void 0:u.message)||"Failed.")}catch(c){p.value=!1,m.value=((a=(f=c==null?void 0:c.response)==null?void 0:f.data)==null?void 0:a.message)||"Failed."}finally{b.value=""}}},ce=async()=>{const t=await g.get("get_courses.php");t.data.status==="success"&&(se.value=t.data.data)},U=async()=>{const t=await g.get("get_student_courses.php");t.data.status==="success"&&(H.value=t.data.data)},X=t=>q.value.some(e=>e.course_code===t),te=t=>H.value.some(e=>e.course_code===t),ve=E(()=>se.value.filter(t=>{const e=String(t.level||"").toUpperCase(),i=Number(t.is_required||0)===1;return e==="UG"&&i?X(t.course_code):!0})),x=E(()=>H.value.reduce((t,e)=>t+Number(e.credits||0),0)),_e=E(()=>Math.min(100,Math.round(x.value/C*100))),ae=E(()=>x.value<I?"low":x.value<=C?"ok":"high"),Z=t=>{const e=Number((t==null?void 0:t.credits)||0);return x.value+e>C},pe=async t=>{var e,i;if(v.value="",Z(t)){_.value=!1,v.value=`Cannot exceed ${C} credits per term.`;return}if(!R(t.course_code)){L(t.course_code,!0);try{const d=await g.post("register_course.php",{course_code:t.course_code});d.data.status==="success"?(_.value=!0,v.value=`Registered: ${t.course_code}`,await U(),await B()):(_.value=!1,v.value=d.data.message||"Registration failed.")}catch(d){_.value=!1,v.value=((i=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:i.message)||"Network Error"}finally{L(t.course_code,!1)}}},me=async t=>{var e,i;if(v.value="",!R(t.course_code)){L(t.course_code,!0);try{const d=await g.post("unregister_course.php",{course_code:t.course_code});d.data.status==="success"?(_.value=!0,v.value=`Dropped: ${t.course_code}`,await U(),await B()):(_.value=!1,v.value=d.data.message||"Drop failed.")}catch(d){_.value=!1,v.value=((i=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:i.message)||"Network Error"}finally{L(t.course_code,!1)}}};return(t,e)=>{var i,d,u,f;return l(),o("div",Ce,[s("header",xe,[e[8]||(e[8]=s("div",{class:"brand"},"Grad System",-1)),s("div",we,[s("span",null,"Welcome, "+n(ee.value.username),1),s("button",{onClick:ie,class:"btn-logout"},"Logout")])]),s("div",Ae,[s("aside",Se,[s("nav",null,[s("ul",null,[s("li",{onClick:e[0]||(e[0]=a=>A(k).push("/dashboard"))},"Dashboard"),e[9]||(e[9]=s("li",{class:"active"},"My Courses",-1)),s("li",{onClick:e[1]||(e[1]=a=>A(k).push("/documents"))},"Documents"),s("li",{onClick:e[2]||(e[2]=a=>A(k).push("/assignments"))},"Assignments"),s("li",{onClick:e[3]||(e[3]=a=>A(k).push("/profile"))},"Profile"),(d=(i=W.value)==null?void 0:i.unlocks)!=null&&d.term2?(l(),o("li",{key:0,onClick:e[4]||(e[4]=a=>A(k).push("/major-professor"))},"Major Professor")):h("",!0),(f=(u=W.value)==null?void 0:u.unlocks)!=null&&f.term3?(l(),o("li",{key:1,onClick:e[5]||(e[5]=a=>A(k).push("/thesis-project"))},"Thesis / Project")):h("",!0)])])]),s("main",Re,[s("div",$e,[s("div",Fe,[e[25]||(e[25]=s("h2",null,"Course Registration",-1)),T.value?(l(),o("div",Me,"You have active Holds. Registration is disabled.")):$.value?D.value?(l(),o("div",De,[e[13]||(e[13]=s("h3",null,"Undergraduate Core Courses Checklist",-1)),e[14]||(e[14]=s("p",{class:"text-muted"},[y(" Select the courses you have already completed in your undergraduate study. Any course not selected will become a "),s("strong",null,"Deficiency"),y(" that you must take before graduate courses. ")],-1)),Y.value?(l(),o("div",Ne,"Loading core courses...")):S.value?(l(),o("div",je,n(S.value),1)):(l(),o("div",Le,[(l(!0),o(O,null,P(z.value,a=>(l(),o("label",{key:a.course_code,class:"core-item"},[le(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=c=>G.value=c),value:a.course_code},null,8,Be),[[ke,G.value]]),s("span",Ve,n(a.course_code),1),s("span",Ue,n(a.course_name),1),s("span",Ee,n(a.credits),1)]))),128))])),s("div",Oe,[s("button",{class:"btn-register",onClick:de,disabled:N.value},n(N.value?"Saving...":"Save & Continue"),9,Pe)])])):(l(),o("div",Ie,[v.value?(l(),o("div",{key:0,class:M(["msg",{ok:_.value,bad:!_.value}])},n(v.value),3)):h("",!0),s("div",We,[s("div",He,[e[15]||(e[15]=s("h3",{style:{margin:"0"}},"Advisor Course Requests",-1)),s("button",{class:"btn-secondary",onClick:V,disabled:j.value},"Refresh",8,Te)]),m.value?(l(),o("div",{key:0,class:M(["msg",{ok:p.value,bad:!p.value}])},n(m.value),3)):h("",!0),j.value?(l(),o("div",Ye,"Loading advisor requests...")):K.value.length===0?(l(),o("div",ze,"No pending advisor requests.")):(l(),o("div",Ge,[(l(!0),o(O,null,P(K.value,a=>(l(),o("div",{key:a.id,class:"event-item"},[s("input",{type:"checkbox",disabled:b.value===String(a.id),onChange:c=>re(a,c),title:"Apply"},null,40,Je),s("div",Ke,[s("div",Qe,n(a.action_type==="add"?"Add":"Drop")+": "+n(a.course_code)+n(a.course_name?` · ${a.course_name}`:""),1),s("div",Xe," From: "+n(a.faculty_username||"Faculty")+" · "+n(a.created_at),1),a.comment?(l(),o("div",Ze,"Advisor comment: "+n(a.comment),1)):h("",!0),s("div",es,[le(s("input",{"onUpdate:modelValue":c=>F.value[a.id]=c,class:"select",type:"text",placeholder:"Optional reply when rejecting...",disabled:b.value===String(a.id)},null,8,ss),[[be,F.value[a.id]]]),s("button",{class:"btn-drop",onClick:c=>ue(a),disabled:b.value===String(a.id)},n(b.value===String(a.id)?"Working...":"Reject"),9,ts)]),e[16]||(e[16]=s("div",{class:"text-muted",style:{"margin-top":"6px"}},"Check the box to accept and apply the change.",-1))])]))),128))])),Q.value.length>0?(l(),o("div",as,[e[17]||(e[17]=s("div",{class:"text-muted",style:{"font-weight":"700"}},"Recent Applied",-1)),s("div",os,[(l(!0),o(O,null,P(Q.value,a=>(l(),o("div",{key:`h-${a.id}`,class:"event-item",style:{cursor:"default"}},[s("div",ls,[s("div",is,n(a.action_type==="add"?"Added":"Dropped")+": "+n(a.course_code)+n(a.course_name?` · ${a.course_name}`:""),1),s("div",ns,[y(" From: "+n(a.faculty_username||"Faculty")+" · "+n(a.created_at)+" ",1),a.applied_at?(l(),o("span",ds," · Applied: "+n(a.applied_at),1)):h("",!0)]),a.comment?(l(),o("div",rs,"Comment: "+n(a.comment),1)):h("",!0)])]))),128))])])):h("",!0)]),s("div",us,[s("div",cs,[e[21]||(e[21]=s("div",{class:"credit-title"},"Credit Requirement (per term)",-1)),s("div",vs,[e[18]||(e[18]=y(" Min ",-1)),s("strong",null,n(I)),e[19]||(e[19]=y(" · Max ",-1)),s("strong",null,n(C)),e[20]||(e[20]=y(" · Selected ",-1)),s("strong",null,n(x.value),1)])]),s("div",_s,[s("div",{class:M(["bar",ae.value]),style:he({width:_e.value+"%"})},null,6)]),s("div",{class:M(["credit-hint",ae.value])},[x.value<I?(l(),o("span",ps,"You need at least "+n(I)+" credits.")):x.value<=C?(l(),o("span",ms,"On track.")):(l(),o("span",gs,"Over the maximum of "+n(C)+" credits."))],2)]),q.value.length>0?(l(),o("div",ys,[e[22]||(e[22]=y(" You have ",-1)),s("strong",null,n(q.value.length)+" deficiency courses",1),e[23]||(e[23]=y(". According to policy, you must register for these first. ",-1))])):h("",!0),s("div",fs,[e[24]||(e[24]=s("div",{class:"list-header"},[s("span",null,"Course Code"),s("span",null,"Course Name"),s("span",null,"Credits"),s("span",null,"Status"),s("span",null,"Action")],-1)),(l(!0),o(O,null,P(ve.value,a=>(l(),o("div",{key:a.course_code,class:M(["list-row",{"highlight-row":X(a.course_code)}])},[s("span",hs,n(a.course_code),1),s("span",ks,[y(n(a.course_name)+" ",1),X(a.course_code)?(l(),o("span",bs,"Deficiency")):h("",!0)]),s("span",Cs,n(a.credits),1),s("span",xs,[te(a.course_code)?(l(),o("span",ws,"Registered")):(l(),o("span",As,"-"))]),s("span",Ss,[te(a.course_code)?(l(),o("button",{key:1,onClick:c=>me(a),class:"btn-drop",disabled:R(a.course_code)},n(R(a.course_code)?"Working...":"Drop"),9,$s)):(l(),o("button",{key:0,onClick:c=>pe(a),class:"btn-register",disabled:Z(a)||R(a.course_code),title:Z(a)?`Exceeds max ${C} credits`:""},n(R(a.course_code)?"Working...":"Register"),9,Rs))])],2))),128))])])):(l(),o("div",qe,[e[10]||(e[10]=s("strong",null,"Admission Letter required.",-1)),e[11]||(e[11]=y(" Please upload your Admission Letter in ",-1)),s("span",{class:"link",onClick:e[6]||(e[6]=a=>A(k).push("/documents"))},"Documents"),e[12]||(e[12]=y(" and wait for approval before course selection. ",-1))]))])])])])])}}},Ds=ge(Fs,[["__scopeId","data-v-8bd9f4c1"]]);export{Ds as default};
