import{_ as q,r as u,l as F,o as $,i as D,j as _,c as o,a as e,t as p,d as g,u as v,n as R,m as i,e as T,v as V,F as L,f as U,k as a}from"./index-CqwOMfHx.js";const A={class:"dashboard-layout"},B={class:"navbar"},G={class:"user-info"},I={class:"main-container"},E={class:"sidebar"},O={class:"content"},z={class:"content-inner"},H={class:"card"},J={key:1,class:"status-box pending"},W={class:"text-muted"},K={key:2,class:"status-box approved"},Q={key:3,class:"status-box pending"},X={key:4,class:"status-box pending"},Z={key:0,class:"text-error"},ss={key:5,class:"form-block"},es={class:"form-section"},ts=["value"],os=["disabled"],as={key:0,class:"card mt-20"},ls={key:0,class:"status-box pending"},ns={key:1,class:"status-box approved"},rs={key:2,class:"status-box"},us={key:0,class:"text-error"},is={key:1},ds={__name:"MajorProfessorView",setup(vs){const r=D(),w=u({}),j=u([]),b=u(""),k=u("none"),P=u(""),C=u([]),m=u("none"),d=u(1),c=u(""),f=u(!0),M=F(()=>d.value<2?!1:d.value===2?["pending","approved"].includes(String(m.value||"")):!0);$(()=>{const l=localStorage.getItem("user");l?(w.value=JSON.parse(l),S(),h()):r.push("/")});const S=async()=>{try{const l=await _.get("get_faculty_list.php");l.data.status==="success"&&(j.value=l.data.data)}catch(l){console.error(l)}},h=async()=>{var l,s;try{const t=await _.get("get_status.php");if(t.data.status!=="success")return;d.value=Number(((s=(l=t.data)==null?void 0:l.term)==null?void 0:s.term_number)||1);const n=t.data.mp_info;n&&(k.value=n.mp_status,P.value=n.prof_name||"Unknown"),C.value=t.data.documents||[];const y=C.value.find(x=>x.doc_type==="major_professor_form");m.value=(y==null?void 0:y.status)||"none"}catch(t){console.error("Failed to check status",t)}},N=async()=>{var l,s,t;c.value="",f.value=!0;try{const n=await _.post("request_major_professor.php",{professor_id:b.value});if(n.data.status==="success"){f.value=!0,c.value=((l=n.data)==null?void 0:l.message)||"Request sent. Please wait for approval.",k.value="pending";const y=j.value.find(x=>x.user_id===b.value);P.value=y?y.username:"Unknown"}else f.value=!1,c.value=n.data.message||"Request failed"}catch(n){f.value=!1,c.value=((t=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:t.message)||"Network Error"}},Y=async()=>{try{await _.post("logout.php")}catch{}localStorage.removeItem("user"),r.push("/")};return(l,s)=>(a(),o("div",A,[e("header",B,[s[9]||(s[9]=e("div",{class:"brand"},"Grad System",-1)),e("div",G,[e("span",null,"Welcome, "+p(w.value.username),1),e("button",{onClick:Y,class:"btn-logout"},"Logout")])]),e("div",I,[e("aside",E,[e("nav",null,[e("ul",null,[e("li",{onClick:s[0]||(s[0]=t=>v(r).push("/dashboard"))},"Dashboard"),e("li",{onClick:s[1]||(s[1]=t=>v(r).push("/my-courses"))},"My Courses"),e("li",{onClick:s[2]||(s[2]=t=>v(r).push("/documents"))},"Documents"),e("li",{onClick:s[3]||(s[3]=t=>v(r).push("/assignments"))},"Assignments"),e("li",{onClick:s[4]||(s[4]=t=>v(r).push("/profile"))},"Profile"),s[10]||(s[10]=e("li",{class:"active"},"Major Professor",-1)),d.value>=3?(a(),o("li",{key:0,onClick:s[5]||(s[5]=t=>v(r).push("/thesis-project"))},"Thesis / Project")):g("",!0)])])]),e("main",O,[e("div",z,[e("div",H,[s[24]||(s[24]=e("h2",null,"Select Major Professor",-1)),c.value?(a(),o("div",{key:0,class:R(["msg",{ok:f.value,bad:!f.value}])},p(c.value),3)):g("",!0),d.value<2?(a(),o("div",J,[s[11]||(s[11]=e("h3",null,"Locked",-1)),s[12]||(s[12]=e("p",null,[i("Major Professor selection is available starting "),e("strong",null,"Term 2"),i(".")],-1)),e("p",W,"You are currently in Term "+p(d.value)+".",1)])):g("",!0),k.value==="approved"?(a(),o("div",K,[s[14]||(s[14]=e("h3",null,"You have a Major Professor",-1)),e("p",null,[s[13]||(s[13]=i("Your advisor is: ",-1)),e("strong",null,p(P.value),1)])])):d.value>=2&&k.value==="pending"?(a(),o("div",Q,[s[17]||(s[17]=e("h3",null,"Request Pending",-1)),e("p",null,[s[15]||(s[15]=i("You have requested ",-1)),e("strong",null,p(P.value),1),s[16]||(s[16]=i(" as your advisor.",-1))]),s[18]||(s[18]=e("p",null,"Please wait for their approval.",-1))])):d.value===2&&!M.value?(a(),o("div",X,[s[19]||(s[19]=e("h3",null,"Action Required",-1)),s[20]||(s[20]=e("p",null,[i("You must upload your "),e("strong",null,"Major Professor Form"),i(" in "),e("strong",null,"Documents"),i(" before selecting an advisor.")],-1)),m.value==="rejected"?(a(),o("p",Z,"Your previous upload was rejected. Please re-upload.")):g("",!0),e("button",{class:"btn-primary",onClick:s[6]||(s[6]=t=>v(r).push("/documents"))},"Go to Documents")])):d.value>=2?(a(),o("div",ss,[s[23]||(s[23]=e("div",{class:"alert-box"},'You have a "Major Professor" Hold. Please select an advisor to proceed.',-1)),e("div",es,[s[22]||(s[22]=e("label",null,"Choose a Faculty Member:",-1)),T(e("select",{"onUpdate:modelValue":s[7]||(s[7]=t=>b.value=t),class:"prof-select"},[s[21]||(s[21]=e("option",{disabled:"",value:""},"-- Select Professor --",-1)),(a(!0),o(L,null,U(j.value,t=>(a(),o("option",{key:t.user_id,value:t.user_id},p(t.username)+" ("+p(t.email)+") ",9,ts))),128))],512),[[V,b.value]]),e("button",{onClick:N,class:"btn-primary",disabled:!b.value||!M.value},"Submit Request",8,os)])])):g("",!0)]),k.value==="approved"?(a(),o("div",as,[s[27]||(s[27]=e("h2",null,"Major Professor Form (Term 2)",-1)),s[28]||(s[28]=e("p",{class:"text-muted"},[i(" All document uploads are handled in "),e("strong",null,"Documents"),i(". This page only manages advisor selection. ")],-1)),m.value==="pending"?(a(),o("div",ls,[...s[25]||(s[25]=[e("p",null,"Your form is under review.",-1)])])):m.value==="approved"?(a(),o("div",ns,[...s[26]||(s[26]=[e("p",null,"Your form has been approved.",-1)])])):(a(),o("div",rs,[m.value==="rejected"?(a(),o("p",us,"Previous upload was rejected. Please re-upload.")):(a(),o("p",is,"No form uploaded yet.")),e("button",{class:"btn-primary",onClick:s[8]||(s[8]=t=>v(r).push("/documents"))},"Go to Documents")]))])):g("",!0)])])])]))}},ms=q(ds,[["__scopeId","data-v-e18bd19e"]]);export{ms as default};
