import{_ as B,r as l,w as Y,o as I,c as u,a as t,b as L,d as N,e as r,v as R,F as P,f as x,g as G,h as i,t as y,u as H,i as J,j as $,k as n}from"./index-CqwOMfHx.js";import{D as z}from"./DatePicker-DTCrqjIm.js";const K={class:"login-container"},Q={class:"login-card"},W={class:"form-group"},X={class:"form-group"},Z=["value"],h={class:"form-row"},ee={class:"form-group"},te=["value"],ae={class:"form-group"},se={key:0,class:"form-row"},le={class:"form-group"},oe={class:"form-group"},re={class:"form-group"},ue={class:"form-group"},ne={class:"form-group"},de={class:"form-group"},ie={class:"form-group"},ve={key:1,class:"error-msg"},me={key:2,class:"success-msg"},pe=["disabled"],fe={__name:"RegisterView",setup(ge){const T=J(),w=l("student"),S=l(""),U=l(""),v=l(""),o=l(""),p=l(new Date().getFullYear()),_=l([]),C=l(""),k=l(""),b=l(""),F=l(""),D=l([{major_code:"CS",major_name:"Computer Science"}]),f=l("CS"),m=l(""),V=l(""),j=l(!1),M=s=>{const e=new Date(s+"T00:00:00");if(isNaN(e.getTime()))return"";const a=e.getFullYear(),g=e.getMonth()+1;return g<=4?`${a}SP`:g<=8?`${a}SU`:`${a}FA`};(()=>{const s=new Date().getFullYear();_.value=[];for(let e=s-5;e<=s+5;e++)_.value.push(e)})();const A=()=>new Date().toISOString().slice(0,10);o.value=A(),v.value=M(o.value);const E=()=>{if(!o.value)return;const s=o.value.split("-");s.length===3&&(o.value=`${p.value}-${s[1]}-${s[2]}`,v.value=M(o.value))},O=()=>{if(!o.value)return;const s=new Date(o.value+"T00:00:00");isNaN(s.getTime())||(p.value=s.getFullYear(),v.value=M(o.value))};Y(p,E),Y(o,O),I(async()=>{var s;try{const e=await $.get("majors_list.php");((s=e.data)==null?void 0:s.status)==="success"&&Array.isArray(e.data.data)&&e.data.data.length>0&&(D.value=e.data.data,D.value.some(a=>a.major_code===f.value)||(f.value=D.value[0].major_code))}catch{}});const q=async()=>{var s,e,a,g;if(m.value="",V.value="",b.value!==F.value){m.value="Passwords do not match.";return}j.value=!0;try{const c={role:w.value,username:C.value,email:k.value,password:b.value,first_name:S.value,last_name:U.value,term_code:v.value,entry_date:o.value,major_code:f.value},d=await $.post("register.php",c);((s=d.data)==null?void 0:s.status)==="success"?(localStorage.setItem("user",JSON.stringify(d.data.user)),V.value="Registration successful. Redirecting...",setTimeout(()=>{T.push(d.data.user.role==="faculty"?"/faculty":d.data.user.role==="admin"?"/admin":"/dashboard")},1500)):m.value=((e=d.data)==null?void 0:e.message)||"Registration failed."}catch(c){const d=(g=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:g.message;m.value=d||"Registration failed (network/CORS/DB)."}finally{j.value=!1}};return(s,e)=>(n(),u("div",K,[t("div",Q,[e[25]||(e[25]=t("div",{class:"login-header"},[t("h1",null,"Create Account"),t("p",null,"Register as Student or Faculty")],-1)),t("form",{onSubmit:L(q,["prevent"])},[t("div",W,[e[13]||(e[13]=t("label",null,"Role",-1)),r(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),required:""},[...e[12]||(e[12]=[t("option",{value:"student"},"Student",-1),t("option",{value:"faculty"},"Faculty (GPD/Major Professor)",-1)])],512),[[R,w.value]])]),t("div",X,[e[14]||(e[14]=t("label",null,"Major / Program",-1)),r(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),required:""},[(n(!0),u(P,null,x(D.value,a=>(n(),u("option",{key:a.major_code,value:a.major_code},y(a.major_name),9,Z))),128))],512),[[R,f.value]])]),t("div",h,[t("div",ee,[e[15]||(e[15]=t("label",null,"Entry Year",-1)),r(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a)},[(n(!0),u(P,null,x(_.value,a=>(n(),u("option",{key:a,value:a},y(a),9,te))),128))],512),[[R,p.value]])]),t("div",ae,[e[16]||(e[16]=t("label",null,"Entry Date",-1)),G(z,{modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value=a),locale:"en-US"},null,8,["modelValue"])])]),w.value==="student"?(n(),u("div",se,[t("div",le,[e[17]||(e[17]=t("label",null,"First Name",-1)),r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>S.value=a),type:"text",placeholder:"First name"},null,512),[[i,S.value]])]),t("div",oe,[e[18]||(e[18]=t("label",null,"Last Name",-1)),r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>U.value=a),type:"text",placeholder:"Last name"},null,512),[[i,U.value]])])])):N("",!0),t("div",re,[e[19]||(e[19]=t("label",null,"Entry Term Code (auto)",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a),type:"text",disabled:""},null,512),[[i,v.value]]),e[20]||(e[20]=t("div",{class:"hint"},"Derived from Entry Date. Used to tag your first-semester Hold.",-1))]),t("div",ue,[e[21]||(e[21]=t("label",null,"Username",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>C.value=a),type:"text",placeholder:"e.g. student1 / prof_jamil",required:""},null,512),[[i,C.value]])]),t("div",ne,[e[22]||(e[22]=t("label",null,"Email",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>k.value=a),type:"email",placeholder:"Optional"},null,512),[[i,k.value]])]),t("div",de,[e[23]||(e[23]=t("label",null,"Password",-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>b.value=a),type:"password",placeholder:"At least 6 characters",required:""},null,512),[[i,b.value]])]),t("div",ie,[e[24]||(e[24]=t("label",null,"Confirm Password",-1)),r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>F.value=a),type:"password",placeholder:"Re-enter password",required:""},null,512),[[i,F.value]])]),m.value?(n(),u("div",ve,y(m.value),1)):N("",!0),V.value?(n(),u("div",me,y(V.value),1)):N("",!0),t("button",{type:"submit",class:"btn-primary",disabled:j.value},y(j.value?"Creating...":"Create account"),9,pe),t("button",{type:"button",class:"btn-secondary",onClick:e[11]||(e[11]=a=>H(T).push("/"))},"Back to login")],32)])]))}},De=B(fe,[["__scopeId","data-v-1e8cd28f"]]);export{De as default};
