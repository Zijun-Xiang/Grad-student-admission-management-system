import{_ as xe,r as l,j as ae,l as Le,h as Pe,c as n,a,d as v,t as i,u as b,n as O,F as ce,f as re,e as Ae,k as se,g as $e,i as f,o as u}from"./index-Dl1toHCS.js";import{d as Ne,f as Se,s as Oe,a as Ve}from"./docDisplay-CK9INdz_.js";const qe={class:"dashboard-layout"},We={class:"navbar"},Be={class:"user-info"},Ge={key:0},Ie={class:"main-container"},Je={class:"sidebar"},ze={class:"content"},Ee={class:"card mb-30"},He={class:"upload-grid"},Ke={class:"upload-panel"},Qe=["disabled"],Xe={class:"upload-panel"},Ye={key:0,class:"msg bad",style:{margin:"10px 0 0"}},Ze=["disabled"],ea={class:"upload-panel"},aa={key:0,class:"msg bad",style:{margin:"10px 0 0"}},sa=["disabled"],ta=["disabled"],la={class:"upload-panel"},oa={key:0,class:"msg bad",style:{margin:"10px 0 0"}},na=["disabled"],ua=["disabled"],da={class:"card"},ia={key:0,class:"loading-text"},ca={key:1,class:"empty-state"},ra={key:2,class:"doc-list"},va={class:"info"},pa={class:"doc-meta-row"},ma={class:"doc-source-pill"},fa={class:"doc-format-pill"},_a={key:0,class:"meta"},ha={key:0,class:"comment"},ga={class:"actions"},ya=["onClick"],ba=["onClick"],ka=["onClick","disabled"],Ca=["onClick","disabled"],wa={key:0,class:"modal-overlay"},Da={class:"modal-box wide-modal"},Fa={key:0,class:"comment-meta"},Ua={class:"comment-list"},Ra={key:0,class:"loading-text"},Ma={key:1,class:"empty-state"},ja={key:2},Ta={class:"comment-head"},xa={class:"comment-author"},La={class:"comment-time"},Pa={class:"comment-body"},Aa={class:"modal-actions"},$a=["disabled"],Na={key:1,class:"modal-overlay"},Sa={class:"modal-box wide-modal"},Oa={key:0,class:"comment-meta"},Va=["accept"],qa={class:"modal-actions"},Wa=["disabled"],Ba={key:2,class:"modal-overlay"},Ga={class:"modal-box wide-modal"},Ia={key:0,class:"comment-meta"},Ja={class:"modal-actions"},za=["disabled"],Ea=["disabled"],Ha={__name:"DocumentsView",setup(Ka){const D=Pe(),E=l({}),H=l(!0),K=l([]),A=l(null),$=l(null),j=l(null),T=l(null),V=l(!1),q=l(!1),W=l(!1),B=l(!1),c=l(""),p=l(!0),Q=l(!1),_=l(null),N=l([]),X=l(!1),F=l(""),G=l(!1),k=l(""),x=l(!0),C=l({term_number:1,unlocks:{term2:!1,term3:!1}}),I=ae(()=>{var e;const s=Number(((e=C.value)==null?void 0:e.term_number)||1);return s>=3&&s<=4}),J=ae(()=>{var e;return Number(((e=C.value)==null?void 0:e.term_number)||1)>=3}),ve=s=>{var e,t;A.value=((t=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:t[0])??null},pe=s=>{var e,t;$.value=((t=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:t[0])??null},me=s=>{var e,t;if(!I.value){j.value=null;return}j.value=((t=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:t[0])??null},fe=s=>{var e,t;if(!J.value){T.value=null;return}T.value=((t=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:t[0])??null},U=async()=>{H.value=!0;try{const s=await f.get("get_status.php");s.data.status==="success"&&(K.value=s.data.documents||[],C.value=s.data.term||C.value)}finally{H.value=!1}},_e=async()=>{var s,e;if(j.value){W.value=!0,c.value="";try{const t=new FormData;t.append("file",j.value);const o=await f.post("upload_thesis_project.php",t);o.data.status==="success"?(p.value=!0,c.value="Thesis/Project file uploaded. Waiting for review.",j.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(t){p.value=!1,c.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{W.value=!1}}},he=async()=>{var s,e;if(A.value){V.value=!0,c.value="";try{const t=new FormData;t.append("file",A.value);const o=await f.post("upload_letter.php",t);o.data.status==="success"?(p.value=!0,c.value="Admission letter uploaded. Waiting for review.",A.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(t){p.value=!1,c.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{V.value=!1}}},ge=async()=>{var s,e;if($.value){q.value=!0,c.value="";try{const t=new FormData;t.append("file",$.value);const o=await f.post("upload_major_professor_form.php",t);o.data.status==="success"?(p.value=!0,c.value="Major Professor form uploaded. Waiting for review.",$.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(t){p.value=!1,c.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{q.value=!1}}},ye=async()=>{var s,e;if(T.value){B.value=!0,c.value="";try{const t=new FormData;t.append("file",T.value);const o=await f.post("upload_research_method_proof.php",t);o.data.status==="success"?(p.value=!0,c.value=o.data.message||"Research Method proof uploaded.",T.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(t){p.value=!1,c.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{B.value=!1}}},be=async s=>{var e,t;try{const m=(await f.get(`download_document.php?doc_id=${s.doc_id}`,{responseType:"blob"})).data,r=URL.createObjectURL(m);window.open(r,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(r),6e4)}catch(o){p.value=!1,c.value=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to open document."}},ke=async s=>{_.value=s,Q.value=!0,F.value="",k.value="",N.value=[],X.value=!0;try{await te(s.doc_id)}finally{X.value=!1}},Ce=()=>{Q.value=!1,_.value=null,N.value=[],F.value="",k.value=""},we=async()=>{var s,e,t,o;if(_.value){G.value=!0,k.value="",x.value=!0;try{const m=await f.post("document_comments_add.php",{doc_id:_.value.doc_id,comment:F.value});((s=m.data)==null?void 0:s.status)==="success"?(x.value=!0,k.value="Posted.",F.value="",await te(_.value.doc_id)):(x.value=!1,k.value=((e=m.data)==null?void 0:e.message)||"Failed to post")}catch(m){x.value=!1,k.value=((o=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to post"}finally{G.value=!1}}},te=async s=>{var t;const e=await f.get(`document_comments_list.php?doc_id=${s}`);((t=e.data)==null?void 0:t.status)==="success"&&(N.value=e.data.data||[])},le=s=>String((s==null?void 0:s.status)||"").toLowerCase()!=="approved",Y=l(!1),h=l(null),L=l(null),z=l(!1),g=l(""),R=l(!0),Z=l(!1),w=l(null),S=l(!1),y=l(""),M=l(!0),De=ae(()=>{var e;return String(((e=h.value)==null?void 0:e.doc_type)||"")==="thesis_project"?".pdf":".pdf,.jpg,.jpeg,.png"}),Fe=s=>{h.value=s,L.value=null,g.value="",R.value=!0,Y.value=!0},oe=()=>{Y.value=!1,h.value=null,L.value=null,g.value=""},Ue=s=>{var e,t;L.value=((t=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:t[0])??null},Re=async()=>{var s,e,t,o,m;if(!(!h.value||!L.value)){z.value=!0,g.value="",R.value=!0;try{const r=new FormData;r.append("doc_id",String(h.value.doc_id)),r.append("file",L.value);const P=await f.post("student_replace_document.php",r);((s=P.data)==null?void 0:s.status)==="success"?(R.value=!0,g.value=((e=P.data)==null?void 0:e.message)||"Replaced.",p.value=!0,c.value=g.value,await U(),oe()):(R.value=!1,g.value=((t=P.data)==null?void 0:t.message)||"Replace failed")}catch(r){R.value=!1,g.value=((m=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:m.message)||"Replace failed"}finally{z.value=!1}}},Me=s=>{w.value=s,y.value="",M.value=!0,Z.value=!0},ne=()=>{Z.value=!1,w.value=null,y.value=""},je=async()=>{var s,e,t,o,m;if(w.value){S.value=!0,y.value="",M.value=!0;try{const r=await f.post("student_delete_document.php",{doc_id:w.value.doc_id});((s=r.data)==null?void 0:s.status)==="success"?(M.value=!0,y.value=((e=r.data)==null?void 0:e.message)||"Deleted.",p.value=!0,c.value=y.value,await U(),ne()):(M.value=!1,y.value=((t=r.data)==null?void 0:t.message)||"Delete failed")}catch(r){M.value=!1,y.value=((m=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:m.message)||"Delete failed"}finally{S.value=!1}}},Te=async()=>{try{await f.post("logout.php")}catch{}localStorage.removeItem("user"),D.push("/")};return Le(()=>{const s=localStorage.getItem("user");if(!s)return D.push("/");E.value=JSON.parse(s),U()}),(s,e)=>{var t,o,m,r,P,ue,de,ie;return u(),n("div",qe,[a("header",We,[e[6]||(e[6]=a("div",{class:"brand"},"Grad System",-1)),a("div",Be,[E.value.username?(u(),n("span",Ge,"Welcome, "+i(E.value.username),1)):v("",!0),a("button",{onClick:Te,class:"btn-logout"},"Logout")])]),a("div",Ie,[a("aside",Je,[a("nav",null,[a("ul",null,[a("li",{onClick:e[0]||(e[0]=d=>b(D).push("/dashboard"))},"Dashboard"),a("li",{onClick:e[1]||(e[1]=d=>b(D).push("/my-courses"))},"My Courses"),e[7]||(e[7]=a("li",{class:"active"},"Documents",-1)),a("li",{onClick:e[2]||(e[2]=d=>b(D).push("/assignments"))},"Assignments"),(o=(t=C.value)==null?void 0:t.unlocks)!=null&&o.term2?(u(),n("li",{key:0,onClick:e[3]||(e[3]=d=>b(D).push("/major-professor"))},"Major Professor")):v("",!0),(r=(m=C.value)==null?void 0:m.unlocks)!=null&&r.term3?(u(),n("li",{key:1,onClick:e[4]||(e[4]=d=>b(D).push("/thesis-project"))},"Thesis / Project")):v("",!0)])])]),a("main",ze,[a("div",Ee,[e[16]||(e[16]=a("h2",null,"Upload Documents",-1)),a("div",He,[a("div",Ke,[e[8]||(e[8]=a("h3",null,"Admission Letter",-1)),e[9]||(e[9]=a("p",{class:"text-muted"},"Required for Term 1 hold release.",-1)),a("input",{type:"file",onChange:ve,accept:".pdf,.jpg,.png"},null,32),a("button",{class:"btn-primary",onClick:he,disabled:!A.value||V.value},i(V.value?"Uploading...":"Upload"),9,Qe)]),a("div",Xe,[e[10]||(e[10]=a("h3",null,"Major Professor Form",-1)),e[11]||(e[11]=a("p",{class:"text-muted"},"Required for Term 2 hold release.",-1)),(ue=(P=C.value)==null?void 0:P.unlocks)!=null&&ue.term2?v("",!0):(u(),n("div",Ye," Locked: available starting Term 2. ")),a("input",{type:"file",onChange:pe,accept:".pdf,.jpg,.png"},null,32),a("button",{class:"btn-primary",onClick:ge,disabled:!((ie=(de=C.value)==null?void 0:de.unlocks)!=null&&ie.term2)||!$.value||q.value},i(q.value?"Uploading...":"Upload"),9,Ze)]),a("div",ea,[e[12]||(e[12]=a("h3",null,"Thesis / Project",-1)),e[13]||(e[13]=a("p",{class:"text-muted"},"Upload your thesis/project file (PDF). Allowed only in Term 3 and Term 4.",-1)),I.value?v("",!0):(u(),n("div",aa," Locked: available only in Term 3 and Term 4. ")),a("input",{type:"file",onChange:me,disabled:!I.value,accept:".pdf"},null,40,sa),a("button",{class:"btn-primary",onClick:_e,disabled:!I.value||!j.value||W.value},i(W.value?"Uploading...":"Upload"),9,ta)]),a("div",la,[e[14]||(e[14]=a("h3",null,"Research Method (Proof)",-1)),e[15]||(e[15]=a("p",{class:"text-muted"}," Term 3 hold release requires you to register/take the Research Method course. Faculty will verify your course registration. Upload proof here if requested (PDF/JPG/PNG). ",-1)),J.value?v("",!0):(u(),n("div",oa," Locked: available starting Term 3. ")),a("input",{type:"file",onChange:fe,disabled:!J.value,accept:".pdf,.jpg,.jpeg,.png"},null,40,na),a("button",{class:"btn-primary",onClick:ye,disabled:!J.value||!T.value||B.value},i(B.value?"Uploading...":"Upload"),9,ua)])]),c.value?(u(),n("div",{key:0,class:O(["msg",{ok:p.value,bad:!p.value}])},i(c.value),3)):v("",!0)]),a("div",da,[e[17]||(e[17]=a("h2",null,"My Documents",-1)),H.value?(u(),n("div",ia,"Loading...")):K.value.length===0?(u(),n("div",ca,"No documents uploaded.")):(u(),n("div",ra,[(u(!0),n(ce,null,re(K.value,d=>(u(),n("div",{key:d.doc_id,class:"doc-item"},[a("div",va,[a("div",pa,[a("span",ma,i(b(Ne)(d.doc_type)),1),a("span",fa,i(b(Se)(d.file_path)),1),a("span",{class:O(["doc-status-pill",b(Oe)(d.status)])},i(b(Ve)(d.status)),3),d.upload_date?(u(),n("span",_a,"路 "+i(d.upload_date),1)):v("",!0)]),d.admin_comment?(u(),n("div",ha,"Admin comment: "+i(d.admin_comment),1)):v("",!0)]),a("div",ga,[a("button",{class:"btn-secondary",onClick:ee=>be(d)},"View",8,ya),a("button",{class:"btn-secondary",onClick:ee=>ke(d)},"Comments",8,ba),a("button",{class:"btn-secondary",onClick:ee=>Fe(d),disabled:!le(d)},"Replace",8,ka),a("button",{class:"btn-danger",onClick:ee=>Me(d),disabled:!le(d)},"Delete",8,Ca)])]))),128))]))])])]),Q.value?(u(),n("div",wa,[a("div",Da,[e[18]||(e[18]=a("h3",null,"Comments",-1)),_.value?(u(),n("div",Fa,[a("strong",null,i(_.value.doc_type),1),se(" 路 doc_id="+i(_.value.doc_id),1)])):v("",!0),a("div",Ua,[X.value?(u(),n("div",Ra,"Loading comments...")):N.value.length===0?(u(),n("div",Ma,"No comments yet.")):(u(),n("div",ja,[(u(!0),n(ce,null,re(N.value,d=>(u(),n("div",{key:d.id,class:"comment-item"},[a("div",Ta,[a("span",xa,i(d.author_username||d.author_role),1),a("span",La,i(d.created_at),1)]),a("div",Pa,i(d.comment),1)]))),128))]))]),Ae(a("textarea",{"onUpdate:modelValue":e[5]||(e[5]=d=>F.value=d),placeholder:"Add a note...",rows:"3"},null,512),[[$e,F.value]]),k.value?(u(),n("div",{key:1,class:O(["msg",{ok:x.value,bad:!x.value}])},i(k.value),3)):v("",!0),a("div",Aa,[a("button",{class:"btn-cancel",onClick:Ce},"Close"),a("button",{class:"btn-primary",onClick:we,disabled:G.value||!F.value.trim()||!_.value},i(G.value?"Posting...":"Post"),9,$a)])])])):v("",!0),Y.value?(u(),n("div",Na,[a("div",Sa,[e[19]||(e[19]=a("h3",null,"Replace Document",-1)),h.value?(u(),n("div",Oa,[a("strong",null,i(h.value.doc_type),1),se(" 路 doc_id="+i(h.value.doc_id),1)])):v("",!0),a("input",{type:"file",onChange:Ue,accept:De.value},null,40,Va),g.value?(u(),n("div",{key:1,class:O(["msg",{ok:R.value,bad:!R.value}])},i(g.value),3)):v("",!0),a("div",qa,[a("button",{class:"btn-cancel",onClick:oe},"Cancel"),a("button",{class:"btn-primary",onClick:Re,disabled:z.value||!L.value||!h.value},i(z.value?"Uploading...":"Replace"),9,Wa)])])])):v("",!0),Z.value?(u(),n("div",Ba,[a("div",Ga,[e[20]||(e[20]=a("h3",null,"Delete Document",-1)),w.value?(u(),n("div",Ia,[a("strong",null,i(w.value.doc_type),1),se(" 路 "+i(w.value.file_path),1)])):v("",!0),e[21]||(e[21]=a("div",{class:"msg bad"},"This will remove the file from the system. Approved documents cannot be deleted.",-1)),y.value?(u(),n("div",{key:1,class:O(["msg",{ok:M.value,bad:!M.value}])},i(y.value),3)):v("",!0),a("div",Ja,[a("button",{class:"btn-cancel",onClick:ne,disabled:S.value},"Cancel",8,za),a("button",{class:"btn-danger",onClick:je,disabled:S.value||!w.value},i(S.value?"Deleting...":"Delete"),9,Ea)])])])):v("",!0)])}}},Ya=xe(Ha,[["__scopeId","data-v-1327e3b8"]]);export{Ya as default};
