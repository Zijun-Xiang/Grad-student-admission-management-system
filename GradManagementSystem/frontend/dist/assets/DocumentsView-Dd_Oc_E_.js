import{_ as xe,r as t,k as ae,o as Pe,h as Le,c as u,a,d as v,t as i,u as _,n as O,F as ce,f as re,e as $e,l as se,g as Ae,i as f,j as d}from"./index-CHzR5xCe.js";import{d as Ne,f as Se,s as Oe,a as Ve}from"./docDisplay-CK9INdz_.js";const qe={class:"dashboard-layout"},We={class:"navbar"},Be={class:"user-info"},Ge={key:0},Ie={class:"main-container"},Je={class:"sidebar"},ze={class:"content"},Ee={class:"card mb-30"},He={class:"upload-grid"},Ke={class:"upload-panel"},Qe=["disabled"],Xe={class:"upload-panel"},Ye={key:0,class:"msg bad",style:{margin:"10px 0 0"}},Ze=["disabled"],ea={class:"upload-panel"},aa={key:0,class:"msg bad",style:{margin:"10px 0 0"}},sa=["disabled"],la=["disabled"],ta={class:"upload-panel"},oa={key:0,class:"msg bad",style:{margin:"10px 0 0"}},na=["disabled"],ua=["disabled"],da={class:"card"},ia={key:0,class:"loading-text"},ca={key:1,class:"empty-state"},ra={key:2,class:"doc-list"},va={class:"info"},pa={class:"doc-meta-row"},ma={class:"doc-source-pill"},fa={class:"doc-format-pill"},_a={key:0,class:"meta"},ha={key:0,class:"comment"},ga={class:"actions"},ya=["onClick"],ba=["onClick"],ka=["onClick","disabled"],Ca=["onClick","disabled"],wa={key:0,class:"modal-overlay"},Da={class:"modal-box wide-modal"},Fa={key:0,class:"comment-meta"},Ua={class:"comment-list"},Ra={key:0,class:"loading-text"},Ma={key:1,class:"empty-state"},ja={key:2},Ta={class:"comment-head"},xa={class:"comment-author"},Pa={class:"comment-time"},La={class:"comment-body"},$a={class:"modal-actions"},Aa=["disabled"],Na={key:1,class:"modal-overlay"},Sa={class:"modal-box wide-modal"},Oa={key:0,class:"comment-meta"},Va=["accept"],qa={class:"modal-actions"},Wa=["disabled"],Ba={key:2,class:"modal-overlay"},Ga={class:"modal-box wide-modal"},Ia={key:0,class:"comment-meta"},Ja={class:"modal-actions"},za=["disabled"],Ea=["disabled"],Ha={__name:"DocumentsView",setup(Ka){const k=Le(),E=t({}),H=t(!0),K=t([]),$=t(null),A=t(null),j=t(null),T=t(null),V=t(!1),q=t(!1),W=t(!1),B=t(!1),c=t(""),p=t(!0),Q=t(!1),h=t(null),N=t([]),X=t(!1),F=t(""),G=t(!1),C=t(""),x=t(!0),w=t({term_number:1,unlocks:{term2:!1,term3:!1}}),I=ae(()=>{var e;const s=Number(((e=w.value)==null?void 0:e.term_number)||1);return s>=3&&s<=4}),J=ae(()=>{var e;return Number(((e=w.value)==null?void 0:e.term_number)||1)>=3}),ve=s=>{var e,l;$.value=((l=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:l[0])??null},pe=s=>{var e,l;A.value=((l=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:l[0])??null},me=s=>{var e,l;if(!I.value){j.value=null;return}j.value=((l=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:l[0])??null},fe=s=>{var e,l;if(!J.value){T.value=null;return}T.value=((l=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:l[0])??null},U=async()=>{H.value=!0;try{const s=await f.get("get_status.php");s.data.status==="success"&&(K.value=s.data.documents||[],w.value=s.data.term||w.value)}finally{H.value=!1}},_e=async()=>{var s,e;if(j.value){W.value=!0,c.value="";try{const l=new FormData;l.append("file",j.value);const o=await f.post("upload_thesis_project.php",l);o.data.status==="success"?(p.value=!0,c.value="Thesis/Project file uploaded. Waiting for review.",j.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(l){p.value=!1,c.value=((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{W.value=!1}}},he=async()=>{var s,e;if($.value){V.value=!0,c.value="";try{const l=new FormData;l.append("file",$.value);const o=await f.post("upload_letter.php",l);o.data.status==="success"?(p.value=!0,c.value="Admission letter uploaded. Waiting for review.",$.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(l){p.value=!1,c.value=((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{V.value=!1}}},ge=async()=>{var s,e;if(A.value){q.value=!0,c.value="";try{const l=new FormData;l.append("file",A.value);const o=await f.post("upload_major_professor_form.php",l);o.data.status==="success"?(p.value=!0,c.value="Major Professor form uploaded. Waiting for review.",A.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(l){p.value=!1,c.value=((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{q.value=!1}}},ye=async()=>{var s,e;if(T.value){B.value=!0,c.value="";try{const l=new FormData;l.append("file",T.value);const o=await f.post("upload_research_method_proof.php",l);o.data.status==="success"?(p.value=!0,c.value=o.data.message||"Research Method proof uploaded.",T.value=null,await U()):(p.value=!1,c.value=o.data.message||"Upload failed")}catch(l){p.value=!1,c.value=((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)||"Upload failed"}finally{B.value=!1}}},be=async s=>{var e,l;try{const m=(await f.get(`download_document.php?doc_id=${s.doc_id}`,{responseType:"blob"})).data,r=URL.createObjectURL(m);window.open(r,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(r),6e4)}catch(o){p.value=!1,c.value=((l=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to open document."}},ke=async s=>{h.value=s,Q.value=!0,F.value="",C.value="",N.value=[],X.value=!0;try{await le(s.doc_id)}finally{X.value=!1}},Ce=()=>{Q.value=!1,h.value=null,N.value=[],F.value="",C.value=""},we=async()=>{var s,e,l,o;if(h.value){G.value=!0,C.value="",x.value=!0;try{const m=await f.post("document_comments_add.php",{doc_id:h.value.doc_id,comment:F.value});((s=m.data)==null?void 0:s.status)==="success"?(x.value=!0,C.value="Posted.",F.value="",await le(h.value.doc_id)):(x.value=!1,C.value=((e=m.data)==null?void 0:e.message)||"Failed to post")}catch(m){x.value=!1,C.value=((o=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to post"}finally{G.value=!1}}},le=async s=>{var l;const e=await f.get(`document_comments_list.php?doc_id=${s}`);((l=e.data)==null?void 0:l.status)==="success"&&(N.value=e.data.data||[])},te=s=>String((s==null?void 0:s.status)||"").toLowerCase()!=="approved",Y=t(!1),g=t(null),P=t(null),z=t(!1),y=t(""),R=t(!0),Z=t(!1),D=t(null),S=t(!1),b=t(""),M=t(!0),De=ae(()=>{var e;return String(((e=g.value)==null?void 0:e.doc_type)||"")==="thesis_project"?".pdf":".pdf,.jpg,.jpeg,.png"}),Fe=s=>{g.value=s,P.value=null,y.value="",R.value=!0,Y.value=!0},oe=()=>{Y.value=!1,g.value=null,P.value=null,y.value=""},Ue=s=>{var e,l;P.value=((l=(e=s==null?void 0:s.target)==null?void 0:e.files)==null?void 0:l[0])??null},Re=async()=>{var s,e,l,o,m;if(!(!g.value||!P.value)){z.value=!0,y.value="",R.value=!0;try{const r=new FormData;r.append("doc_id",String(g.value.doc_id)),r.append("file",P.value);const L=await f.post("student_replace_document.php",r);((s=L.data)==null?void 0:s.status)==="success"?(R.value=!0,y.value=((e=L.data)==null?void 0:e.message)||"Replaced.",p.value=!0,c.value=y.value,await U(),oe()):(R.value=!1,y.value=((l=L.data)==null?void 0:l.message)||"Replace failed")}catch(r){R.value=!1,y.value=((m=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:m.message)||"Replace failed"}finally{z.value=!1}}},Me=s=>{D.value=s,b.value="",M.value=!0,Z.value=!0},ne=()=>{Z.value=!1,D.value=null,b.value=""},je=async()=>{var s,e,l,o,m;if(D.value){S.value=!0,b.value="",M.value=!0;try{const r=await f.post("student_delete_document.php",{doc_id:D.value.doc_id});((s=r.data)==null?void 0:s.status)==="success"?(M.value=!0,b.value=((e=r.data)==null?void 0:e.message)||"Deleted.",p.value=!0,c.value=b.value,await U(),ne()):(M.value=!1,b.value=((l=r.data)==null?void 0:l.message)||"Delete failed")}catch(r){M.value=!1,b.value=((m=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:m.message)||"Delete failed"}finally{S.value=!1}}},Te=async()=>{try{await f.post("logout.php")}catch{}localStorage.removeItem("user"),k.push("/")};return Pe(()=>{const s=localStorage.getItem("user");if(!s)return k.push("/");E.value=JSON.parse(s),U()}),(s,e)=>{var l,o,m,r,L,ue,de,ie;return d(),u("div",qe,[a("header",We,[e[7]||(e[7]=a("div",{class:"brand"},"Grad System",-1)),a("div",Be,[E.value.username?(d(),u("span",Ge,"Welcome, "+i(E.value.username),1)):v("",!0),a("button",{onClick:Te,class:"btn-logout"},"Logout")])]),a("div",Ie,[a("aside",Je,[a("nav",null,[a("ul",null,[a("li",{onClick:e[0]||(e[0]=n=>_(k).push("/dashboard"))},"Dashboard"),a("li",{onClick:e[1]||(e[1]=n=>_(k).push("/my-courses"))},"My Courses"),e[8]||(e[8]=a("li",{class:"active"},"Documents",-1)),a("li",{onClick:e[2]||(e[2]=n=>_(k).push("/assignments"))},"Assignments"),a("li",{onClick:e[3]||(e[3]=n=>_(k).push("/profile"))},"Profile"),(o=(l=w.value)==null?void 0:l.unlocks)!=null&&o.term2?(d(),u("li",{key:0,onClick:e[4]||(e[4]=n=>_(k).push("/major-professor"))},"Major Professor")):v("",!0),(r=(m=w.value)==null?void 0:m.unlocks)!=null&&r.term3?(d(),u("li",{key:1,onClick:e[5]||(e[5]=n=>_(k).push("/thesis-project"))},"Thesis / Project")):v("",!0)])])]),a("main",ze,[a("div",Ee,[e[17]||(e[17]=a("h2",null,"Upload Documents",-1)),a("div",He,[a("div",Ke,[e[9]||(e[9]=a("h3",null,"Admission Letter",-1)),e[10]||(e[10]=a("p",{class:"text-muted"},"Required for Term 1 hold release.",-1)),a("input",{type:"file",onChange:ve,accept:".pdf,.jpg,.png"},null,32),a("button",{class:"btn-primary",onClick:he,disabled:!$.value||V.value},i(V.value?"Uploading...":"Upload"),9,Qe)]),a("div",Xe,[e[11]||(e[11]=a("h3",null,"Major Professor Form",-1)),e[12]||(e[12]=a("p",{class:"text-muted"},"Required for Term 2 hold release.",-1)),(ue=(L=w.value)==null?void 0:L.unlocks)!=null&&ue.term2?v("",!0):(d(),u("div",Ye," Locked: available starting Term 2. ")),a("input",{type:"file",onChange:pe,accept:".pdf,.jpg,.png"},null,32),a("button",{class:"btn-primary",onClick:ge,disabled:!((ie=(de=w.value)==null?void 0:de.unlocks)!=null&&ie.term2)||!A.value||q.value},i(q.value?"Uploading...":"Upload"),9,Ze)]),a("div",ea,[e[13]||(e[13]=a("h3",null,"Thesis / Project",-1)),e[14]||(e[14]=a("p",{class:"text-muted"},"Upload your thesis/project file (PDF). Allowed only in Term 3 and Term 4.",-1)),I.value?v("",!0):(d(),u("div",aa," Locked: available only in Term 3 and Term 4. ")),a("input",{type:"file",onChange:me,disabled:!I.value,accept:".pdf"},null,40,sa),a("button",{class:"btn-primary",onClick:_e,disabled:!I.value||!j.value||W.value},i(W.value?"Uploading...":"Upload"),9,la)]),a("div",ta,[e[15]||(e[15]=a("h3",null,"Research Method (Proof)",-1)),e[16]||(e[16]=a("p",{class:"text-muted"}," Term 3 hold release requires you to register/take the Research Method course. Faculty will verify your course registration. Upload proof here if requested (PDF/JPG/PNG). ",-1)),J.value?v("",!0):(d(),u("div",oa," Locked: available starting Term 3. ")),a("input",{type:"file",onChange:fe,disabled:!J.value,accept:".pdf,.jpg,.jpeg,.png"},null,40,na),a("button",{class:"btn-primary",onClick:ye,disabled:!J.value||!T.value||B.value},i(B.value?"Uploading...":"Upload"),9,ua)])]),c.value?(d(),u("div",{key:0,class:O(["msg",{ok:p.value,bad:!p.value}])},i(c.value),3)):v("",!0)]),a("div",da,[e[18]||(e[18]=a("h2",null,"My Documents",-1)),H.value?(d(),u("div",ia,"Loading...")):K.value.length===0?(d(),u("div",ca,"No documents uploaded.")):(d(),u("div",ra,[(d(!0),u(ce,null,re(K.value,n=>(d(),u("div",{key:n.doc_id,class:"doc-item"},[a("div",va,[a("div",pa,[a("span",ma,i(_(Ne)(n.doc_type)),1),a("span",fa,i(_(Se)(n.file_path)),1),a("span",{class:O(["doc-status-pill",_(Oe)(n.status)])},i(_(Ve)(n.status)),3),n.upload_date?(d(),u("span",_a,"路 "+i(n.upload_date),1)):v("",!0)]),n.admin_comment?(d(),u("div",ha,"Reviewer comment: "+i(n.admin_comment),1)):v("",!0)]),a("div",ga,[a("button",{class:"btn-secondary",onClick:ee=>be(n)},"View",8,ya),a("button",{class:"btn-secondary",onClick:ee=>ke(n)},"Comments",8,ba),a("button",{class:"btn-secondary",onClick:ee=>Fe(n),disabled:!te(n)},"Replace",8,ka),a("button",{class:"btn-danger",onClick:ee=>Me(n),disabled:!te(n)},"Delete",8,Ca)])]))),128))]))])])]),Q.value?(d(),u("div",wa,[a("div",Da,[e[19]||(e[19]=a("h3",null,"Comments",-1)),h.value?(d(),u("div",Fa,[a("strong",null,i(h.value.doc_type),1),se(" 路 doc_id="+i(h.value.doc_id),1)])):v("",!0),a("div",Ua,[X.value?(d(),u("div",Ra,"Loading comments...")):N.value.length===0?(d(),u("div",Ma,"No comments yet.")):(d(),u("div",ja,[(d(!0),u(ce,null,re(N.value,n=>(d(),u("div",{key:n.id,class:"comment-item"},[a("div",Ta,[a("span",xa,i(n.author_username||n.author_role),1),a("span",Pa,i(n.created_at),1)]),a("div",La,i(n.comment),1)]))),128))]))]),$e(a("textarea",{"onUpdate:modelValue":e[6]||(e[6]=n=>F.value=n),placeholder:"Add a note...",rows:"3"},null,512),[[Ae,F.value]]),C.value?(d(),u("div",{key:1,class:O(["msg",{ok:x.value,bad:!x.value}])},i(C.value),3)):v("",!0),a("div",$a,[a("button",{class:"btn-cancel",onClick:Ce},"Close"),a("button",{class:"btn-primary",onClick:we,disabled:G.value||!F.value.trim()||!h.value},i(G.value?"Posting...":"Post"),9,Aa)])])])):v("",!0),Y.value?(d(),u("div",Na,[a("div",Sa,[e[20]||(e[20]=a("h3",null,"Replace Document",-1)),g.value?(d(),u("div",Oa,[a("strong",null,i(g.value.doc_type),1),se(" 路 doc_id="+i(g.value.doc_id),1)])):v("",!0),a("input",{type:"file",onChange:Ue,accept:De.value},null,40,Va),y.value?(d(),u("div",{key:1,class:O(["msg",{ok:R.value,bad:!R.value}])},i(y.value),3)):v("",!0),a("div",qa,[a("button",{class:"btn-cancel",onClick:oe},"Cancel"),a("button",{class:"btn-primary",onClick:Re,disabled:z.value||!P.value||!g.value},i(z.value?"Uploading...":"Replace"),9,Wa)])])])):v("",!0),Z.value?(d(),u("div",Ba,[a("div",Ga,[e[21]||(e[21]=a("h3",null,"Delete Document",-1)),D.value?(d(),u("div",Ia,[a("strong",null,i(D.value.doc_type),1),se(" 路 "+i(D.value.file_path),1)])):v("",!0),e[22]||(e[22]=a("div",{class:"msg bad"},"This will remove the file from the system. Approved documents cannot be deleted.",-1)),b.value?(d(),u("div",{key:1,class:O(["msg",{ok:M.value,bad:!M.value}])},i(b.value),3)):v("",!0),a("div",Ja,[a("button",{class:"btn-cancel",onClick:ne,disabled:S.value},"Cancel",8,za),a("button",{class:"btn-danger",onClick:je,disabled:S.value||!D.value},i(S.value?"Deleting...":"Delete"),9,Ea)])])])):v("",!0)])}}},Ya=xe(Ha,[["__scopeId","data-v-0b9037ff"]]);export{Ya as default};
