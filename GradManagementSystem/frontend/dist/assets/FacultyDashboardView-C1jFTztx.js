import{_ as K,r as c,l as Q,h as X,i as d,c as o,a as e,d as m,t as l,F as p,f as h,e as S,g as I,o as n,p as Y,q as Z}from"./index-DT2F-dT6.js";const ee={class:"dashboard-layout"},se={class:"navbar admin-nav"},te={class:"user-info"},ae={key:0},oe={class:"main-container"},ne={class:"content"},le={class:"card mb-30"},ce={key:0,class:"loading-text"},ie={key:1,class:"empty-state"},de={key:2,class:"review-list"},ue={class:"info"},re={class:"student-name"},_e={class:"file-link"},ve={class:"actions"},me=["href"],pe=["onClick"],he=["onClick"],ye={class:"card mb-30"},fe={key:0,class:"empty-state"},ge={key:1,class:"review-list"},be={class:"info"},ke={class:"student-name"},we={class:"file-link"},Ce={class:"actions"},Re=["href"],De=["onClick"],je={class:"card"},xe={key:0,class:"empty-state"},Me={key:1,class:"review-list"},$e={class:"info"},Ae={class:"student-name"},Se={class:"email-text"},Fe={class:"actions"},Ne=["onClick"],Pe=["onClick"],Ve={key:0,class:"modal-overlay"},Le={class:"modal-box wide-modal"},Ue={key:0,class:"comment-meta"},Be={class:"comment-list"},Ie={key:0,class:"loading-text"},qe={key:1,class:"empty-state"},Ee={key:2},Ge={class:"comment-head"},Je={class:"comment-author"},Oe={class:"comment-time"},Te={class:"comment-body"},We={class:"modal-actions"},ze=["disabled"],He={key:1,class:"modal-overlay"},Ke={class:"modal-box"},Qe={key:2,class:"modal-overlay"},Xe={class:"modal-box wide-modal"},Ye={class:"course-grid"},Ze=["value"],es={class:"code"},ss={class:"name"},ts={__name:"FacultyDashboardView",setup(as){const w=X(),y=c({}),C=c([]),R=c([]),F=c(!0),D=c([]),j=c(!1),x=c(!1),r=c(null),f=c(""),N=c([]),g=c([]),M=c(!1),u=c(null),v=c([]),$=c(!1),_=c(""),b=c(!1);Q(()=>{const t=localStorage.getItem("user");if(t){if(y.value=JSON.parse(t),y.value.role!=="faculty")return w.push("/dashboard");A(),V(),J(),q()}else w.push("/")});const P=t=>`${Y}/download_document.php?doc_id=${t.doc_id}`,A=async()=>{try{const t=await d.get("faculty_get_pending.php");t.data.status==="success"&&(C.value=t.data.data)}finally{F.value=!1}},V=async()=>{try{const t=await d.get("faculty_get_mp_requests.php");t.data.status==="success"&&(R.value=t.data.data)}catch(t){console.error(t)}},q=async()=>{try{const t=await d.get("faculty_get_advisee_documents.php");t.data.status==="success"&&(D.value=t.data.data||[])}catch(t){console.error(t)}},L=t=>`${t.first_name||""} ${t.last_name||""}`.trim()||t.student_username||"Student",U=async(t,a)=>{if(confirm(`Are you sure you want to ${a.toUpperCase()} ${L(t)}?`))try{const s=await d.post("faculty_respond_mp.php",{student_id:t.student_id,action:a});s.data.status==="success"?(alert("Success: "+s.data.message),V()):alert(s.data.message||"Failed")}catch{alert("Network Error")}},B=async t=>{var a,s;u.value=t,M.value=!0,_.value="",v.value=[],$.value=!0;try{const i=await d.get(`document_comments_list.php?doc_id=${t.doc_id}`);i.data.status==="success"?v.value=i.data.data||[]:alert(i.data.message||"Failed to load comments")}catch(i){alert(((s=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to load comments")}finally{$.value=!1}},E=()=>{M.value=!1,u.value=null,v.value=[],_.value=""},G=async()=>{var t,a;if(u.value){b.value=!0;try{const s=await d.post("document_comments_add.php",{doc_id:u.value.doc_id,comment:_.value});s.data.status==="success"?(_.value="",await B(u.value)):alert(s.data.message||"Failed to post comment")}catch(s){alert(((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to post comment")}finally{b.value=!1}}},J=async()=>{try{const t=await d.get("get_courses.php");t.data.status==="success"&&(N.value=t.data.data)}catch{}},O=t=>{r.value=t,f.value="",j.value=!0},T=t=>{r.value=t,g.value=[],x.value=!0},k=()=>{j.value=!1,x.value=!1},W=async()=>{if(r.value)try{const t=await d.post("faculty_review.php",{doc_id:r.value.doc_id,action:"reject",comment:f.value});t.data.status==="success"?(t.data.registrar_code&&alert("Registrar Code: "+t.data.registrar_code),k(),A()):alert(t.data.message||"Reject failed")}catch{}},z=async()=>{if(r.value)try{await d.post("assign_deficiency.php",{student_id:r.value.student_id,courses:g.value});const t=await d.post("faculty_review.php",{doc_id:r.value.doc_id,action:"approve",comment:"Approved"});t.data.status==="success"?(t.data.registrar_code&&alert("Registrar Code: "+t.data.registrar_code),k(),A()):alert(t.data.message||"Approve failed")}catch{alert("Network Error")}},H=async()=>{try{await d.post("logout.php")}catch{}localStorage.removeItem("user"),w.push("/")};return(t,a)=>(n(),o("div",ee,[e("header",se,[a[3]||(a[3]=e("div",{class:"brand"},"Grad System (Faculty Portal)",-1)),e("div",te,[y.value.username?(n(),o("span",ae,"Prof. "+l(y.value.username),1)):m("",!0),e("button",{onClick:H,class:"btn-logout"},"Logout")])]),e("div",oe,[e("main",ne,[e("div",le,[a[4]||(a[4]=e("h2",null,"Pending Document Reviews",-1)),F.value?(n(),o("div",ce,"Loading...")):C.value.length===0?(n(),o("div",ie,"No pending admission reviews.")):(n(),o("div",de,[(n(!0),o(p,null,h(C.value,s=>(n(),o("div",{key:s.doc_id,class:"review-item"},[e("div",ue,[e("span",re,"Student ID: "+l(s.student_id),1),e("span",_e,l(s.doc_type)+" · "+l(s.file_path),1)]),e("div",ve,[e("a",{href:P(s),target:"_blank",class:"btn-view"},"View",8,me),e("button",{onClick:i=>O(s),class:"btn-reject"},"Reject",8,pe),e("button",{onClick:i=>T(s),class:"btn-approve"},"Approve",8,he)])]))),128))]))]),e("div",ye,[a[5]||(a[5]=e("h2",null,"My Advisee Documents",-1)),a[6]||(a[6]=e("p",{class:"subtitle"},"Documents submitted by students who selected you as their Major Professor.",-1)),D.value.length===0?(n(),o("div",fe,"No advisee documents.")):(n(),o("div",ge,[(n(!0),o(p,null,h(D.value,s=>(n(),o("div",{key:s.doc_id,class:"review-item"},[e("div",be,[e("span",ke,l(s.student_username||`#${s.student_id}`)+" (#"+l(s.student_id)+")",1),e("span",we,l(s.doc_type)+" · "+l(s.file_path)+" · "+l(s.status),1)]),e("div",Ce,[e("a",{href:P(s),target:"_blank",class:"btn-view"},"View",8,Re),e("button",{class:"btn-view",onClick:i=>B(s)},"Comments",8,De)])]))),128))]))]),e("div",je,[a[7]||(a[7]=e("h2",null,"Major Professor Requests",-1)),a[8]||(a[8]=e("p",{class:"subtitle"},"Students requesting you as their advisor.",-1)),R.value.length===0?(n(),o("div",xe,"No new advising requests.")):(n(),o("div",Me,[(n(!0),o(p,null,h(R.value,s=>(n(),o("div",{key:s.student_id,class:"review-item highlight-item"},[e("div",$e,[e("span",Ae,l(L(s))+" (#"+l(s.student_id)+")",1),e("span",Se,l(s.email),1)]),e("div",Fe,[e("button",{onClick:i=>U(s,"reject"),class:"btn-reject"},"Decline",8,Ne),e("button",{onClick:i=>U(s,"accept"),class:"btn-approve"},"Accept Student",8,Pe)])]))),128))]))])])]),M.value?(n(),o("div",Ve,[e("div",Le,[a[9]||(a[9]=e("h3",null,"Document Comments",-1)),u.value?(n(),o("div",Ue,[e("div",null,[e("strong",null,l(u.value.student_username||`#${u.value.student_id}`),1),e("span",null," · "+l(u.value.doc_type)+" · doc_id="+l(u.value.doc_id),1)])])):m("",!0),e("div",Be,[$.value?(n(),o("div",Ie,"Loading comments...")):v.value.length===0?(n(),o("div",qe,"No comments yet.")):(n(),o("div",Ee,[(n(!0),o(p,null,h(v.value,s=>(n(),o("div",{key:s.id,class:"comment-item"},[e("div",Ge,[e("span",Je,l(s.author_username||s.author_role),1),e("span",Oe,l(s.created_at),1)]),e("div",Te,l(s.comment),1)]))),128))]))]),S(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=s=>_.value=s),placeholder:"Write a comment...",rows:"4"},null,512),[[I,_.value]]),e("div",We,[e("button",{onClick:E,class:"btn-cancel"},"Close"),e("button",{onClick:G,class:"btn-confirm-approve",disabled:b.value||!_.value.trim()},l(b.value?"Posting...":"Post Comment"),9,ze)])])])):m("",!0),j.value?(n(),o("div",He,[e("div",Ke,[a[10]||(a[10]=e("h3",null,"Reject Document",-1)),S(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=s=>f.value=s),placeholder:"Reason...",rows:"4"},null,512),[[I,f.value]]),e("div",{class:"modal-actions"},[e("button",{onClick:k,class:"btn-cancel"},"Cancel"),e("button",{onClick:W,class:"btn-confirm-reject"},"Confirm")])])])):m("",!0),x.value?(n(),o("div",Qe,[e("div",Xe,[a[11]||(a[11]=e("h3",null,"Approve & Assign Deficiencies",-1)),e("div",Ye,[(n(!0),o(p,null,h(N.value,s=>(n(),o("label",{key:s.course_code,class:"course-item"},[S(e("input",{type:"checkbox",value:s.course_code,"onUpdate:modelValue":a[2]||(a[2]=i=>g.value=i)},null,8,Ze),[[Z,g.value]]),e("span",es,l(s.course_code),1),e("span",ss,l(s.course_name),1)]))),128))]),e("div",{class:"modal-actions"},[e("button",{onClick:k,class:"btn-cancel"},"Cancel"),e("button",{onClick:z,class:"btn-confirm-approve"},"Confirm")])])])):m("",!0)]))}},ns=K(ts,[["__scopeId","data-v-603de80e"]]);export{ns as default};
