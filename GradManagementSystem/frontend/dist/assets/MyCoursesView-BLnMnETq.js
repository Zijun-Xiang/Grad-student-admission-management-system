import{_ as oe,r as d,o as ae,h as le,i as p,k as A,c as l,a as s,t as i,d as k,u as f,l as c,F as H,f as T,n as D,p as ne,j as n,e as re,x as ie}from"./index-CHzR5xCe.js";const de={class:"dashboard-layout"},ue={class:"navbar"},ce={class:"user-info"},ve={class:"main-container"},_e={class:"sidebar"},pe={class:"content"},ge={class:"content-inner"},me={class:"card"},fe={key:0,class:"alert-box"},ye={key:1,class:"info-box"},he={key:2,class:"core-card"},ke={key:0,class:"loading-text"},Ce={key:1,class:"alert-box"},be={key:2,class:"core-list"},we=["value"],xe={class:"code"},Se={class:"name"},$e={class:"credits"},Re={class:"form-actions"},Me=["disabled"],Ae={key:3},De={class:"credit-card"},Ne={class:"credit-row"},qe={class:"credit-values"},Le={class:"progress"},Be={key:0},Ee={key:1},Fe={key:2},Ve={key:1,class:"info-box"},je={class:"course-list"},Pe={class:"code"},Ue={class:"name"},Oe={key:0,class:"badge-deficiency"},Ie={class:"credits"},We={class:"status"},Ye={key:0,class:"badge-registered"},ze={key:1,class:"text-muted"},Ge={class:"action"},He=["onClick","disabled","title"],Te=["onClick","disabled"],N=12,g=20,Je={__name:"MyCoursesView",setup(Ke){const v=le(),W=d({}),q=d(null),Y=d([]),L=d([]),C=d([]),B=d(!1),b=d(!1),w=d(!1),E=d(!1),F=d([]),V=d([]),x=d(!1),y=d(""),u=d(""),_=d(!0),j=d({}),S=(t,e)=>{j.value={...j.value,[t]:e}},h=t=>{var e;return!!((e=j.value)!=null&&e[t])};ae(()=>{const t=localStorage.getItem("user");t?(W.value=JSON.parse(t),$()):v.push("/")});const $=async()=>{var t;try{const e=await p.get("get_status.php");if(e.data.status==="success"){q.value=e.data.term||null,B.value=e.data.holds.length>0,C.value=e.data.deficiencies||[];const r=(e.data.documents||[]).find(M=>M.doc_type==="admission_letter");b.value=(r==null?void 0:r.status)==="approved";const R=(t=e.data.core_checklist)==null?void 0:t.submitted_at;w.value=b.value&&!R,B.value||(w.value?await K():b.value&&(X(),P()))}}catch(e){console.error(e)}},J=async()=>{try{await p.post("logout.php")}catch{}localStorage.removeItem("user"),v.push("/")},K=async()=>{var t,e;E.value=!0,y.value="";try{const a=await p.get("get_undergrad_core_courses.php");a.data.status==="success"?(F.value=a.data.data||[],F.value.length===0&&(y.value="No undergrad core courses found. Run backend/sql/07_core_courses_seed.sql first.")):y.value=a.data.message||"Failed to load core courses."}catch(a){y.value=((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to load core courses. Run backend/sql/07_core_courses_seed.sql."}finally{E.value=!1}},Q=async()=>{var t,e;x.value=!0;try{const a=await p.post("student_submit_core_checklist.php",{completed_courses:V.value});a.data.status==="success"?(alert(`Saved. Assigned deficiencies: ${a.data.assigned_deficiencies}`),w.value=!1,await $()):alert(a.data.message||"Failed to save checklist")}catch(a){alert(((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to save checklist")}finally{x.value=!1}},X=async()=>{const t=await p.get("get_courses.php");t.data.status==="success"&&(Y.value=t.data.data)},P=async()=>{const t=await p.get("get_student_courses.php");t.data.status==="success"&&(L.value=t.data.data)},U=t=>C.value.some(e=>e.course_code===t),z=t=>L.value.some(e=>e.course_code===t),Z=A(()=>Y.value.filter(t=>{const e=String(t.level||"").toUpperCase(),a=Number(t.is_required||0)===1;return e==="UG"&&a?U(t.course_code):!0})),m=A(()=>L.value.reduce((t,e)=>t+Number(e.credits||0),0)),ee=A(()=>Math.min(100,Math.round(m.value/g*100))),G=A(()=>m.value<N?"low":m.value<=g?"ok":"high"),O=t=>{const e=Number((t==null?void 0:t.credits)||0);return m.value+e>g},se=async t=>{var e,a;if(u.value="",O(t)){_.value=!1,u.value=`Cannot exceed ${g} credits per term.`;return}if(!h(t.course_code)){S(t.course_code,!0);try{const r=await p.post("register_course.php",{course_code:t.course_code});r.data.status==="success"?(_.value=!0,u.value=`Registered: ${t.course_code}`,await P(),await $()):(_.value=!1,u.value=r.data.message||"Registration failed.")}catch(r){_.value=!1,u.value=((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"Network Error"}finally{S(t.course_code,!1)}}},te=async t=>{var e,a;if(u.value="",!h(t.course_code)){S(t.course_code,!0);try{const r=await p.post("unregister_course.php",{course_code:t.course_code});r.data.status==="success"?(_.value=!0,u.value=`Dropped: ${t.course_code}`,await P(),await $()):(_.value=!1,u.value=r.data.message||"Drop failed.")}catch(r){_.value=!1,u.value=((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"Network Error"}finally{S(t.course_code,!1)}}};return(t,e)=>{var a,r,R,M;return n(),l("div",de,[s("header",ue,[e[8]||(e[8]=s("div",{class:"brand"},"Grad System",-1)),s("div",ce,[s("span",null,"Welcome, "+i(W.value.username),1),s("button",{onClick:J,class:"btn-logout"},"Logout")])]),s("div",ve,[s("aside",_e,[s("nav",null,[s("ul",null,[s("li",{onClick:e[0]||(e[0]=o=>f(v).push("/dashboard"))},"Dashboard"),e[9]||(e[9]=s("li",{class:"active"},"My Courses",-1)),s("li",{onClick:e[1]||(e[1]=o=>f(v).push("/documents"))},"Documents"),s("li",{onClick:e[2]||(e[2]=o=>f(v).push("/assignments"))},"Assignments"),s("li",{onClick:e[3]||(e[3]=o=>f(v).push("/profile"))},"Profile"),(r=(a=q.value)==null?void 0:a.unlocks)!=null&&r.term2?(n(),l("li",{key:0,onClick:e[4]||(e[4]=o=>f(v).push("/major-professor"))},"Major Professor")):k("",!0),(M=(R=q.value)==null?void 0:R.unlocks)!=null&&M.term3?(n(),l("li",{key:1,onClick:e[5]||(e[5]=o=>f(v).push("/thesis-project"))},"Thesis / Project")):k("",!0)])])]),s("main",pe,[s("div",ge,[s("div",me,[e[22]||(e[22]=s("h2",null,"Course Registration",-1)),B.value?(n(),l("div",fe,"You have active Holds. Registration is disabled.")):b.value?w.value?(n(),l("div",he,[e[13]||(e[13]=s("h3",null,"Undergraduate Core Courses Checklist",-1)),e[14]||(e[14]=s("p",{class:"text-muted"},[c(" Select the courses you have already completed in your undergraduate study. Any course not selected will become a "),s("strong",null,"Deficiency"),c(" that you must take before graduate courses. ")],-1)),E.value?(n(),l("div",ke,"Loading core courses...")):y.value?(n(),l("div",Ce,i(y.value),1)):(n(),l("div",be,[(n(!0),l(H,null,T(F.value,o=>(n(),l("label",{key:o.course_code,class:"core-item"},[re(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=I=>V.value=I),value:o.course_code},null,8,we),[[ie,V.value]]),s("span",xe,i(o.course_code),1),s("span",Se,i(o.course_name),1),s("span",$e,i(o.credits),1)]))),128))])),s("div",Re,[s("button",{class:"btn-register",onClick:Q,disabled:x.value},i(x.value?"Saving...":"Save & Continue"),9,Me)])])):(n(),l("div",Ae,[u.value?(n(),l("div",{key:0,class:D(["msg",{ok:_.value,bad:!_.value}])},i(u.value),3)):k("",!0),s("div",De,[s("div",Ne,[e[18]||(e[18]=s("div",{class:"credit-title"},"Credit Requirement (per term)",-1)),s("div",qe,[e[15]||(e[15]=c(" Min ",-1)),s("strong",null,i(N)),e[16]||(e[16]=c(" · Max ",-1)),s("strong",null,i(g)),e[17]||(e[17]=c(" · Selected ",-1)),s("strong",null,i(m.value),1)])]),s("div",Le,[s("div",{class:D(["bar",G.value]),style:ne({width:ee.value+"%"})},null,6)]),s("div",{class:D(["credit-hint",G.value])},[m.value<N?(n(),l("span",Be,"You need at least "+i(N)+" credits.")):m.value<=g?(n(),l("span",Ee,"On track.")):(n(),l("span",Fe,"Over the maximum of "+i(g)+" credits."))],2)]),C.value.length>0?(n(),l("div",Ve,[e[19]||(e[19]=c(" You have ",-1)),s("strong",null,i(C.value.length)+" deficiency courses",1),e[20]||(e[20]=c(". According to policy, you must register for these first. ",-1))])):k("",!0),s("div",je,[e[21]||(e[21]=s("div",{class:"list-header"},[s("span",null,"Course Code"),s("span",null,"Course Name"),s("span",null,"Credits"),s("span",null,"Status"),s("span",null,"Action")],-1)),(n(!0),l(H,null,T(Z.value,o=>(n(),l("div",{key:o.course_code,class:D(["list-row",{"highlight-row":U(o.course_code)}])},[s("span",Pe,i(o.course_code),1),s("span",Ue,[c(i(o.course_name)+" ",1),U(o.course_code)?(n(),l("span",Oe,"Deficiency")):k("",!0)]),s("span",Ie,i(o.credits),1),s("span",We,[z(o.course_code)?(n(),l("span",Ye,"Registered")):(n(),l("span",ze,"-"))]),s("span",Ge,[z(o.course_code)?(n(),l("button",{key:1,onClick:I=>te(o),class:"btn-drop",disabled:h(o.course_code)},i(h(o.course_code)?"Working...":"Drop"),9,Te)):(n(),l("button",{key:0,onClick:I=>se(o),class:"btn-register",disabled:O(o)||h(o.course_code),title:O(o)?`Exceeds max ${g} credits`:""},i(h(o.course_code)?"Working...":"Register"),9,He))])],2))),128))])])):(n(),l("div",ye,[e[10]||(e[10]=s("strong",null,"Admission Letter required.",-1)),e[11]||(e[11]=c(" Please upload your Admission Letter in ",-1)),s("span",{class:"link",onClick:e[6]||(e[6]=o=>f(v).push("/documents"))},"Documents"),e[12]||(e[12]=c(" and wait for approval before course selection. ",-1))]))])])])])])}}},Xe=oe(Je,[["__scopeId","data-v-ea5bada5"]]);export{Xe as default};
